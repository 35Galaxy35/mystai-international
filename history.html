<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MystAI â€” My Reading History</title>
<link rel="icon" type="image/png" href="mystai-logo.png">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">

<style>
    body {
        margin:0;
        padding:0;
        font-family:system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
        background:radial-gradient(1100px 700px at 50% -10%, #101a4d 0%, #0b0f1f 85%);
        color:#e6ecff;
        text-align:center;
    }

    header {
        display:flex;
        justify-content:flex-end;
        align-items:center;
        padding:12px 20px;
        gap:10px;
    }

    .flag {
        width:32px;
        height:32px;
        cursor:pointer;
        border-radius:50%;
        transition:.2s;
    }
    .flag:hover { transform:scale(1.1); }

    .btn {
        padding:6px 14px;
        border:0;
        border-radius:20px;
        background:#ffd54f;
        color:#111;
        cursor:pointer;
        font-weight:700;
    }

    h1 {
        font-family:'Cinzel', serif;
        color:#ffd54f;
        font-size:36px;
        margin-top:40px;
        text-shadow:0 0 10px rgba(255,215,100,.4);
    }

    .card {
        background:rgba(255,255,255,.05);
        border:1px solid rgba(255,255,255,.1);
        padding:15px;
        margin:15px auto;
        border-radius:12px;
        width:90%;
        max-width:700px;
        display:flex;
        justify-content:space-between;
        align-items:center;
    }

    .left {
        text-align:left;
        font-size:14px;
    }

    .view-btn {
        padding:6px 12px;
        font-size:13px;
        background:#ffd54f;
        border-radius:8px;
        border:0;
        cursor:pointer;
        font-weight:700;
    }

    .delete-btn {
        padding:6px 10px;
        background:#ff4d4d;
        border:0;
        border-radius:8px;
        color:#fff;
        cursor:pointer;
        font-weight:700;
        margin-left:10px;
    }

    .modal {
        position:fixed;
        inset:0;
        background:rgba(0,0,0,.7);
        display:none;
        justify-content:center;
        align-items:center;
    }

    .modal-content {
        background:#0d1a2b;
        padding:20px;
        border-radius:14px;
        width:90%;
        max-width:600px;
        border:1px solid rgba(255,255,255,.15);
        box-shadow:0 0 30px rgba(0,0,0,.4);
        text-align:left;
        color:#e6ecff;
        white-space:pre-wrap;
    }

    footer {
        margin-top:50px;
        padding:20px;
        font-size:13px;
        color:#aeb6cf;
    }
</style>
</head>

<body>

<header>
    <img src="https://flagcdn.com/w40/gb.png" class="flag" id="btn-en">
    <img src="https://flagcdn.com/w40/tr.png" class="flag" id="btn-tr">
    <button class="btn" onclick="history.back()">â¬… <span id="backLabel">Geri</span></button>
    <button class="btn" id="logoutBtn">Ã‡Ä±kÄ±ÅŸ</button>
</header>

<h1 id="title">FAL GEÃ‡MÄ°ÅžÄ°M</h1>

<div id="list"></div>

<!-- MODAL -->
<div class="modal" id="modal">
    <div class="modal-content">
        <h3 id="modalType" style="color:#ffd54f; font-family:'Cinzel';"></h3>
        <div id="modalText"></div><br>
        <button class="btn" id="closeModal">Kapat</button>
    </div>
</div>

<footer>
    Â© 2025 MystAI.ai â€” All Rights Reserved. Developed by GALAXY ðŸŒŒ
</footer>

<script type="module">
/* Firebase */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
import { 
    getFirestore, 
    collection, 
    query, 
    where, 
    getDocs,
    deleteDoc,
    doc
} from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDyiD7GAfOjMbtm-S6pO6XCSRXJclffPL0",
    authDomain: "mystai-6cca2.firebaseapp.com",
    projectId: "mystai-6cca2",
    storageBucket: "mystai-6cca2.appspot.com",
    messagingSenderId: "624127781219",
    appId: "1:624127781219:web:a580ac6e80ccc26e694b56"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const list = document.getElementById("list");

/* LANGUAGE */
let lang = localStorage.getItem("myst_lang") || "tr";
function applyLang() {
    if(lang==="tr"){
        document.getElementById("title").textContent = "FAL GEÃ‡MÄ°ÅžÄ°M";
        document.getElementById("logoutBtn").textContent = "Ã‡Ä±kÄ±ÅŸ";
        document.getElementById("backLabel").textContent = "Geri";
    } else {
        document.getElementById("title").textContent = "My Reading History";
        document.getElementById("logoutBtn").textContent = "Logout";
        document.getElementById("backLabel").textContent = "Back";
    }
}
applyLang();

document.getElementById("btn-en").onclick = ()=>{ lang="en"; localStorage.setItem("myst_lang","en"); applyLang(); };
document.getElementById("btn-tr").onclick = ()=>{ lang="tr"; localStorage.setItem("myst_lang","tr"); applyLang(); };

/* AUTH */
document.getElementById("logoutBtn").onclick = () => {
    signOut(auth).then(()=>window.location.href="login.html");
};

onAuthStateChanged(auth, async (user)=>{
    if(!user){ window.location.href="login.html"; return; }

    /* ðŸ”¥ DOÄžRU SORGULAMA â€” collectionGroup YOK! */
    const q = query(collection(db,"fortunes"), where("user","==",user.email));
    const snap = await getDocs(q);

    if(snap.empty){
        list.innerHTML = `<p style="margin-top:40px; color:#aeb6cf;">${lang==="tr"?"HiÃ§ fal bulunamadÄ±.":"No readings found."}</p>`;
        return;
    }

    snap.forEach(docu=>{
        const data = docu.data();

        const div = document.createElement("div");
        div.className = "card";

        div.innerHTML = `
            <div class="left">
                <strong>TÃ¼r: ${data.type || "-"} </strong><br>
                Tarih: ${data.createdAt || "-"}
            </div>

            <div>
                <button class="view-btn"> ${lang==="tr"?"FalÄ± GÃ¶r":"View"} </button>
                <button class="delete-btn">ðŸ—‘</button>
            </div>
        `;

        /* VIEW BUTTON */
        div.querySelector(".view-btn").onclick = ()=>{
            modalType.textContent = data.type;
            modalText.textContent = data.result;
            modal.style.display="flex";
        };

        /* DELETE BUTTON */
        div.querySelector(".delete-btn").onclick = async ()=>{
            await deleteDoc(doc(db,"fortunes",docu.id));
            div.remove();
        };

        list.appendChild(div);
    });
});

/* modal close */
const modal = document.getElementById("modal");
document.getElementById("closeModal").onclick = ()=> modal.style.display="none";
modal.onclick = (e)=>{ if(e.target===modal) modal.style.display="none"; };

</script>
</body>
</html>
