<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MystAI â€” My Reading History</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet" />

<style>
:root {
  --text:#e4e8ff;
  --muted:#a6b0d4;
  --accent:#ffd550;
  --accent2:#ff4d4d;
}
body {
  margin:0;
  background:radial-gradient(1000px 600px at 50% -10%, #15206d 0%, #070c23 80%);
  font-family:system-ui;
  color:var(--text);
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* TOP BAR */
.topbar{
  padding:14px 22px;
  display:flex;
  justify-content:space-between;
  background:rgba(8,12,30,0.75);
  backdrop-filter:blur(10px);
}
.flags{display:flex;gap:10px;}
.flag-btn{
  width:34px;height:34px;border-radius:50%;
  cursor:pointer;background-size:cover;background-position:center;
  border:2px solid transparent;transition:.25s;
}
.flag-btn.active{border-color:var(--accent);box-shadow:0 0 10px var(--accent);}
.flag-en{background-image:url('https://flagcdn.com/w40/gb.png');}
.flag-tr{background-image:url('https://flagcdn.com/w40/tr.png');}

.nav-btn{
  border:0;border-radius:20px;padding:7px 14px;
  background:rgba(255,255,255,.12);color:#fff;cursor:pointer;
}

.title{
  font-family:'Cinzel',serif;
  text-align:center;font-size:32px;margin-top:30px;
  color:var(--accent);text-shadow:0 0 15px rgba(255,215,0,.5);
}

.list{
  width:100%;max-width:830px;margin:30px auto 50px;
  display:flex;flex-direction:column;gap:18px;
}
.item{
  background:rgba(8,12,32,0.85);
  padding:16px 20px;border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  display:flex;flex-wrap:wrap;
  justify-content:space-between;
}
.item p{margin:4px 0;font-size:14px;}
.btns{display:flex;gap:10px;margin-top:10px;}
.view-btn{
  background:var(--accent);border:0;padding:7px 15px;
  font-weight:700;border-radius:10px;cursor:pointer;color:#000;
}
.delete-btn{
  background:var(--accent2);border:0;width:36px;height:36px;
  border-radius:50%;cursor:pointer;color:#fff;font-size:18px;
  display:flex;align-items:center;justify-content:center;
}

footer{
  margin-top:auto;padding:22px;font-size:13px;
  color:var(--muted);text-align:center;
}
footer a{color:var(--accent);text-decoration:none;}
</style>
</head>

<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="flags">
    <div id="btn-en" class="flag-btn flag-en"></div>
    <div id="btn-tr" class="flag-btn flag-tr"></div>
  </div>
  <div>
    <button id="backBtn" class="nav-btn">â¬… Geri</button>
    <button id="logoutBtn" class="nav-btn">Ã‡Ä±kÄ±ÅŸ</button>
  </div>
</div>

<h1 id="pageTitle" class="title">FAL GEÃ‡MÄ°ÅžÄ°M</h1>

<div class="list" id="historyList"></div>

<footer>
  Â© 2025 MystAI.ai â€” All Rights Reserved.<br>
  <a href="mailto:support@mystai.ai">support@mystai.ai</a>
</footer>

<script type="module">
/* FIREBASE */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDyiD7GAfOjMbtm-S6pO6XCSRXJclffPL0",
  authDomain: "mystai-6cca2.firebaseapp.com",
  projectId: "mystai-6cca2",
  storageBucket: "mystai-6cca2.appspot.com",
  messagingSenderId: "624127781219",
  appId: "1:624127781219:web:a580ac6e80ccc26e694b56"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* LANGUAGE */
let activeLang = localStorage.getItem("myst_lang") || "tr";

const i18n = {
  tr:{ title:"FAL GEÃ‡MÄ°ÅžÄ°M", back:"Geri", logout:"Ã‡Ä±kÄ±ÅŸ", view:"FalÄ±nÄ± GÃ¶r", type:"TÃ¼r", date:"Tarih" },
  en:{ title:"MY READING HISTORY", back:"Back", logout:"Logout", view:"View Reading", type:"Type", date:"Date" }
};

function translateType(type, lang){
  const map={
    "AI Coffee Reading":{tr:"Yapay ZekÃ¢ Kahve FalÄ±",en:"AI Coffee Reading"},
    "AI Tarot Reading":{tr:"Yapay ZekÃ¢ Tarot FalÄ±",en:"AI Tarot Reading"},
    "AI Palm Reading":{tr:"Yapay ZekÃ¢ El FalÄ±",en:"AI Palm Reading"},
    "Energy & Dreams Reading":{tr:"Enerji & RÃ¼ya Yorumu",en:"Energy & Dreams Reading"}
  };
  return map[type] ? map[type][lang] : type;
}

function applyLang(){
  const t=i18n[activeLang];
  document.getElementById("pageTitle").textContent=t.title;
  document.getElementById("backBtn").textContent="â¬… "+t.back;
  document.getElementById("logoutBtn").textContent=t.logout;
}

/* LOAD HISTORY â€” NO ORDERBY */
async function loadHistory(){
  applyLang();

  const user=auth.currentUser;
  if(!user) return;

  const list=document.getElementById("historyList");
  list.innerHTML="";

  const q=query(collection(db,"fortunes"), where("user","==",user.email));
  const snap=await getDocs(q);

  if(snap.empty){
    list.innerHTML="<p style='text-align:center;color:#ccc;'>KayÄ±t bulunamadÄ±.</p>";
    return;
  }

  snap.forEach(docx=>{
    const item=docx.data();
    const id=docx.id;
    const t=i18n[activeLang];

    const div=document.createElement("div");
    div.className="item";

    div.innerHTML=`
      <div>
        <p><b>${t.type}:</b> ${translateType(item.type, activeLang)}</p>
        <p><b>${t.date}:</b> ${item.createdAt}</p>
      </div>
      <div class="btns">
        <button class="view-btn">${t.view}</button>
        <button class="delete-btn">ðŸ—‘</button>
      </div>
    `;

    div.querySelector(".view-btn").onclick=()=>{
      localStorage.setItem("myst_view_reading", JSON.stringify(item));
      window.location.href="view.html";
    };

    div.querySelector(".delete-btn").onclick=async()=>{
      if(confirm(activeLang==="tr"?"Silinsin mi?":"Delete?")){
        await deleteDoc(doc(db,"fortunes",id));
        loadHistory();
      }
    };

    list.appendChild(div);
  });
}

document.getElementById("btn-en").onclick=()=>{activeLang="en";localStorage.setItem("myst_lang","en");loadHistory()};
document.getElementById("btn-tr").onclick=()=>{activeLang="tr";localStorage.setItem("myst_lang","tr");loadHistory()};

onAuthStateChanged(auth,(user)=>{
  if(!user) window.location.href="login.html";
  loadHistory();
});

document.getElementById("backBtn").onclick=()=>window.location.href="app.html";
document.getElementById("logoutBtn").onclick=()=>signOut(auth).then(()=>window.location.href="login.html");
</script>

</body>
</html>
