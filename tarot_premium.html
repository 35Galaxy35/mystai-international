<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MystAI â€” AI Tarot Reading</title>
  <link rel="icon" type="image/png" href="mystai-logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg-start:#0d1440;
      --bg-end:#0b0f1f;
      --text:#d8e0ff;
      --muted:#a9b4d0;
      --accent:#f2c84b;
      --card-border:#f7e8b0;
    }
    *{box-sizing:border-box;margin:0;padding:0;}

    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:radial-gradient(1100px 700px at 50% -10%, #101a4d 0%, #0b0f1f 85%);
      color:var(--text);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* TOP BAR */
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px 24px;
      background:rgba(10,15,30,0.45);
      backdrop-filter:blur(12px);
      border-bottom:1px solid rgba(255,255,255,0.08);
      position:sticky;
      top:0;
      z-index:20;
    }
    .top-left,.top-right{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .lang-btn{
      border:none;
      border-radius:50%;
      width:34px;height:34px;
      cursor:pointer;
      background-size:cover;
      background-position:center;
      transition:transform .25s ease,box-shadow .25s ease;
      border:2px solid transparent;
    }
    .flag-en{background-image:url("https://flagcdn.com/w40/gb.png");}
    .flag-tr{background-image:url("https://flagcdn.com/w40/tr.png");}

    .lang-btn.active{
      box-shadow:0 0 12px rgba(255,215,0,.8);
      border-color:#ffd54f;
      transform:scale(1.08);
    }
    .lang-btn:hover{transform:scale(1.12);}

    .nav-btn{
      border:0;
      border-radius:20px;
      background:rgba(255,255,255,.12);
      color:#fff;
      padding:7px 14px;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:4px;
      transition:all .25s ease;
    }
    .nav-btn:hover{filter:brightness(1.2);transform:translateY(-1px);}

    .user-label{
      font-size:13px;
      color:#ffe680;
      text-shadow:0 0 8px rgba(255,215,0,.4);
      margin-right:4px;
    }

    /* MAIN LAYOUT */
    .wrapper{
      flex:1;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:30px 16px 40px;
    }
    .card-shell{
      width:100%;
      max-width:1120px;
      background:radial-gradient(circle at top,rgba(40,50,110,.9),rgba(4,8,24,.96));
      border-radius:20px;
      border:1px solid rgba(255,255,255,.15);
      box-shadow:0 0 40px rgba(0,0,0,.7);
      padding:24px;
      display:grid;
      grid-template-columns:minmax(0,1.25fr) minmax(0,0.9fr);
      gap:26px;
      position:relative;
      overflow:hidden;
    }
    .card-shell::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 10% 0%,rgba(255,215,0,.18),transparent 55%),
                 radial-gradient(circle at 90% 100%,rgba(120,90,255,.25),transparent 55%);
      opacity:.7;
      pointer-events:none;
    }
    .card-shell > *{position:relative; z-index:2;}
    @media(max-width:960px){
      .card-shell{grid-template-columns:1fr;}
    }

    /* LEFT SIDE */
    .section-title{
      font-family:'Cinzel',serif;
      color:#ffd54f;
      font-size:28px;
      margin-bottom:8px;
      text-shadow:0 0 14px rgba(255,220,120,.7);
      text-align:left;
    }
    .section-sub{
      font-size:14px;
      color:#e0e5ff;
      text-align:left;
      line-height:1.7;
      margin-bottom:18px;
    }
    .section-sub span{
      color:#ffd966;
      font-weight:600;
    }

    .label{
      text-align:left;
      font-size:13px;
      font-weight:600;
      color:#ffe680;
      margin-bottom:6px;
      margin-top:12px;
    }

    /* TAROT CARDS ROW */
    .tarot-row{
      display:flex;
      gap:18px;
      margin-top:6px;
      margin-bottom:4px;
      flex-wrap:wrap;
      align-items:center;
    }
    .tarot-row.shuffling{
      animation:shuffle 0.4s ease-in-out 2;
    }
    @keyframes shuffle{
      0%{transform:translateX(0);}
      25%{transform:translateX(-6px);}
      50%{transform:translateX(6px);}
      75%{transform:translateX(-3px);}
      100%{transform:translateX(0);}
    }

    .tarot-card{
      position:relative;
      width:120px;
      height:210px;
      perspective:1000px;
      cursor:pointer;
    }
    .tarot-card.disabled{
      cursor:pointer; /* Zoom iÃ§in yine tÄ±klanabilir */
      opacity:.98;
    }
    .tarot-card::before{
      /* hover parÄ±ltÄ± glow */
      content:"";
      position:absolute;
      inset:-6px;
      border-radius:18px;
      pointer-events:none;
      opacity:0;
      box-shadow:0 0 18px rgba(255,215,0,.0);
      transition:opacity .25s ease, box-shadow .25s ease;
    }
    .tarot-card:hover::before{
      opacity:1;
      box-shadow:0 0 18px rgba(255,215,0,.7);
    }
    .tarot-card.just-flipped::after{
      /* enerji/partikÃ¼l efekti */
      content:"";
      position:absolute;
      inset:-10px;
      border-radius:18px;
      pointer-events:none;
      background:radial-gradient(circle,rgba(255,215,0,.45),transparent 60%);
      animation:cardPulse 0.6s ease-out forwards;
    }
    @keyframes cardPulse{
      0%{opacity:0.85;transform:scale(0.8);}
      100%{opacity:0;transform:scale(1.2);}
    }

    .card-inner{
      width:100%;
      height:100%;
      position:absolute;
      inset:0;
      transform-style:preserve-3d;
      transition:transform .7s ease;
    }
    .tarot-card.flipped .card-inner{
      transform:rotateY(180deg);
    }

    .card-face{
      position:absolute;
      inset:0;
      border-radius:14px;
      backface-visibility:hidden;
      box-shadow:0 14px 35px rgba(0,0,0,.8);
      overflow:hidden;
    }

    /* BACK SIDE (KART SIRTÄ°) */
    .card-front{
      background-image:url("assets/cards/back.png");
      background-size:cover;
      background-position:center;
      border:1px solid rgba(250,240,190,.85);
      position:absolute;
      inset:0;
    }
    .card-front::after{
      content:"";
      position:absolute;
      inset:8px;
      border-radius:11px;
      box-shadow:0 0 25px rgba(0,0,0,.7) inset;
    }

    /* FRONT FACE (AÃ‡ILDIÄžINDA GÃ–RÃœNEN) */
    .card-back{
      transform:rotateY(180deg);
      background:linear-gradient(160deg,#16162f,#040713);
      border:1px solid rgba(247,232,176,.9);
      display:flex;
      flex-direction:column;
    }
    .card-frame{
      flex:1;
      margin:6px;
      border-radius:11px;
      border:1px solid rgba(247,232,176,.7);
      background:radial-gradient(circle at top,#27285b,#050712);
      position:relative;
      overflow:hidden;
    }
    .card-illus{
      position:absolute;
      inset:10px 12px 36px;
      border-radius:9px;
      background:linear-gradient(160deg,#15152a,#050612 70%);
      box-shadow:0 0 20px rgba(0,0,0,.85) inset;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding:6px;
      overflow:hidden;
    }
    .card-illus img[data-role="card-img"]{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      opacity:0.97;
    }
    .card-illus span.card-illus-label{
      position:relative;
      z-index:2;
      font-size:10px;
      text-align:center;
      color:#f7f0ff;
      text-shadow:0 0 8px rgba(0,0,0,.9);
      padding:3px 5px;
      border-radius:999px;
      background:linear-gradient(120deg,rgba(5,5,15,.9),rgba(40,40,90,.85));
      max-width:100%;
    }

    .card-caption{
      position:absolute;
      left:0;right:0;
      bottom:8px;
      text-align:center;
      font-size:11px;
      color:#ffeec0;
      text-transform:uppercase;
      letter-spacing:1px;
      font-weight:700;
    }

    .card-meta{
      padding:4px 6px 7px;
      text-align:center;
      border-top:1px solid rgba(247,232,176,.45);
      background:linear-gradient(180deg,rgba(20,20,40,.85),rgba(10,8,22,.95));
    }
    .card-meta-name{
      font-size:12px;
      font-weight:700;
      color:#fff5cf;
      text-shadow:0 0 8px rgba(0,0,0,.8);
    }
    .card-meta-pos{
      font-size:11px;
      color:#cfd5ff;
      margin-top:1px;
    }

    .card-hint{
      font-size:11px;
      color:#b2b9f5;
      margin-top:6px;
      text-align:left;
    }

    textarea{
      width:100%;
      min-height:90px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background:#050b20;
      color:#e6ecff;
      padding:10px;
      font-family:inherit;
      font-size:14px;
      resize:vertical;
      outline:none;
      box-shadow:inset 0 0 10px rgba(0,0,0,.35);
      margin-top:4px;
    }
    textarea::placeholder{
      color:#808abf;
      font-size:13px;
    }

    .primary-btn{
      margin-top:14px;
      border:0;
      border-radius:12px;
      padding:10px 18px;
      background:linear-gradient(120deg,#ffd700,#ffb600,#ffe680);
      color:#111;
      font-weight:800;
      font-size:14px;
      cursor:pointer;
      box-shadow:0 0 18px rgba(255,215,0,.5);
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:all .25s ease;
    }
    .primary-btn:hover{transform:translateY(-1px) scale(1.03);}
    .primary-btn:disabled{
      opacity:.6;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    .status{
      margin-top:8px;
      font-size:12px;
      color:#aeb6ff;
      text-align:left;
    }

    /* RIGHT SIDE â€“ RESULT */
    .result-box{
      border-radius:16px;
      background:radial-gradient(circle at 0% 0%,#323b7a,#070c24 55%);
      border:1px solid rgba(255,255,255,.16);
      padding:16px;
      box-shadow:0 0 30px rgba(0,0,0,.6);
      display:flex;
      flex-direction:column;
      height:100%;
    }
    .result-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .result-title{
      font-size:15px;
      font-weight:700;
      color:#ffd966;
    }
    .audio-btn{
      border:0;
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      font-weight:600;
      background:rgba(255,255,255,.12);
      color:#fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .audio-btn[disabled]{
      opacity:.5;
      cursor:not-allowed;
    }

    .spread-labels{
      display:flex;
      justify-content:space-between;
      font-size:11px;
      color:#aeb6ff;
      margin-bottom:4px;
      gap:8px;
      flex-wrap:wrap;
    }

    .result-content{
      margin-top:6px;
      font-size:14px;
      color:#dbe3ff;
      text-align:left;
      line-height:1.7;
      overflow-y:auto;
      max-height:280px;
      padding-right:4px;
      white-space:pre-wrap;
    }
    .result-hint{
      font-size:12px;
      color:#9098d0;
      margin-top:6px;
    }

    /* FOOTER */
    footer{
      border-top:1px solid rgba(255,255,255,.08);
      padding:18px;
      font-size:13px;
      color:#aeb6cf;
      text-align:center;
    }
    footer a{
      color:#ffd54f;
      text-decoration:none;
      font-weight:600;
    }
    footer a:hover{
      color:#fff6b0;
      text-shadow:0 0 10px rgba(255,255,120,.6);
    }

    /* MODAL (ZOOM) */
    .card-modal{
      position:fixed;
      inset:0;
      display:flex;
      justify-content:center;
      align-items:center;
      pointer-events:none;
      opacity:0;
      transition:opacity .25s ease;
      z-index:50;
    }
    .card-modal.open{
      opacity:1;
      pointer-events:auto;
    }
    .card-modal-backdrop{
      position:absolute;
      inset:0;
      background:rgba(4,6,20,.85);
      backdrop-filter:blur(8px);
    }
    .card-modal-content{
      position:relative;
      z-index:2;
      width:min(420px,90vw);
      border-radius:18px;
      padding:16px;
      background:radial-gradient(circle at top,#2e376e,#050818);
      border:1px solid rgba(255,255,255,.2);
      box-shadow:0 0 40px rgba(0,0,0,.8);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .card-modal-main{
      display:flex;
      gap:12px;
    }
    .card-modal-img-wrap{
      flex:0 0 130px;
      border-radius:14px;
      overflow:hidden;
      border:1px solid rgba(247,232,176,.6);
      box-shadow:0 10px 25px rgba(0,0,0,.7);
    }
    .card-modal-img-wrap img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .card-modal-text{
      flex:1;
      font-size:13px;
      color:#dfe6ff;
      line-height:1.6;
    }
    .card-modal-title{
      font-size:16px;
      font-weight:700;
      color:#ffe58a;
      margin-bottom:4px;
    }
    .card-modal-pos{
      font-size:12px;
      color:#bfc7ff;
      margin-bottom:6px;
    }
    .card-modal-vibe{
      font-size:12px;
      color:#f5f1ff;
      font-style:italic;
      margin-bottom:4px;
    }
    .card-modal-close{
      border:0;
      border-radius:999px;
      padding:4px 10px;
      font-size:12px;
      align-self:flex-end;
      cursor:pointer;
      background:rgba(255,255,255,.12);
      color:#fff;
    }
  </style>
</head>
<body>
  <!-- TOP BAR -->
  <div class="topbar">
    <div class="top-left">
      <button class="lang-btn flag-en" id="btn-en"></button>
      <button class="lang-btn flag-tr" id="btn-tr"></button>
    </div>
    <div class="top-right">
      <span class="user-label" id="userLabel"></span>
      <button class="nav-btn" id="backBtn">â¬… App</button>
      <button class="nav-btn" id="logoutBtn">Logout</button>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="wrapper">
    <div class="card-shell">
      <!-- LEFT SIDE -->
      <div>
        <h1 class="section-title" id="title">AI Tarot Reading</h1>
        <p class="section-sub" id="subtitle">
          Select three cards for your <span>Past â€“ Present â€“ Future</span> and share your intention. MystAI will interpret the full spread in a mystical but clear way.
        </p>

        <div class="label" id="labelCards">Choose 3 Cards (Past â€“ Present â€“ Future)</div>
        <div class="tarot-row" id="tarotRow">
          <!-- PAST -->
          <div class="tarot-card" data-pos="past">
            <div class="card-inner">
              <div class="card-face card-front"></div>
              <div class="card-face card-back">
                <div class="card-frame">
                  <div class="card-illus">
                    <img data-role="card-img" src="" alt="" />
                    
                  </div>
                
                </div>
                <div class="card-meta">
                <div class="card-meta-name" data-role="meta-name"></div>
                <div class="card-meta-pos" data-role="meta-pos"></div>

                </div>
              </div>
            </div>
          </div>

          <!-- PRESENT -->
          <div class="tarot-card" data-pos="present">
            <div class="card-inner">
              <div class="card-face card-front"></div>
              <div class="card-face card-back">
                <div class="card-frame">
                  <div class="card-illus">
                    <img data-role="card-img" src="" alt="" />
                    <span class="card-illus-label" data-role="illus-text"></span>
                  </div>
                  <div class="card-caption" data-role="caption"></div>
                </div>
                <div class="card-meta">
                  <div class="card-meta-name" data-role="name"></div>
                  <div class="card-meta-pos"  data-role="pos"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- FUTURE -->
          <div class="tarot-card" data-pos="future">
            <div class="card-inner">
              <div class="card-face card-front"></div>
              <div class="card-face card-back">
                <div class="card-frame">
                  <div class="card-illus">
                    <img data-role="card-img" src="" alt="" />
                    <span class="card-illus-label" data-role="illus-text"></span>
                  </div>
                  <div class="card-caption" data-role="caption"></div>
                </div>
                <div class="card-meta">
                  <div class="card-meta-name" data-role="name"></div>
                  <div class="card-meta-pos"  data-role="pos"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card-hint" id="cardHint">
          Click each card one by one. The golden MystAI backs will flip and reveal your tarot archetypes.
        </div>

        <div class="label" id="labelQuestion">Your Question / Intention</div>
        <textarea id="tarotQuestion"
          placeholder="Write what youâ€™d like MystAI to focus on (love, relationships, career, spiritual path...)"></textarea>

        <button class="primary-btn" id="readBtn" disabled>
          ðŸ”® <span id="readBtnText">Reveal My Tarot Reading</span>
        </button>

        <div class="status" id="statusText"></div>
      </div>

      <!-- RIGHT SIDE -->
      <div class="result-box">
        <div class="result-header">
          <div class="result-title" id="resultTitle">Your Tarot Spread</div>
          <button class="audio-btn" id="listenBtn" disabled>
            ðŸ”Š <span id="listenLabel">Listen</span>
          </button>
        </div>
        <div class="spread-labels">
          <span id="lblPast">Past</span>
          <span id="lblPresent">Present</span>
          <span id="lblFuture">Future</span>
        </div>
        <div class="result-content" id="resultText">
          âœ¨ After you choose 3 cards and send your intention, MystAI will reveal your tarot reading here. âœ¨
        </div>
        <div class="result-hint" id="resultHint">
          MystAI is an AI-based entertainment tool and should not be taken as professional or medical advice.
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>
      Â© 2025 MystAI.ai â€” <span id="rightsLabel">All Rights Reserved.</span>
      <span id="devLabel">Developed by GALAXY ðŸŒŒ</span><br />
      <span id="contactLabel">Contact us:</span>
      <a href="mailto:support@mystai.ai">support@mystai.ai</a>
    </p>
  </footer>

  <!-- AI voice for yorum -->
  <audio id="audioPlayer" style="display:none;"></audio>
  <!-- Kart flip sesi (istersen assets/sounds/flip.mp3 ekleyebilirsin) -->
  <audio id="flipSound" src="assets/sounds/flip.mp3" style="display:none;"></audio>

  <!-- KART ZOOM MODAL -->
  <div class="card-modal" id="cardModal">
    <div class="card-modal-backdrop"></div>
    <div class="card-modal-content">
      <div class="card-modal-main">
        <div class="card-modal-img-wrap">
          <img data-modal-img src="" alt="" />
        </div>
        <div class="card-modal-text">
          <div class="card-modal-title" data-modal-title></div>
          <div class="card-modal-pos" data-modal-pos></div>
          <div class="card-modal-vibe" data-modal-vibe></div>
          <div data-modal-body>
            <span style="font-size:11px;color:#9ea6e9;">
              (Bu kartÄ±n detaylÄ± anlamÄ± tarot yorumunun iÃ§inde AI tarafÄ±ndan aÃ§Ä±klanÄ±r.)
            </span>
          </div>
        </div>
      </div>
      <button class="card-modal-close" id="cardModalClose">âœ•</button>
    </div>
  </div>

  <script type="module">
    const BACKEND_URL = "https://mystai-international.onrender.com";

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDyiD7GAfOjMbtm-S6pO6XCSRXJclffPL0",
      authDomain: "mystai-6cca2.firebaseapp.com",
      projectId: "mystai-6cca2",
      storageBucket: "mystai-6cca2.appspot.com",
      messagingSenderId: "624127781219",
      appId: "1:624127781219:web:a580ac6e80ccc26e694b56"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    /* ====== ELEMENTLER ====== */
    const btnEn       = document.getElementById("btn-en");
    const btnTr       = document.getElementById("btn-tr");
    const backBtn     = document.getElementById("backBtn");
    const logoutBtn   = document.getElementById("logoutBtn");
    const userLabel   = document.getElementById("userLabel");

    const titleEl     = document.getElementById("title");
    const subtitleEl  = document.getElementById("subtitle");
    const labelCards  = document.getElementById("labelCards");
    const cardHint    = document.getElementById("cardHint");
    const labelQuestion = document.getElementById("labelQuestion");
    const tarotQuestion = document.getElementById("tarotQuestion");
    const readBtn     = document.getElementById("readBtn");
    const readBtnText = document.getElementById("readBtnText");
    const statusText  = document.getElementById("statusText");

    const resultTitle = document.getElementById("resultTitle");
    const resultText  = document.getElementById("resultText");
    const resultHint  = document.getElementById("resultHint");
    const listenBtn   = document.getElementById("listenBtn");
    const listenLabel = document.getElementById("listenLabel");
    const audioPlayer = document.getElementById("audioPlayer");

    const flipSound   = document.getElementById("flipSound");

    const rightsLabel  = document.getElementById("rightsLabel");
    const devLabel     = document.getElementById("devLabel");
    const contactLabel = document.getElementById("contactLabel");

    const lblPast    = document.getElementById("lblPast");
    const lblPresent = document.getElementById("lblPresent");
    const lblFuture  = document.getElementById("lblFuture");

    const tarotRow   = document.getElementById("tarotRow");
    const cardElems  = Array.from(tarotRow.querySelectorAll(".tarot-card"));

    const cardModal        = document.getElementById("cardModal");
    const cardModalClose   = document.getElementById("cardModalClose");
    const cardModalImg     = cardModal.querySelector("[data-modal-img]");
    const cardModalTitle   = cardModal.querySelector("[data-modal-title]");
    const cardModalPos     = cardModal.querySelector("[data-modal-pos]");
    const cardModalVibe    = cardModal.querySelector("[data-modal-vibe]");
    const cardModalBackdrop= cardModal.querySelector(".card-modal-backdrop");

    /* ====== 78 KART DESTESÄ° ====== */
    const TAROT_DECK = [
      // Major Arcana
      { key:"the-fool",            en:"The Fool",            tr:"Deli",            img:"assets/cards/the-fool.png",            vibe_en:"new beginnings, leap of faith",             vibe_tr:"yeni baÅŸlangÄ±Ã§lar, saf sÄ±Ã§rayÄ±ÅŸ" },
      { key:"the-magician",        en:"The Magician",        tr:"BÃ¼yÃ¼cÃ¼",          img:"assets/cards/the-magician.png",        vibe_en:"manifestation, focus",                      vibe_tr:"yaratÄ±m gÃ¼cÃ¼, odak" },
      { key:"the-high-priestess",  en:"The High Priestess",  tr:"BaÅŸrahibe",       img:"assets/cards/the-high-priestess.png",  vibe_en:"intuition, mystery",                        vibe_tr:"sezgi, gizem" },
      { key:"the-empress",         en:"The Empress",         tr:"Ä°mparatoriÃ§e",    img:"assets/cards/the-empress.png",         vibe_en:"abundance, nurture",                        vibe_tr:"bolluk, ÅŸefkat" },
      { key:"the-emperor",         en:"The Emperor",         tr:"Ä°mparator",       img:"assets/cards/the-emperor.png",         vibe_en:"structure, authority",                      vibe_tr:"dÃ¼zen, otorite" },
      { key:"the-hierophant",      en:"The Hierophant",      tr:"BaÅŸrahip",        img:"assets/cards/the-hierophant.png",      vibe_en:"tradition, guidance",                       vibe_tr:"gelenek, rehberlik" },
      { key:"the-lovers",          en:"The Lovers",          tr:"AÅŸÄ±klar",         img:"assets/cards/the-lovers.png",          vibe_en:"union, choice",                             vibe_tr:"baÄŸlantÄ±, seÃ§im" },
      { key:"the-chariot",         en:"The Chariot",         tr:"SavaÅŸ ArabasÄ±",   img:"assets/cards/the-chariot.png",         vibe_en:"willpower, movement",                       vibe_tr:"irade, ilerleyiÅŸ" },
      { key:"strength",            en:"Strength",            tr:"GÃ¼Ã§",             img:"assets/cards/strength.png",            vibe_en:"inner strength, courage",                   vibe_tr:"iÃ§sel gÃ¼Ã§, cesaret" },
      { key:"the-hermit",          en:"The Hermit",          tr:"ErmiÅŸ",           img:"assets/cards/the-hermit.png",          vibe_en:"wisdom, retreat",                           vibe_tr:"bilgelik, iÃ§e dÃ¶nÃ¼ÅŸ" },
      { key:"wheel-of-fortune",    en:"Wheel of Fortune",    tr:"Kader Ã‡arkÄ±",     img:"assets/cards/wheel-of-fortune.png",    vibe_en:"cycles, destiny",                           vibe_tr:"dÃ¶ngÃ¼ler, kader" },
      { key:"justice",             en:"Justice",             tr:"Adalet",          img:"assets/cards/justice.png",             vibe_en:"truth, balance",                            vibe_tr:"gerÃ§ek, denge" },
      { key:"the-hanged-man",      en:"The Hanged Man",      tr:"AsÄ±lan Adam",     img:"assets/cards/the-hanged-man.png",      vibe_en:"surrender, new view",                       vibe_tr:"teslimiyet, yeni bakÄ±ÅŸ" },
      { key:"death",               en:"Death",               tr:"Ã–lÃ¼m",            img:"assets/cards/death.png",               vibe_en:"transformation, rebirth",                   vibe_tr:"dÃ¶nÃ¼ÅŸÃ¼m, yeniden doÄŸuÅŸ" },
      { key:"temperance",          en:"Temperance",          tr:"Denge",           img:"assets/cards/temperance.png",          vibe_en:"alchemic balance",                          vibe_tr:"denge, uyum" },
      { key:"the-devil",           en:"The Devil",           tr:"Åžeytan",          img:"assets/cards/the-devil.png",           vibe_en:"attachments, shadow",                       vibe_tr:"baÄŸÄ±mlÄ±lÄ±klar, gÃ¶lge" },
      { key:"the-tower",           en:"The Tower",           tr:"Kule",            img:"assets/cards/the-tower.png",           vibe_en:"sudden change, awakening",                  vibe_tr:"ani deÄŸiÅŸim, uyanÄ±ÅŸ" },
      { key:"the-star",            en:"The Star",            tr:"YÄ±ldÄ±z",          img:"assets/cards/the-star.png",            vibe_en:"hope, inspiration",                         vibe_tr:"umut, ilham" },
      { key:"the-moon",            en:"The Moon",            tr:"Ay",              img:"assets/cards/the-moon.png",            vibe_en:"subconscious, illusions",                   vibe_tr:"bilinÃ§altÄ±, yanÄ±lsamalar" },
      { key:"the-sun",             en:"The Sun",             tr:"GÃ¼neÅŸ",           img:"assets/cards/the-sun.png",             vibe_en:"vitality, joy",                             vibe_tr:"yaÅŸam enerjisi, neÅŸe" },
      { key:"judgement",           en:"Judgement",           tr:"YargÄ±",           img:"assets/cards/judgement.png",           vibe_en:"awakening, calling",                        vibe_tr:"uyanÄ±ÅŸ, Ã§aÄŸrÄ±" },
      { key:"the-world",           en:"The World",           tr:"DÃ¼nya",           img:"assets/cards/the-world.png",           vibe_en:"completion, wholeness",                     vibe_tr:"tamamlanma, bÃ¼tÃ¼nlÃ¼k" },

      // Cups
      { key:"ace-of-cups",     en:"Ace of Cups",     tr:"As Kupalar",       img:"assets/cards/ace-of-cups.png",     vibe_en:"emotions, new feelings",          vibe_tr:"duygular, yeni hisler" },
      { key:"two-of-cups",     en:"Two of Cups",     tr:"Ä°ki Kupalar",      img:"assets/cards/two-of-cups.png",     vibe_en:"union, attraction",               vibe_tr:"birlik, Ã§ekim" },
      { key:"three-of-cups",   en:"Three of Cups",   tr:"ÃœÃ§ Kupalar",       img:"assets/cards/three-of-cups.png",   vibe_en:"celebration, friendship",         vibe_tr:"kutlama, arkadaÅŸlÄ±k" },
      { key:"four-of-cups",    en:"Four of Cups",    tr:"DÃ¶rt Kupalar",     img:"assets/cards/four-of-cups.png",    vibe_en:"apathy, contemplation",           vibe_tr:"umursamazlÄ±k, iÃ§e dÃ¶nÃ¼ÅŸ" },
      { key:"five-of-cups",    en:"Five of Cups",    tr:"BeÅŸ Kupalar",      img:"assets/cards/five-of-cups.png",    vibe_en:"loss, regret",                    vibe_tr:"kayÄ±p, piÅŸmanlÄ±k" },
      { key:"six-of-cups",     en:"Six of Cups",     tr:"AltÄ± Kupalar",     img:"assets/cards/six-of-cups.png",     vibe_en:"nostalgia, kindness",             vibe_tr:"geÃ§miÅŸ, nezaket" },
      { key:"seven-of-cups",   en:"Seven of Cups",   tr:"Yedi Kupalar",     img:"assets/cards/seven-of-cups.png",   vibe_en:"choices, illusions",              vibe_tr:"seÃ§imler, hayaller" },
      { key:"eight-of-cups",   en:"Eight of Cups",   tr:"Sekiz Kupalar",    img:"assets/cards/eight-of-cups.png",   vibe_en:"walking away, search",            vibe_tr:"Ã§ekilme, arayÄ±ÅŸ" },
      { key:"nine-of-cups",    en:"Nine of Cups",    tr:"Dokuz Kupalar",    img:"assets/cards/nine-of-cups.png",    vibe_en:"wish fulfillment, satisfaction",  vibe_tr:"dileklerin gerÃ§ekleÅŸmesi" },
      { key:"ten-of-cups",     en:"Ten of Cups",     tr:"On Kupalar",       img:"assets/cards/ten-of-cups.png",     vibe_en:"harmony, emotional bliss",        vibe_tr:"uyum, duygusal mutluluk" },
      { key:"page-of-cups",    en:"Page of Cups",    tr:"Prens Kupalar",    img:"assets/cards/page-of-cups.png",    vibe_en:"creative messages, sensitivity",  vibe_tr:"yaratÄ±cÄ± mesajlar, hassasiyet" },
      { key:"knight-of-cups",  en:"Knight of Cups",  tr:"ÅžÃ¶valye Kupalar",  img:"assets/cards/knight-of-cups.png",  vibe_en:"romance, idealism",               vibe_tr:"romantizm, idealizm" },
      { key:"queen-of-cups",   en:"Queen of Cups",   tr:"KraliÃ§e Kupalar",  img:"assets/cards/queen-of-cups.png",   vibe_en:"emotional depth, empathy",        vibe_tr:"duygusal derinlik, empati" },
      { key:"king-of-cups",    en:"King of Cups",    tr:"Kral Kupalar",     img:"assets/cards/king-of-cups.png",    vibe_en:"emotional balance, wisdom",       vibe_tr:"duygusal denge, bilgelik" },

      // Pentacles
      { key:"ace-of-pentacles",    en:"Ace of Pentacles",    tr:"As TÄ±lsÄ±mlar",       img:"assets/cards/ace-of-pentacles.png",    vibe_en:"material opportunity",       vibe_tr:"maddi fÄ±rsat" },
      { key:"two-of-pentacles",    en:"Two of Pentacles",    tr:"Ä°ki TÄ±lsÄ±mlar",      img:"assets/cards/two-of-pentacles.png",    vibe_en:"juggling, balance",          vibe_tr:"denge, Ã§oklu uÄŸraÅŸ" },
      { key:"three-of-pentacles",  en:"Three of Pentacles",  tr:"ÃœÃ§ TÄ±lsÄ±mlar",       img:"assets/cards/three-of-pentacles.png",  vibe_en:"teamwork, skill",            vibe_tr:"takÄ±m Ã§alÄ±ÅŸmasÄ±, ustalÄ±k" },
      { key:"four-of-pentacles",   en:"Four of Pentacles",   tr:"DÃ¶rt TÄ±lsÄ±mlar",     img:"assets/cards/four-of-pentacles.png",   vibe_en:"control, security",          vibe_tr:"kontrol, gÃ¼venlik" },
      { key:"five-of-pentacles",   en:"Five of Pentacles",   tr:"BeÅŸ TÄ±lsÄ±mlar",      img:"assets/cards/five-of-pentacles.png",   vibe_en:"hardship, worry",            vibe_tr:"zorluk, endiÅŸe" },
      { key:"six-of-pentacles",    en:"Six of Pentacles",    tr:"AltÄ± TÄ±lsÄ±mlar",     img:"assets/cards/six-of-pentacles.png",    vibe_en:"giving, receiving",          vibe_tr:"vermek, almak" },
      { key:"seven-of-pentacles",  en:"Seven of Pentacles",  tr:"Yedi TÄ±lsÄ±mlar",     img:"assets/cards/seven-of-pentacles.png",  vibe_en:"patience, investment",       vibe_tr:"sabÄ±r, yatÄ±rÄ±m" },
      { key:"eight-of-pentacles",  en:"Eight of Pentacles",  tr:"Sekiz TÄ±lsÄ±mlar",    img:"assets/cards/eight-of-pentacles.png",  vibe_en:"practice, mastery",          vibe_tr:"pratik, ustalaÅŸma" },
      { key:"nine-of-pentacles",   en:"Nine of Pentacles",   tr:"Dokuz TÄ±lsÄ±mlar",    img:"assets/cards/nine-of-pentacles.png",   vibe_en:"independence, luxury",       vibe_tr:"baÄŸÄ±msÄ±zlÄ±k, konfor" },
      { key:"ten-of-pentacles",    en:"Ten of Pentacles",    tr:"On TÄ±lsÄ±mlar",       img:"assets/cards/ten-of-pentacles.png",    vibe_en:"legacy, long-term stability",vibe_tr:"miras, uzun vadeli istikrar" },
      { key:"page-of-pentacles",   en:"Page of Pentacles",   tr:"Prens TÄ±lsÄ±mlar",    img:"assets/cards/page-of-pentacles.png",   vibe_en:"study, opportunity",         vibe_tr:"Ã¶ÄŸrenme, fÄ±rsat" },
      { key:"knight-of-pentacles", en:"Knight of Pentacles", tr:"ÅžÃ¶valye TÄ±lsÄ±mlar",  img:"assets/cards/knight-of-pentacles.png", vibe_en:"responsibility, routine",    vibe_tr:"sorumluluk, rutin" },
      { key:"queen-of-pentacles",  en:"Queen of Pentacles",  tr:"KraliÃ§e TÄ±lsÄ±mlar",  img:"assets/cards/queen-of-pentacles.png",  vibe_en:"nurturing, practicality",    vibe_tr:"ÅŸefkat, pratiklik" },
      { key:"king-of-pentacles",   en:"King of Pentacles",   tr:"Kral TÄ±lsÄ±mlar",     img:"assets/cards/king-of-pentacles.png",   vibe_en:"wealth, discipline",         vibe_tr:"zenginlik, disiplin" },

      // Swords
      { key:"ace-of-swords",    en:"Ace of Swords",    tr:"As KÄ±lÄ±Ã§lar",       img:"assets/cards/ace-of-swords.png",    vibe_en:"mental clarity, breakthrough",   vibe_tr:"zihinsel netlik, atÄ±lÄ±m" },
      { key:"two-of-swords",    en:"Two of Swords",    tr:"Ä°ki KÄ±lÄ±Ã§lar",      img:"assets/cards/two-of-swords.png",    vibe_en:"stalemate, decision",            vibe_tr:"kararsÄ±zlÄ±k, ikilem" },
      { key:"three-of-swords",  en:"Three of Swords",  tr:"ÃœÃ§ KÄ±lÄ±Ã§lar",       img:"assets/cards/three-of-swords.png",  vibe_en:"heartbreak, truth",              vibe_tr:"kalp kÄ±rÄ±klÄ±ÄŸÄ±, gerÃ§ek" },
      { key:"four-of-swords",   en:"Four of Swords",   tr:"DÃ¶rt KÄ±lÄ±Ã§lar",     img:"assets/cards/four-of-swords.png",   vibe_en:"rest, recovery",                 vibe_tr:"dinlenme, toparlanma" },
      { key:"five-of-swords",   en:"Five of Swords",   tr:"BeÅŸ KÄ±lÄ±Ã§lar",      img:"assets/cards/five-of-swords.png",   vibe_en:"conflict, tension",              vibe_tr:"Ã§atÄ±ÅŸma, gerginlik" },
      { key:"six-of-swords",    en:"Six of Swords",    tr:"AltÄ± KÄ±lÄ±Ã§lar",     img:"assets/cards/six-of-swords.png",    vibe_en:"transition, moving on",          vibe_tr:"geÃ§iÅŸ, yola devam" },
      { key:"seven-of-swords",  en:"Seven of Swords",  tr:"Yedi KÄ±lÄ±Ã§lar",     img:"assets/cards/seven-of-swords.png",  vibe_en:"strategy, secrecy",              vibe_tr:"strateji, gizlilik" },
      { key:"eight-of-swords",  en:"Eight of Swords",  tr:"Sekiz KÄ±lÄ±Ã§lar",    img:"assets/cards/eight-of-swords.png",  vibe_en:"restriction, fear",              vibe_tr:"kÄ±sÄ±tlama, korku" },
      { key:"nine-of-swords",   en:"Nine of Swords",   tr:"Dokuz KÄ±lÄ±Ã§lar",    img:"assets/cards/nine-of-swords.png",   vibe_en:"anxiety, worry",                 vibe_tr:"anksiyete, kaygÄ±" },
      { key:"ten-of-swords",    en:"Ten of Swords",    tr:"On KÄ±lÄ±Ã§lar",       img:"assets/cards/ten-of-swords.png",    vibe_en:"endings, rock bottom",           vibe_tr:"bitiriÅŸ, dip nokta" },
      { key:"page-of-swords",   en:"Page of Swords",   tr:"Prens KÄ±lÄ±Ã§lar",    img:"assets/cards/page-of-swords.png",   vibe_en:"curiosity, ideas",               vibe_tr:"merak, fikirler" },
      { key:"knight-of-swords", en:"Knight of Swords", tr:"ÅžÃ¶valye KÄ±lÄ±Ã§lar",  img:"assets/cards/knight-of-swords.png", vibe_en:"fast action, drive",             vibe_tr:"hÄ±zlÄ± hareket, kararlÄ±lÄ±k" },
      { key:"queen-of-swords",  en:"Queen of Swords",  tr:"KraliÃ§e KÄ±lÄ±Ã§lar",  img:"assets/cards/queen-of-swords.png",  vibe_en:"clarity, boundaries",            vibe_tr:"netlik, sÄ±nÄ±rlar" },
      { key:"king-of-swords",   en:"King of Swords",   tr:"Kral KÄ±lÄ±Ã§lar",     img:"assets/cards/king-of-swords.png",   vibe_en:"logic, truth",                   vibe_tr:"mantÄ±k, gerÃ§ek" },

      // Wands
      { key:"ace-of-wands",    en:"Ace of Wands",    tr:"As DeÄŸnekler",       img:"assets/cards/ace-of-wands.png",    vibe_en:"spark, inspiration",         vibe_tr:"kÄ±vÄ±lcÄ±m, ilham" },
      { key:"two-of-wands",    en:"Two of Wands",    tr:"Ä°ki DeÄŸnekler",      img:"assets/cards/two-of-wands.png",    vibe_en:"planning, foresight",        vibe_tr:"planlama, Ã¶ngÃ¶rÃ¼" },
      { key:"three-of-wands",  en:"Three of Wands",  tr:"ÃœÃ§ DeÄŸnekler",       img:"assets/cards/three-of-wands.png",  vibe_en:"expansion, progress",        vibe_tr:"geniÅŸleme, ilerleme" },
      { key:"four-of-wands",   en:"Four of Wands",   tr:"DÃ¶rt DeÄŸnekler",     img:"assets/cards/four-of-wands.png",   vibe_en:"celebration, home",          vibe_tr:"kutlama, yuva" },
      { key:"five-of-wands",   en:"Five of Wands",   tr:"BeÅŸ DeÄŸnekler",      img:"assets/cards/five-of-wands.png",   vibe_en:"competition, tension",       vibe_tr:"rekabet, gerilim" },
      { key:"six-of-wands",    en:"Six of Wands",    tr:"AltÄ± DeÄŸnekler",     img:"assets/cards/six-of-wands.png",    vibe_en:"victory, recognition",       vibe_tr:"zafer, takdir" },
      { key:"seven-of-wands",  en:"Seven of Wands",  tr:"Yedi DeÄŸnekler",     img:"assets/cards/seven-of-wands.png",  vibe_en:"defense, standing ground",   vibe_tr:"savunma, direnÃ§" },
      { key:"eight-of-wands",  en:"Eight of Wands",  tr:"Sekiz DeÄŸnekler",    img:"assets/cards/eight-of-wands.png",  vibe_en:"speed, movement",            vibe_tr:"hÄ±z, akÄ±ÅŸ" },
      { key:"nine-of-wands",   en:"Nine of Wands",   tr:"Dokuz DeÄŸnekler",    img:"assets/cards/nine-of-wands.png",   vibe_en:"resilience, persistence",    vibe_tr:"direnÃ§, dayanÄ±klÄ±lÄ±k" },
      { key:"ten-of-wands",    en:"Ten of Wands",    tr:"On DeÄŸnekler",       img:"assets/cards/ten-of-wands.png",    vibe_en:"burden, responsibility",     vibe_tr:"yÃ¼k, sorumluluk" },
      { key:"page-of-wands",   en:"Page of Wands",   tr:"Prens DeÄŸnekler",    img:"assets/cards/page-of-wands.png",   vibe_en:"exploration, enthusiasm",    vibe_tr:"keÅŸif, heves" },
      { key:"knight-of-wands", en:"Knight of Wands", tr:"ÅžÃ¶valye DeÄŸnekler",  img:"assets/cards/knight-of-wands.png", vibe_en:"impulse, adventure",         vibe_tr:"dÃ¼rtÃ¼, macera" },
      { key:"queen-of-wands",  en:"Queen of Wands",  tr:"KraliÃ§e DeÄŸnekler",  img:"assets/cards/queen-of-wands.png",  vibe_en:"magnetism, confidence",      vibe_tr:"Ã§ekicilik, Ã¶zgÃ¼ven" },
      { key:"king-of-wands",   en:"King of Wands",   tr:"Kral DeÄŸnekler",     img:"assets/cards/king-of-wands.png",   vibe_en:"vision, leadership",         vibe_tr:"vizyon, liderlik" }
    ];

    /* ====== i18n ====== */
    const i18n = {
      en:{
        title:"AI Tarot Reading",
        subtitle:"Select three cards for your Past â€“ Present â€“ Future and share your intention. MystAI will read your full spread with mystical clarity.",
        cardsLabel:"Choose 3 Cards (Past â€“ Present â€“ Future)",
        cardHint:"Click each card one by one. The golden MystAI backs will flip and reveal your tarot archetypes.",
        questionLabel:"Your Question / Intention",
        placeholder:"Write what youâ€™d like MystAI to focus on (love, relationships, career, spiritual path...)",
        btnText:"Reveal My Tarot Reading",
        statusIdle:"",
        statusNeedCards:"Please select 3 cards first.",
        statusNeedText:"Please write at least a short question or intention.",
        statusLoading:"Shuffling the deck and reading your spread...",
        statusDone:"Your tarot reading is ready.",
        statusError:"An error occurred. Please try again.",
        userWelcome:"Welcome, ",
        resultTitle:"Your Tarot Spread",
        resultInitial:"âœ¨ After you choose 3 cards and send your intention, MystAI will reveal your tarot reading here. âœ¨",
        resultHint:"MystAI is an AI-based entertainment tool and should not be taken as professional or medical advice.",
        listen:"Listen",
        listening:"Playing...",
        back:"Back to App",
        logout:"Logout",
        lblPast:"Past",
        lblPresent:"Present",
        lblFuture:"Future",
        rights:"All Rights Reserved.",
        dev:"Developed by GALAXY ðŸŒŒ",
        contact:"Contact us:"
      },
      tr:{
        title:"Yapay ZekÃ¢ Tarot AÃ§Ä±lÄ±mÄ±",
        subtitle:"GeÃ§miÅŸ â€“ Åžimdi â€“ Gelecek iÃ§in Ã¼Ã§ kart seÃ§ ve niyetini yaz. MystAI, tÃ¼m aÃ§Ä±lÄ±mÄ±nÄ± mistik ama net bir dille yorumlasÄ±n.",
        cardsLabel:"3 Kart SeÃ§ (GeÃ§miÅŸ â€“ Åžimdi â€“ Gelecek)",
        cardHint:"Kartlara teker teker tÄ±kla. AltÄ±n MystAI sÄ±rtlarÄ± dÃ¶necek ve senin iÃ§in seÃ§ilen tarot arketiplerini gÃ¶sterecek.",
        questionLabel:"Sorun / Niyetin",
        placeholder:"AÅŸk, iliÅŸkiler, kariyer veya ruhsal yolculuÄŸunla ilgili merak ettiklerini buraya yaz...",
        btnText:"Tarot AÃ§Ä±lÄ±mÄ±mÄ± GÃ¶ster",
        statusIdle:"",
        statusNeedCards:"LÃ¼tfen Ã¶nce 3 kart seÃ§.",
        statusNeedText:"LÃ¼tfen en azÄ±ndan kÄ±sa bir soru veya niyet yaz.",
        statusLoading:"Deste karÄ±lÄ±yor, enerjin tarot kartlarÄ±na yansÄ±yor...",
        statusDone:"Tarot aÃ§Ä±lÄ±mÄ±n hazÄ±r.",
        statusError:"Bir hata oluÅŸtu. LÃ¼tfen tekrar dene.",
        userWelcome:"HoÅŸ geldin, ",
        resultTitle:"Tarot AÃ§Ä±lÄ±mÄ±n",
        resultInitial:"âœ¨ 3 kartÄ±nÄ± seÃ§ip niyetini yazdÄ±ktan sonra yapay zekÃ¢ tarot yorumun burada gÃ¶rÃ¼necek. âœ¨",
        resultHint:"MystAI eÄŸlence amaÃ§lÄ± bir yapay zekÃ¢ fal yorumlayÄ±cÄ±sÄ±dÄ±r; profesyonel veya tÄ±bbi tavsiye yerine geÃ§mez.",
        listen:"Dinle",
        listening:"Ã‡alÄ±yor...",
        back:"Uygulamaya DÃ¶n",
        logout:"Ã‡Ä±kÄ±ÅŸ Yap",
        lblPast:"GeÃ§miÅŸ",
        lblPresent:"Åžimdi",
        lblFuture:"Gelecek",
        rights:"TÃ¼m HaklarÄ± SaklÄ±dÄ±r.",
        dev:"GALAXY tarafÄ±ndan geliÅŸtirilmiÅŸtir ðŸŒŒ",
        contact:"Ä°letiÅŸim:"
      }
    };

    let activeLang     = localStorage.getItem("myst_lang") || "en";
    let selectedCards  = {}; // {past:{card,posText}, ...}

    function applyLang(lang){
      activeLang = lang;
      localStorage.setItem("myst_lang",lang);
      const t = i18n[lang];

      titleEl.textContent       = t.title;
      subtitleEl.textContent    = t.subtitle;
      labelCards.textContent    = t.cardsLabel;
      cardHint.textContent      = t.cardHint;
      labelQuestion.textContent = t.questionLabel;
      tarotQuestion.placeholder = t.placeholder;
      readBtnText.textContent   = t.btnText;
      resultTitle.textContent   = t.resultTitle;
      resultText.textContent    = t.resultInitial;
      resultHint.textContent    = t.resultHint;
      listenLabel.textContent   = t.listen;
      rightsLabel.textContent   = t.rights;
      devLabel.textContent      = t.dev;
      contactLabel.textContent  = t.contact;
      backBtn.textContent       = "â¬… " + t.back;
      logoutBtn.textContent     = t.logout;
      lblPast.textContent       = t.lblPast;
      lblPresent.textContent    = t.lblPresent;
      lblFuture.textContent     = t.lblFuture;

      btnEn.classList.toggle("active",lang==="en");
      btnTr.classList.toggle("active",lang==="tr");

      if(auth.currentUser){
        const name = auth.currentUser.displayName || auth.currentUser.email;
        userLabel.textContent = t.userWelcome + name;
      }

      Object.entries(selectedCards).forEach(([slot, info])=>{
        const posText = getPositionText(slot);
        info.posText  = posText;
        const cardEl  = tarotRow.querySelector(`.tarot-card[data-pos="${slot}"]`);
        if(cardEl){
          const posEl = cardEl.querySelector('[data-role="pos"]');
          if(posEl) posEl.textContent = posText;
        }
      });
    }

    btnEn.addEventListener("click",()=>applyLang("en"));
    btnTr.addEventListener("click",()=>applyLang("tr"));

    backBtn.addEventListener("click",()=>{ window.location.href="app.html"; });
    logoutBtn.addEventListener("click",()=>{ signOut(auth).then(()=>window.location.href="login.html"); });

    onAuthStateChanged(auth,(user)=>{
      if(!user){
        window.location.href="login.html";
        return;
      }
      const t = i18n[activeLang];
      const name = user.displayName || user.email;
      userLabel.textContent = t.userWelcome + name;
    });

    applyLang(activeLang);

    /* ====== TAROT LOGÄ°ÄžÄ° ====== */

    function getPositionText(slot){
      if(slot==="past")    return activeLang==="tr" ? "GeÃ§miÅŸ Enerji" : "Past energy";
      if(slot==="present") return activeLang==="tr" ? "Åžu Anki Durum" : "Current situation";
      return activeLang==="tr" ? "Gelecek Potansiyeli" : "Future potential";
    }

    function getCaptionText(card){
      return activeLang==="tr" ? card.vibe_tr : card.vibe_en;
    }

    function drawRandomCard(){
      const usedKeys = new Set(Object.values(selectedCards).map(info=>info.card.key));
      const remaining = TAROT_DECK.filter(c=>!usedKeys.has(c.key));
      if(!remaining.length) return null;
      const idx = Math.floor(Math.random()*remaining.length);
      return remaining[idx];
    }

    function updateReadButtonState(){
      const t = i18n[activeLang];
      const slots = ["past","present","future"];
      const allSelected = slots.every(s=>selectedCards[s]);
      readBtn.disabled = !allSelected;
      statusText.textContent = allSelected ? t.statusIdle : t.statusNeedCards;
    }

    function openCardModal(slot){
      const info = selectedCards[slot];
      if(!info) return;
      const c = info.card;
      const cardName = activeLang==="tr" ? c.tr : c.en;
      const posText  = getPositionText(slot);
      const vibe     = getCaptionText(c);

      cardModalImg.src   = c.img || "assets/cards/back.png";
      cardModalImg.alt   = cardName;
      cardModalTitle.textContent = cardName;
      cardModalPos.textContent   = posText;
      cardModalVibe.textContent  = vibe;
      cardModal.classList.add("open");
    }

    function closeCardModal(){
      cardModal.classList.remove("open");
    }

    cardModalClose.addEventListener("click",closeCardModal);
    cardModalBackdrop.addEventListener("click",closeCardModal);

    cardElems.forEach(card=>{
      card.addEventListener("click",()=>{
        const slot = card.getAttribute("data-pos"); // past / present / future

        if(!selectedCards[slot]){
          // ilk tÄ±klama â†’ kart seÃ§imi
          const cardData = drawRandomCard();
          if(!cardData) return;

          const posText   = getPositionText(slot);
          const caption   = getCaptionText(cardData);
          const nameText  = activeLang==="tr" ? cardData.tr : cardData.en;

          selectedCards[slot] = { card: cardData, posText };

          const nameEl    = card.querySelector('[data-role="name"]');
          const posEl     = card.querySelector('[data-role="pos"]');
          const illusText = card.querySelector('[data-role="illus-text"]');
          const captionEl = card.querySelector('[data-role="caption"]');
          const imgEl     = card.querySelector('[data-role="card-img"]');

          if(nameEl)    nameEl.textContent    = nameText;
          if(posEl)     posEl.textContent     = posText;
          if(illusText) illusText.textContent = caption;
          if(captionEl) captionEl.textContent = nameText.toUpperCase();
          if(imgEl){
            imgEl.src = cardData.img || "assets/cards/back.png";
            imgEl.alt = nameText;
          }

          card.classList.add("flipped","disabled","just-flipped");

          // flip sesi
          try{
            if(flipSound){
              flipSound.currentTime = 0;
              flipSound.play().catch(()=>{});
            }
          }catch(e){}

          setTimeout(()=>card.classList.remove("just-flipped"),600);
          updateReadButtonState();

        }else{
          // ikinci tÄ±klama â†’ zoom modal
          openCardModal(slot);
        }
      });
    });

    /* ====== TAROT READING (BACKEND + FIRESTORE + KARISTIRMA ANÄ°MASYONU) ====== */
    readBtn.addEventListener("click", async ()=>{
      const t    = i18n[activeLang];
      const user = auth.currentUser;
      if(!user){
        alert(activeLang==="tr" ? "LÃ¼tfen Ã¶nce giriÅŸ yap." : "Please log in first.");
        return;
      }

      const slots = ["past","present","future"];
      const allSelected = slots.every(s=>selectedCards[s]);
      if(!allSelected){
        alert(t.statusNeedCards);
        return;
      }

      const question = tarotQuestion.value.trim();
      if(!question){
        alert(t.statusNeedText);
        return;
      }

      // karÄ±ÅŸtÄ±rma animasyonu
      tarotRow.classList.add("shuffling");
      setTimeout(()=>tarotRow.classList.remove("shuffling"),800);

      readBtn.disabled = true;
      statusText.textContent = t.statusLoading;
      resultText.textContent = "";
      listenBtn.disabled = true;
      audioPlayer.pause();
      audioPlayer.currentTime = 0;
      audioPlayer.src = "";

      try{
        if(!BACKEND_URL || BACKEND_URL.includes("YOUR-BACKEND-URL")){
          statusText.textContent = "Backend URL is not configured.";
          readBtn.disabled = false;
          return;
        }

        const cardsDescription = slots.map(slot=>{
          const info = selectedCards[slot];
          const c    = info.card;
          const label = (
            slot==="past"    ? (activeLang==="tr"?"GeÃ§miÅŸ":"Past") :
            slot==="present" ? (activeLang==="tr"?"Åžimdi":"Present") :
                               (activeLang==="tr"?"Gelecek":"Future")
          );
          const cardName = activeLang==="tr" ? c.tr : c.en;
          const vibe     = getCaptionText(c);
          return `${label}: ${cardName} â€“ ${vibe}`;
        }).join("\n");

        const headerText = activeLang==="tr"
          ? "Bu bir tarot aÃ§Ä±lÄ±mÄ±dÄ±r. GeÃ§miÅŸâ€“Åžimdiâ€“Gelecek iÃ§in seÃ§ilen kartlarÄ± ve kullanÄ±cÄ±nÄ±n sorusunu, mistik ama net ve detaylÄ± bir dille yorumla."
          : "This is a tarot spread. Interpret the Pastâ€“Presentâ€“Future cards and the user's question in a mystical, warm and detailed way.";

        const userText =
          headerText + "\n\n" +
          (activeLang==="tr" ? "Kartlar:\n" : "Cards:\n") +
          cardsDescription + "\n\n" +
          (activeLang==="tr" ? "KullanÄ±cÄ±nÄ±n sorusu/niyeti: " : "User's question/intention: ") +
          question;

        const res = await fetch(`${BACKEND_URL}/predict`,{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ user_input: userText })
        });

        if(!res.ok){
          throw new Error("HTTP " + res.status);
        }

        const data  = await res.json();
        const text  = data?.text  || (activeLang==="tr" ? "YanÄ±t alÄ±namadÄ±." : "No response.");
        const audio = data?.audio;

        resultText.textContent = text;
        statusText.textContent = t.statusDone;

        try{
          await addDoc(collection(db,"fortunes"),{
            user: user.email,
            type: "AI Tarot Reading",
            question,
            result: text,
            cards: {
              past:    selectedCards.past?.card?.key    || null,
              present: selectedCards.present?.card?.key || null,
              future:  selectedCards.future?.card?.key  || null
            },
            createdAt: new Date().toISOString(),
            source: "tarot-page"
          });
        }catch(e){
          console.warn("Firestore save error:",e);
        }

        if(audio){
          const fullURL = audio.startsWith("http") ? audio : `${BACKEND_URL}${audio}`;
          audioPlayer.src = fullURL;
          listenBtn.disabled = false;
        }

      }catch(err){
        console.error(err);
        statusText.textContent = t.statusError;
        resultText.textContent =
          (activeLang==="tr" ? "Hata: " : "Error: ") + (err?.message || String(err));
      }finally{
        readBtn.disabled = false;
      }
    });

    listenBtn.addEventListener("click",()=>{
      if(!audioPlayer.src) return;
      const t = i18n[activeLang];
      listenLabel.textContent = t.listening;
      audioPlayer.play().catch(()=>{});
      audioPlayer.onended = ()=>{ listenLabel.textContent = t.listen; };
    });
  </script>
</body>
</html>
