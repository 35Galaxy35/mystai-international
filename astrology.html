<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MystAI.ai ‚Äî Astrology & Birth Chart</title>
  <link rel="icon" type="image/png" href="mystai-logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-start:#0d1440;
      --bg-end:#0b0f1f;
      --text:#d8e0ff;
      --muted:#a9b4d0;
      --accent:#f2c84b;
      --danger:#ff7676;
    }
    html,body{
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color:var(--text);
      background:radial-gradient(1400px 800px at 50% -10%, #101a4d 0%, #0b0f1f 85%);
      overflow-x:hidden;
    }

    header{
      position:relative;
      padding:14px 40px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:rgba(10,15,30,0.45);
      backdrop-filter:blur(14px);
      border-bottom:1px solid rgba(255,255,255,0.07);
      z-index:1000;
    }
    .lang-box,.nav-btns{display:flex;gap:10px;align-items:center;}
    .lang-btn{
      font-weight:700;
      border:0;
      border-radius:50px;
      padding:7px 13px;
      cursor:pointer;
      font-size:13px;
      background:linear-gradient(135deg,#ffd54f,#ffe680);
      color:#111;
      transition:all .3s ease;
    }
    .lang-btn.secondary{
      background:rgba(255,255,255,0.08);
      color:#e6ecff;
      border:1px solid rgba(255,255,255,0.18);
    }
    .btn{
      font-weight:700;
      border:0;
      border-radius:10px;
      padding:8px 18px;
      cursor:pointer;
      color:#0b0f1f;
      background:#ffd54f;
      font-size:14px;
      transition:all .3s ease;
    }
    .btn:hover,.lang-btn:hover{filter:brightness(1.08);transform:translateY(-2px)}

    .welcome{
      font-weight:600;
      color:#ffe680;
      text-shadow:0 0 10px rgba(255,220,120,.4);
      margin-right:12px;
      font-size:13px;
    }

    .floating-logo{
      position:absolute;
      left:50%;
      top:96px;
      transform:translateX(-50%);
      height:150px;
      width:auto;
      pointer-events:none;
      animation:float 6s ease-in-out infinite alternate, glow 6s ease-in-out infinite alternate;
      filter:drop-shadow(0 0 35px rgba(255,230,150,.65)) brightness(1.05);
      z-index:5;
    }
    @keyframes float{from{transform:translate(-50%,-8px)}to{transform:translate(-50%,10px)}}
    @keyframes glow{from{filter:drop-shadow(0 0 25px rgba(255,240,180,.4))}to{filter:drop-shadow(0 0 55px rgba(255,250,200,.8))}}

    main{
      max-width:1200px;
      margin:0 auto;
      padding:260px 20px 80px;
      display:grid;
      grid-template-columns: minmax(0, 420px) minmax(0, 1fr);
      gap:28px;
    }

    .panel{
      background:rgba(7,12,30,0.92);
      border-radius:20px;
      border:1px solid rgba(255,255,255,0.08);
      box-shadow:0 28px 80px rgba(0,0,0,0.5);
      padding:22px 24px 26px;
      position:relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-80px;
      background:radial-gradient(circle at top left,rgba(255,215,0,0.06),transparent 55%);
      opacity:.9;
      pointer-events:none;
    }
    .panel-inner{position:relative;z-index:2;}

    .panel-title{
      font-family:'Cinzel',serif;
      font-size:22px;
      letter-spacing:.05em;
      color:#f5d76e;
      margin:0 0 10px;
      text-transform:uppercase;
      text-align:left;
    }
    .panel-sub{
      font-size:13px;
      color:var(--muted);
      margin-bottom:18px;
      text-align:left;
    }

    label{
      display:block;
      font-size:13px;
      font-weight:600;
      margin-bottom:6px;
      text-align:left;
    }
    input[type="text"],
    input[type="date"],
    input[type="time"],
    textarea{
      width:100%;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background:#050b1c;
      color:#e6ecff;
      padding:9px 11px;
      font-size:14px;
      box-sizing:border-box;
      outline:none;
    }
    textarea{min-height:80px;resize:vertical;}
    input:focus,textarea:focus{border-color:#ffd54f;box-shadow:0 0 0 1px rgba(255,213,79,.3);}

    .tags{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:8px;
    }
    .tag{
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(255,255,255,.25);
      background:rgba(255,255,255,.04);
      cursor:pointer;
      user-select:none;
    }
    .tag.active{
      background:linear-gradient(135deg,#ffd54f,#ffe680);
      color:#111;
      border-color:transparent;
      font-weight:700;
    }

    .submit-row{
      margin-top:18px;
      display:flex;
      justify-content:flex-start;
      gap:10px;
      align-items:center;
    }
    .primary-btn{
      background:linear-gradient(120deg,#ffd700,#ffcc33,#ffe680);
      color:#111;
      font-weight:700;
      border:none;
      padding:10px 22px;
      border-radius:12px;
      cursor:pointer;
      box-shadow:0 6px 18px rgba(255,215,0,.45);
      transition:transform .2s ease,box-shadow .2s ease;
    }
    .primary-btn:hover{transform:translateY(-1px);box-shadow:0 10px 26px rgba(0,0,0,.55);}
    .hint{font-size:11px;color:var(--muted);}

    .status{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }
    .status.error{color:var(--danger);}

    /* Saƒü panel */
    .mode-tabs{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:10px;
    }
    .mode-pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.2);
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.06em;
      cursor:pointer;
      background:rgba(255,255,255,.03);
    }
    .mode-pill.active{
      background:linear-gradient(135deg,#ffd54f,#ffe680);
      color:#111;
      border-color:transparent;
      font-weight:700;
    }

    .chart-box{
      margin:12px 0 12px;
      border-radius:18px;
      background:radial-gradient(circle at top,rgba(255,215,0,.09),rgba(5,10,25,1));
      border:1px solid rgba(255,255,255,.12);
      padding:14px;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:260px;
    }
    .chart-box img{
      max-width:100%;
      border-radius:16px;
      box-shadow:0 20px 50px rgba(0,0,0,.7);
    }

    .summary-line{
      font-size:13px;
      color:var(--muted);
      margin-bottom:10px;
    }

    .report-box{
      margin-top:12px;
      background:rgba(3,8,20,.88);
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      padding:12px 14px;
      max-height:280px;
      overflow:auto;
      font-size:14px;
      line-height:1.55;
      text-align:left;
      white-space:pre-wrap;
    }

    .audio-row{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:10px;
      font-size:12px;
      color:var(--muted);
    }

    audio{width:100%;max-width:320px;}

    footer{
      margin-top:10px;
      padding:30px 0 40px;
      border-top:1px solid rgba(255,255,255,.08);
      color:#aeb6cf;
      font-size:14px;
      text-align:center;
    }
    footer a{color:#cfe4ff;text-decoration:none}
    footer a:hover{color:#ffe680}
    .links{margin-bottom:8px}

    /* Ask MystAI FAB ‚Äì diƒüer sayfalarla aynƒ± kalsƒ±n */
    .ask-fab{
      position:fixed;
      right:18px;
      bottom:18px;
      z-index:1200;
      background:linear-gradient(135deg,#ffd54f,#ffe680);
      color:#111;
      border:none;
      border-radius:999px;
      padding:12px 18px;
      font-weight:800;
      box-shadow:0 8px 30px rgba(0,0,0,.35);
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .ask-fab:hover{filter:brightness(1.06);transform:translateY(-2px)}

    .ask-modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;justify-content:center;align-items:center;z-index:1300}
    .ask-card{
      width:min(720px,92vw);
      background:#0d1a2b;
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      padding:20px;
      box-shadow:0 0 40px rgba(255,215,0,.35)
    }
    .ask-title{margin:0 0 10px;color:#ffd54f;font-family:'Cinzel',serif}
    .ask-row{display:flex;gap:12px;margin-top:10px}
    .ask-row textarea{
      flex:1;height:110px;resize:vertical;border-radius:10px;border:1px solid rgba(255,255,255,.15);
      background:#0b132a;color:#e6ecff;padding:10px;font-family:inherit;font-size:15px;
    }
    .ask-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
    .ask-btn{background:#ffd54f;color:#111;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .ask-secondary{background:transparent;color:#e6ecff;border:1px solid rgba(255,255,255,.2)}
    .ask-output{margin-top:14px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);padding:12px;border-radius:10px;display:none;text-align:left;white-space:pre-wrap}
    .ask-hint{color:#a9b4d0;font-size:12px;margin-top:6px}
    .spinner{display:none;margin-left:6px}

    @media(max-width:980px){
      main{
        grid-template-columns:1fr;
        padding-top:230px;
      }
      .panel{padding:18px}
      header{padding:12px 18px}
    }
  </style>
</head>
<body>

<header>
  <div class="lang-box">
    <button class="lang-btn" id="btn-en">EN</button>
    <button class="lang-btn secondary" id="btn-tr">TR</button>
  </div>
  <div class="nav-btns">
    <span id="user-welcome" class="welcome"></span>
    <button class="btn" id="backApp" data-i18n="backApp">Back to App</button>
    <button class="btn" id="logoutBtn" data-i18n="logout">Logout</button>
  </div>
</header>

<img src="mystai-logo.png" alt="MystAI Logo" class="floating-logo">

<main>
  <!-- SOL PANEL -->
  <section class="panel">
    <div class="panel-inner">
      <h2 class="panel-title" data-i18n="leftTitle">Your Birth Details</h2>
      <p class="panel-sub" data-i18n="leftSub">
        Your birth data is only used to generate a personal astrology reading and is never shared.
      </p>

      <label for="birthDate" data-i18n="birthDate">Birth Date</label>
      <input type="date" id="birthDate">

      <label for="birthTime" data-i18n="birthTime">Birth Time</label>
      <input type="time" id="birthTime">

      <label for="birthPlace" data-i18n="birthPlace">Birth Place (City, Country)</label>
      <input type="text" id="birthPlace" placeholder="Izmir, Turkey">

      <label for="nameInput" data-i18n="nameLabel">Name (optional)</label>
      <input type="text" id="nameInput" placeholder="Mystic Soul">

      <label data-i18n="focusLabel">What should MystAI focus on?</label>
      <div class="tags" id="focusTags">
        <span class="tag" data-key="love" data-i18n="focusLove">Love & Relationships</span>
        <span class="tag" data-key="career" data-i18n="focusCareer">Career & Life Path</span>
        <span class="tag" data-key="money" data-i18n="focusMoney">Money & Abundance</span>
        <span class="tag" data-key="spiritual" data-i18n="focusSpiritual">Spiritual Growth</span>
      </div>

      <label for="questionInput" data-i18n="questionLabel">Any specific question or intention?</label>
      <textarea id="questionInput" data-i18n-placeholder="questionPh"></textarea>

      <div class="submit-row">
        <button class="primary-btn" id="generateBtn" data-i18n="generateBtn">Generate Astrology Report</button>
        <span class="hint" id="hintText" data-i18n="hint">
          Example: ‚ÄúHow does my chart affect love and career in the next year?‚Äù
        </span>
      </div>

      <div class="status" id="statusText"></div>
    </div>
  </section>

  <!-- SAƒû PANEL -->
  <section class="panel">
    <div class="panel-inner">
      <h2 class="panel-title" data-i18n="rightTitle">Your AI Astrology Report</h2>
      <p class="panel-sub status" id="topStatus" data-i18n="topStatus">
        Fill your birth details and tap ‚ÄúGenerate Astrology Report‚Äù.
      </p>

      <div class="mode-tabs">
        <button class="mode-pill active" data-mode="all" data-i18n="modeAll">Natal + Solar Return + Transits</button>
      </div>

      <div class="chart-box" id="chartBox">
        <span data-i18n="chartPlaceholder">
          Your automatic birth chart will appear here.
        </span>
      </div>

      <p class="summary-line" id="summaryLine"></p>

      <div class="audio-row">
        <span data-i18n="listenLabel">Listen to your report:</span>
        <audio id="audioPlayer" controls></audio>
      </div>

      <div class="report-box" id="reportBox"></div>
    </div>
  </section>
</main>

<footer>
  <div class="links">
    <a href="terms.html" data-i18n="terms">Terms</a> ‚Ä¢
    <a href="privacy.html" data-i18n="privacy">Privacy</a> ‚Ä¢
    <a href="cookies.html" data-i18n="cookies">Cookies</a> ‚Ä¢
    <a href="disclaimer.html" data-i18n="disclaimer">Disclaimer</a>
  </div>
  <p>
    ¬© 2025 MystAI.ai ‚Äî
    <span data-i18n="rights">All Rights Reserved.</span>
    <span data-i18n="dev">Developed by GALAXY üåå</span><br>
    <a href="mailto:support@mystai.ai">support@mystai.ai</a>
  </p>
</footer>

<!-- Ask MystAI FAB (bozulmasƒ±n diye aynƒ±) -->
<button class="ask-fab" id="askFab">
  üîÆ <span data-i18n="ask">Ask MystAI</span>
</button>

<div class="ask-modal" id="askModal" role="dialog" aria-modal="true" aria-labelledby="askTitle">
  <div class="ask-card">
    <h2 class="ask-title" id="askTitle" data-i18n="askTitle">Ask MystAI üîÆ</h2>
    <div class="ask-row">
      <textarea id="askInput" placeholder="Type your question..."></textarea>
    </div>
    <div class="ask-hint" id="askHint">Tip: You can ask about your energy, dreams, love, career, or destiny.</div>
    <div class="ask-actions">
      <button class="ask-btn ask-secondary" id="askClose" data-i18n="close">Close</button>
      <button class="ask-btn" id="askSend">
        <span data-i18n="send">Send</span>
        <span class="spinner" id="askSpin">‚è≥</span>
      </button>
    </div>
    <div class="ask-output" id="askOutput"></div>
    <audio id="askAudio" style="display:none;"></audio>
  </div>
</div>

<script type="module">
  /* ====== CONFIG ====== */
  const BACKEND_URL = "https://mystai-international-1.onrender.com";

  /* ====== Firebase (auth) ====== */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDyiD7GAfOjMbtm-S6pO6XCSRXJclffPL0",
    authDomain: "mystai-6cca2.firebaseapp.com",
    projectId: "mystai-6cca2",
    storageBucket: "mystai-6cca2.appspot.com",
    messagingSenderId: "624127781219",
    appId: "1:624127781219:web:a580ac6e80ccc26e694b56"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const logoutBtn   = document.getElementById('logoutBtn');
  const backAppBtn  = document.getElementById('backApp');
  const userWelcome = document.getElementById('user-welcome');

  logoutBtn.addEventListener('click', ()=> {
    signOut(auth).then(()=>window.location.href = "login.html");
  });
  backAppBtn.addEventListener('click', ()=> {
    window.location.href = "app.html";
  });

  let activeLang = localStorage.getItem("myst_lang") || "en";

  const i18n = {
    en: {
      backApp:"Back to App",
      logout:"Logout",
      leftTitle:"Your Birth Details",
      leftSub:"Your birth data is stored securely and only used to create your personal astrology report.",
      birthDate:"Birth Date",
      birthTime:"Birth Time",
      birthPlace:"Birth Place (City, Country)",
      nameLabel:"Name (optional)",
      focusLabel:"What should MystAI focus on?",
      focusLove:"Love & Relationships",
      focusCareer:"Career & Life Path",
      focusMoney:"Money & Abundance",
      focusSpiritual:"Spiritual Growth",
      questionLabel:"Any specific question or intention?",
      questionPh:"Example: How will the next 12 months affect my love life and career?",
      generateBtn:"Generate Astrology Report",
      hint:"Example: \"How does my chart influence love and career over the next year?\"",
      rightTitle:"Your AI Astrology Report",
      topStatus:"Fill your birth details and tap ‚ÄúGenerate Astrology Report‚Äù.",
      chartPlaceholder:"Your automatic birth chart will appear here.",
      listenLabel:"Listen to your report:",
      terms:"Terms", privacy:"Privacy", cookies:"Cookies", disclaimer:"Disclaimer",
      rights:"All Rights Reserved.", dev:"Developed by GALAXY üåå",
      ask:"Ask MystAI", askTitle:"Ask MystAI üîÆ", send:"Send", close:"Close",
      modeAll:"Natal + Solar Return + Transits",
      askHint:"Tip: You can ask about your energy, dreams, love, career, or destiny."
    },
    tr: {
      backApp:"Uygulamaya D√∂n",
      logout:"√áƒ±kƒ±≈ü Yap",
      leftTitle:"Doƒüum Bilgilerin",
      leftSub:"Doƒüum verilerin gizli tutulur ve sadece ki≈üisel astroloji raporunu olu≈üturmak i√ßin kullanƒ±lƒ±r.",
      birthDate:"Doƒüum Tarihi",
      birthTime:"Doƒüum Saati",
      birthPlace:"Doƒüum Yeri (≈ûehir, √úlke)",
      nameLabel:"ƒ∞smin (opsiyonel)",
      focusLabel:"MystAI hangi alanlara odaklansƒ±n?",
      focusLove:"A≈ük & ƒ∞li≈ükiler",
      focusCareer:"Kariyer & Ya≈üam Yolu",
      focusMoney:"Para & Bolluk",
      focusSpiritual:"Ruhsal Geli≈üim",
      questionLabel:"√ñzel bir sorun ya da niyetin var mƒ±?",
      questionPh:"√ñrnek: √ñn√ºm√ºzdeki 12 ay a≈ük ve kariyerimi nasƒ±l etkiliyor?",
      generateBtn:"Astroloji Raporu Olu≈ütur",
      hint:"√ñrnek: \"Doƒüum haritam a≈ük ve kariyerimi √∂n√ºm√ºzdeki yƒ±l nasƒ±l etkiliyor?\"",
      rightTitle:"Yapay Zek√¢ Astroloji Raporun",
      topStatus:"Doƒüum bilgilerini doldur ve \"Astroloji Raporu Olu≈ütur\" butonuna tƒ±kla.",
      chartPlaceholder:"Otomatik doƒüum haritan burada g√∂r√ºnecek.",
      listenLabel:"Raporunu dinle:",
      terms:"≈ûartlar", privacy:"Gizlilik", cookies:"√áerezler", disclaimer:"Sorumluluk Reddi",
      rights:"T√ºm Haklarƒ± Saklƒ±dƒ±r.", dev:"GALAXY tarafƒ±ndan geli≈ütirilmi≈ütir üåå",
      ask:"MystAI'ye Sor", askTitle:"MystAI'ye Sor üîÆ", send:"G√∂nder", close:"Kapat",
      modeAll:"Natal + Solar Return + Transitler",
      askHint:"ƒ∞pucu: Enerji, r√ºyalar, a≈ük, kariyer ya da kaderin hakkƒ±nda sorular sorabilirsin."
    }
  };

  function applyLang(lang){
    activeLang = lang;
    localStorage.setItem("myst_lang", lang);
    const dict = i18n[lang];

    document.querySelectorAll("[data-i18n]").forEach(el=>{
      const key = el.getAttribute("data-i18n");
      if(dict[key]) el.textContent = dict[key];
    });

    const qArea = document.getElementById("questionInput");
    qArea.placeholder = dict.questionPh;

    document.getElementById("askHint").textContent = dict.askHint;

    document.getElementById("btn-en").classList.toggle("secondary", lang!=="en");
    document.getElementById("btn-tr").classList.toggle("secondary", lang!=="tr");

    if(auth.currentUser){
      const name = auth.currentUser.displayName || auth.currentUser.email;
      userWelcome.textContent = (lang === 'tr' ? 'Ho≈ü geldin, ' : 'Welcome, ') + name;
    }
  }

  document.getElementById("btn-en").addEventListener("click",()=>applyLang("en"));
  document.getElementById("btn-tr").addEventListener("click",()=>applyLang("tr"));
  applyLang(activeLang);

  onAuthStateChanged(auth, (user)=>{
    if(user){
      const name = user.displayName || user.email;
      userWelcome.textContent = (activeLang === 'tr' ? 'Ho≈ü geldin, ' : 'Welcome, ') + name;
    } else {
      window.location.href = "login.html";
    }
  });

  /* ====== Fokus tagleri ====== */
  const focusTags = document.getElementById("focusTags");
  focusTags.addEventListener("click", (e)=>{
    if(e.target.classList.contains("tag")){
      e.target.classList.toggle("active");
    }
  });

  /* ====== Astroloji istek ====== */
  const generateBtn = document.getElementById("generateBtn");
  const statusText  = document.getElementById("statusText");
  const topStatus   = document.getElementById("topStatus");
  const reportBox   = document.getElementById("reportBox");
  const summaryLine = document.getElementById("summaryLine");
  const chartBox    = document.getElementById("chartBox");
  const audioPlayer = document.getElementById("audioPlayer");

  generateBtn.addEventListener("click", async ()=>{
    const birthDate   = document.getElementById("birthDate").value;
    const birthTime   = document.getElementById("birthTime").value;
    const birthPlace  = document.getElementById("birthPlace").value.trim();
    const name        = document.getElementById("nameInput").value.trim();
    const question    = document.getElementById("questionInput").value.trim();

    const focus = Array.from(document.querySelectorAll(".tag.active"))
      .map(el=>el.dataset.key);

    if(!birthDate || !birthTime || !birthPlace){
      statusText.classList.add("error");
      statusText.textContent = activeLang === "tr"
        ? "L√ºtfen doƒüum tarihi, saati ve yerini doldurun."
        : "Please fill in birth date, time and place.";
      return;
    }

    statusText.classList.remove("error");
    statusText.textContent = activeLang === "tr"
      ? "Rapor olu≈üturuluyor, l√ºtfen bekleyin..."
      : "Generating your astrology report, please wait...";

    topStatus.textContent = "";
    reportBox.textContent = "";
    summaryLine.textContent = "";
    chartBox.innerHTML = `<span>${activeLang==="tr" ? "Doƒüum haritan hazƒ±rlanƒ±yor..." : "Preparing your birth chart..."}</span>`;
    audioPlayer.src = "";

    try{
      const res = await fetch(`${BACKEND_URL}/astrology`, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
          birth_date: birthDate,
          birth_time: birthTime,
          birth_place: birthPlace,
          name,
          focus_areas: focus,
          question,
          language: activeLang
        })
      });

      if(!res.ok){
        throw new Error("HTTP " + res.status);
      }

      const data = await res.json();
      if(data.error){
        throw new Error(data.error);
      }

      const text  = data.text || "";
      const audio = data.audio || "";
      const chart = data.chart || "";

      reportBox.textContent = text;

      const line = activeLang === "tr"
        ? `Doƒüum tarihi: ${birthDate} ‚Ä¢ Doƒüum saati: ${birthTime} ‚Ä¢ Doƒüum yeri: ${birthPlace}`
        : `Birth date: ${birthDate} ‚Ä¢ Birth time: ${birthTime} ‚Ä¢ Birth place: ${birthPlace}`;
      summaryLine.textContent = line;

      if(chart){
        const src = chart.startsWith("http") ? chart : `${BACKEND_URL}${chart}`;
        chartBox.innerHTML = `<img src="${src}" alt="Astrology chart">`;
      }else{
        chartBox.innerHTML = `<span>${activeLang==="tr" ? "Harita g√∂r√ºnt√ºs√º olu≈üturulamadƒ±." : "Chart image could not be generated."}</span>`;
      }

      if(audio){
        const aSrc = audio.startsWith("http") ? audio : `${BACKEND_URL}${audio}`;
        audioPlayer.src = aSrc;
      }

      statusText.textContent = activeLang === "tr"
        ? "Rapor hazƒ±r. A≈üaƒüƒ±dan okuyabilir ve dinleyebilirsin."
        : "Your report is ready. You can read and listen below.";

    }catch(err){
      console.error(err);
      statusText.classList.add("error");
      statusText.textContent = (activeLang==="tr" ? "Hata: " : "Error: ") + (err?.message || err);
      chartBox.innerHTML = `<span>${activeLang==="tr" ? "Bir hata olu≈ütu, l√ºtfen tekrar dene." : "Something went wrong, please try again."}</span>`;
    }
  });

  /* ====== Ask MystAI modal (mevcut backend /predict kullanƒ±r) ====== */
  const askFab    = document.getElementById('askFab');
  const askModal  = document.getElementById('askModal');
  const askClose  = document.getElementById('askClose');
  const askSend   = document.getElementById('askSend');
  const askInput  = document.getElementById('askInput');
  const askOutput = document.getElementById('askOutput');
  const askSpin   = document.getElementById('askSpin');
  const askAudio  = document.getElementById('askAudio');

  askFab.addEventListener('click', ()=> {
    askModal.style.display='flex';
    askInput.focus();
  });
  askClose.addEventListener('click', ()=> {
    askModal.style.display='none';
    askOutput.style.display='none';
    askInput.value='';
    askAudio.pause(); askAudio.currentTime=0; askAudio.src='';
  });
  askModal.addEventListener('click', (e)=>{
    if(e.target === askModal){ askClose.click(); }
  });

  askSend.addEventListener('click', async ()=>{
    const q = askInput.value.trim();
    if(!q){
      alert(activeLang==='tr' ? 'L√ºtfen bir soru yazƒ±n.' : 'Please type a question.');
      return;
    }

    askSpin.style.display='inline-block';
    askSend.disabled = true;
    askOutput.style.display='none';
    askOutput.textContent = '';

    try{
      const res = await fetch(`${BACKEND_URL}/predict`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ user_input: q, reading_type: "general" })
      });

      if(!res.ok){
        throw new Error((activeLang==='tr'?'ƒ∞stek ba≈üarƒ±sƒ±z: ':'Request failed: ')+res.status);
      }

      const data = await res.json();
      const text = data?.text || (activeLang==='tr'?'Yanƒ±t alƒ±namadƒ±.':'No response.');
      const audioPath = data?.audio;

      askOutput.style.display='block';
      askOutput.textContent = text;

      if(audioPath){
        const audioURL = audioPath.startsWith('http') ? audioPath : `${BACKEND_URL}${audioPath}`;
        askAudio.src = audioURL;
        askAudio.play().catch(()=>{});
      }
    }catch(err){
      askOutput.style.display='block';
      askOutput.textContent = (activeLang==='tr'?'Hata: ':'Error: ') + (err?.message||err);
    }finally{
      askSpin.style.display='none';
      askSend.disabled = false;
    }
  });
</script>
</body>
</html>
