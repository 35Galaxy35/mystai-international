<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MystAI.ai â€” Astrology & Birth Chart</title>
  <link rel="icon" type="image/png" href="mystai-logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-start:#0d1440;
      --bg-end:#0b0f1f;
      --text:#d8e0ff;
      --muted:#a9b4d0;
      --accent:#f2c84b;
      --card:#111827;
    }
    html,body{
      margin:0;padding:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color:var(--text);
      background:radial-gradient(1400px 800px at 50% -10%, #101a4d 0%, #0b0f1f 85%);
      overflow-x:hidden;
    }

    /* Header */
    header{
      position:relative;
      padding:16px 40px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:rgba(10,15,30,0.35);
      backdrop-filter:blur(12px);
      border-bottom:1px solid rgba(255,255,255,0.06);
      z-index:1000;
    }
    .lang-box,.nav-btns{display:flex;gap:10px;align-items:center;}
    .lang-btn{
      font-weight:700;border:0;border-radius:50px;
      padding:7px 13px;cursor:pointer;font-size:13px;
      background:linear-gradient(135deg,#ffd54f,#ffe680);color:#111;
      transition:all .3s ease;
    }
    .lang-btn.secondary{
      background:rgba(255,255,255,.1);color:#e6ecff;
      border:1px solid rgba(255,255,255,.12)
    }
    .btn{
      font-weight:700;border:0;border-radius:10px;
      padding:8px 18px;cursor:pointer;
      color:#0b0f1f;background:#ffd54f;font-size:14px;
      transition:all .3s ease;
    }
    .btn:hover,.lang-btn:hover{filter:brightness(1.1);transform:translateY(-2px)}
    .welcome{font-weight:600;color:#ffe680;text-shadow:0 0 10px rgba(255,220,120,.4);margin-right:12px}

    /* Logo */
    .floating-logo{
      position:absolute;left:50%;top:90px;transform:translateX(-50%);
      height:140px;width:auto;pointer-events:none;
      animation:float 6s ease-in-out infinite alternate,glow 6s ease-in-out infinite alternate;
      filter:drop-shadow(0 0 35px rgba(255,230,150,.65)) brightness(1.05);
      z-index:5;
    }
    @keyframes float{from{transform:translate(-50%,-10px)}to{transform:translate(-50%,8px)}}
    @keyframes glow{from{filter:drop-shadow(0 0 25px rgba(255,240,180,.4))}to{filter:drop-shadow(0 0 55px rgba(255,250,200,.8))}}

    /* Main layout */
    main{
      max-width:1200px;
      margin:0 auto;
      padding:220px 20px 60px;
      display:grid;
      grid-template-columns: minmax(0,1.1fr) minmax(0,1.3fr);
      gap:24px;
    }
    @media(max-width:960px){
      .floating-logo{height:110px;top:100px}
      main{grid-template-columns:1fr;padding-top:210px}
    }

    .panel{
      background:rgba(15,23,42,.9);
      border-radius:18px;
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 0 32px rgba(0,0,0,.45);
      padding:22px 24px;
    }
    .panel h2{
      margin-top:0;
      font-family:'Cinzel',serif;
      font-size:20px;
      color:#ffd76e;
      text-transform:uppercase;
      letter-spacing:1px;
    }
    .panel p.desc{
      margin-top:6px;
      font-size:14px;
      color:var(--muted);
      line-height:1.5;
    }

    /* Form */
    .field{
      text-align:left;
      margin-top:14px;
    }
    .field label{
      font-size:13px;
      font-weight:600;
      color:#e5e7ff;
      display:block;
      margin-bottom:4px;
    }
    .field input,
    .field textarea,
    .field select{
      width:100%;
      border-radius:10px;
      border:1px solid rgba(148,163,184,.6);
      background:#020617;
      color:#e5e7ff;
      padding:9px 11px;
      font-size:14px;
      box-sizing:border-box;
    }
    .field small{color:#94a3b8;font-size:11px}
    .field-row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .chips{
      display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;
    }
    .chip{
      font-size:12px;
      border-radius:999px;
      padding:6px 10px;
      border:1px solid rgba(148,163,184,.6);
      cursor:pointer;
      color:#e5e7ff;
      background:transparent;
    }
    .chip.active{
      background:linear-gradient(135deg,#ffd54f,#ffe680);
      color:#111827;
      border-color:transparent;
    }

    .primary-btn{
      margin-top:18px;
      width:100%;
      border:none;
      border-radius:14px;
      padding:12px 16px;
      font-weight:800;
      font-size:15px;
      letter-spacing:1px;
      text-transform:uppercase;
      cursor:pointer;
      background:linear-gradient(120deg,#ffd700,#ffcc33,#ffe680);
      color:#111;
      box-shadow:0 0 24px rgba(250,204,21,.55);
      transition:transform .25s ease,box-shadow .25s ease;
    }
    .primary-btn:hover{transform:scale(1.03);box-shadow:0 0 34px rgba(250,250,150,.75)}
    .primary-btn:disabled{opacity:.6;cursor:wait;box-shadow:none;transform:none}

    /* Right side */
    .report-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:14px;
      flex-wrap:wrap;
    }
    .badge{
      padding:5px 10px;
      border-radius:999px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.6px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(248,250,252,.16);
      color:#e5e7ff;
    }
    .chart-wrapper{
      display:flex;
      gap:14px;
      align-items:center;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .chart-card{
      width:200px;
      border-radius:16px;
      overflow:hidden;
      box-shadow:0 0 26px rgba(56,189,248,.35);
      border:1px solid rgba(148,163,184,.6);
      background:#020617;
      flex-shrink:0;
    }
    .chart-card img{
      display:block;
      width:100%;
      height:auto;
    }
    .chart-meta{
      font-size:13px;
      color:var(--muted);
      line-height:1.5;
    }

    .status{
      font-size:13px;
      color:#fbbf24;
      margin-bottom:6px;
    }
    .report-body{
      margin-top:10px;
      padding:12px 14px;
      border-radius:12px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(51,65,85,.9);
      max-height:420px;
      overflow:auto;
      text-align:left;
      white-space:pre-wrap;
      font-size:14px;
      line-height:1.6;
    }
    .audio-row{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .audio-row span{
      font-size:12px;
      color:var(--muted);
    }

    /* Footer */
    footer{
      margin-top:30px;
      padding:22px 0 26px;
      border-top:1px solid rgba(255,255,255,.08);
      text-align:center;
      color:#aeb6cf;
      font-size:13px;
    }
    footer a{color:#cfe4ff;text-decoration:none}
    footer a:hover{color:#ffe680}
    .links{margin-bottom:6px}
  </style>
</head>
<body>

<header>
  <div class="lang-box">
    <button class="lang-btn" id="btn-en">EN</button>
    <button class="lang-btn secondary" id="btn-tr">TR</button>
  </div>

  <div class="nav-btns">
    <span id="user-welcome" class="welcome"></span>
    <button class="btn" id="historyBtn" data-i18n="history">My History</button>
    <button class="btn" id="logoutBtn" data-i18n="logout">Logout</button>
  </div>
</header>

<img src="mystai-logo.png" alt="MystAI Logo" class="floating-logo">

<main>
  <!-- LEFT: FORM -->
  <section class="panel" id="formPanel">
    <h2 data-i18n="formTitle">Your Birth Details</h2>
    <p class="desc" data-i18n="formDesc">
      Your birth data is used only to create your personal astrology report. It is never stored or shared.
    </p>

    <div class="field-row">
      <div class="field">
        <label for="dob" data-i18n="dobLabel">Date of Birth</label>
        <input type="date" id="dob" />
      </div>
      <div class="field">
        <label for="tob" data-i18n="tobLabel">Time of Birth</label>
        <input type="time" id="tob" />
      </div>
    </div>

    <div class="field">
      <label for="place" data-i18n="placeLabel">Birth Place (City, Country)</label>
      <input type="text" id="place" placeholder="e.g. Izmir, TÃ¼rkiye" />
    </div>

    <div class="field">
      <label for="nickname" data-i18n="nameLabel">Name / Nickname (optional)</label>
      <input type="text" id="nickname" placeholder="Mystic Soul" />
    </div>

    <div class="field">
      <label data-i18n="focusLabel">Which life areas should we focus on?</label>
      <div class="chips" id="focusChips">
        <button type="button" class="chip" data-value="love"   data-i18n="fLove">Love & Relationships</button>
        <button type="button" class="chip" data-value="career" data-i18n="fCareer">Career & Life Path</button>
        <button type="button" class="chip" data-value="money"  data-i18n="fMoney">Money & Abundance</button>
        <button type="button" class="chip" data-value="growth" data-i18n="fGrowth">Spiritual Growth</button>
      </div>
      <small data-i18n="focusHint">You can select more than one.</small>
    </div>

    <div class="field">
      <label for="question" data-i18n="qLabel">Anything special you want MystAI to consider?</label>
      <textarea id="question" rows="3" placeholder=""></textarea>
      <small data-i18n="qHint">
        For example: "How does my birth chart affect my love life in 2025?" or
        "Which themes stand out in my next solar return?"
      </small>
    </div>

    <button class="primary-btn" id="astroSubmit" data-i18n="submit">
      Create Astrology Report
    </button>
  </section>

  <!-- RIGHT: CHART + REPORT -->
  <section class="panel" id="reportPanel">
    <div class="report-header">
      <div>
        <h2 data-i18n="reportTitle">Your AI Astrology Report</h2>
        <div class="status" id="astroStatus"></div>
      </div>
      <div class="badge" data-i18n="badge">Natal + Solar Return + Transits</div>
    </div>

    <div class="chart-wrapper">
      <div class="chart-card">
        <img src="images/Astrology.png" alt="Birth Chart" />
      </div>
      <div class="chart-meta" id="chartMeta" data-i18n="chartMeta">
        Enter your birth details on the left. When your report is ready, your birth date, time and place
        will be summarized here along with a symbolic star map.
      </div>
    </div>

    <div class="report-body" id="astroReport" data-i18n="reportBody">
      <!-- AI report will appear here -->
    </div>

    <div class="audio-row">
      <span data-i18n="audioLabel">Listen to your report:</span>
      <audio id="astroAudio" controls style="display:none;"></audio>
    </div>
  </section>
</main>

<footer>
  <div class="links">
    <a href="terms.html" data-i18n="terms">Terms</a> â€¢
    <a href="privacy.html" data-i18n="privacy">Privacy</a> â€¢
    <a href="cookies.html" data-i18n="cookies">Cookies</a> â€¢
    <a href="disclaimer.html" data-i18n="disclaimer">Disclaimer</a>
  </div>
  <p>
    Â© 2025 MystAI.ai â€” <span data-i18n="rights">All Rights Reserved.</span>
    <span data-i18n="dev">Developed by GALAXY ðŸŒŒ</span><br>
    <a href="mailto:support@mystai.ai">support@mystai.ai</a>
  </p>
</footer>

<script type="module">
  /* ====== CONFIG ====== */
  const BACKEND_URL = "https://mystai-international-1.onrender.com";

  /* ====== Firebase (auth) ====== */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDyiD7GAfOjMbtm-S6pO6XCSRXJclffPL0",
    authDomain: "mystai-6cca2.firebaseapp.com",
    projectId: "mystai-6cca2",
    storageBucket: "mystai-6cca2.appspot.com",
    messagingSenderId: "624127781219",
    appId: "1:624127781219:web:a580ac6e80ccc26e694b56"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const logoutBtn   = document.getElementById('logoutBtn');
  const historyBtn  = document.getElementById('historyBtn');
  const userWelcome = document.getElementById('user-welcome');

  /* ====== i18n ====== */
  const i18n = {
    en:{
      history:"My History",
      logout:"Logout",
      formTitle:"Your Birth Details",
      formDesc:"Your birth data is used only to create your personal astrology report. It is never stored or shared.",
      dobLabel:"Date of Birth",
      tobLabel:"Time of Birth",
      placeLabel:"Birth Place (City, Country)",
      nameLabel:"Name / Nickname (optional)",
      focusLabel:"Which life areas should we focus on?",
      fLove:"Love & Relationships",
      fCareer:"Career & Life Path",
      fMoney:"Money & Abundance",
      fGrowth:"Spiritual Growth",
      focusHint:"You can select more than one.",
      qLabel:"Anything special you want MystAI to consider?",
      qHint:'For example: "How does my birth chart affect my love life in 2025?" or "Which themes stand out in my next solar return?"',
      submit:"Create Astrology Report",
      reportTitle:"Your AI Astrology Report",
      badge:"Natal + Solar Return + Transits",
      chartMeta:"Enter your birth details on the left. When your report is ready, your birth date, time and place will be summarized here along with a symbolic star map.",
      reportBody:"",
      audioLabel:"Listen to your report:",
      terms:"Terms",
      privacy:"Privacy",
      cookies:"Cookies",
      disclaimer:"Disclaimer",
      rights:"All Rights Reserved.",
      dev:"Developed by GALAXY ðŸŒŒ",
      statusIdle:"Fill in your details and click the button to generate your astrology report.",
      statusLoading:"Creating your personal astrology reportâ€¦ This may take a few seconds.",
      statusError:"An error occurred while creating the report. Please try again.",
      statusMissing:"Please enter your date of birth, time and place.",
      welcomePrefix:"Welcome, "
    },
    tr:{
      history:"GeÃ§miÅŸim",
      logout:"Ã‡Ä±kÄ±ÅŸ Yap",
      formTitle:"DoÄŸum Bilgilerin",
      formDesc:"DoÄŸum verilerin yalnÄ±zca kiÅŸisel astroloji raporunu oluÅŸturmak iÃ§in kullanÄ±lÄ±r; asla saklanmaz veya paylaÅŸÄ±lmaz.",
      dobLabel:"DoÄŸum Tarihi",
      tobLabel:"DoÄŸum Saati",
      placeLabel:"DoÄŸum Yeri (Åžehir, Ãœlke)",
      nameLabel:"Ä°smin / Takma AdÄ±n (opsiyonel)",
      focusLabel:"Hangi hayat alanlarÄ±na odaklanalÄ±m?",
      fLove:"AÅŸk & Ä°liÅŸkiler",
      fCareer:"Kariyer & YaÅŸam Yolu",
      fMoney:"Para & Bolluk",
      fGrowth:"Ruhsal GeliÅŸim",
      focusHint:"Birden fazla alan seÃ§ebilirsin.",
      qLabel:"MystAI'nin Ã¶zellikle dikkate almasÄ±nÄ± istediÄŸin bir ÅŸey var mÄ±?",
      qHint:'Ã–rneÄŸin: "DoÄŸum haritam aÅŸk hayatÄ±mÄ± 2025\'te nasÄ±l etkiliyor?" veya "Solar Return haritamda hangi ana temalar Ã¶ne Ã§Ä±kÄ±yor?"',
      submit:"Astroloji Raporu OluÅŸtur",
      reportTitle:"Yapay ZekÃ¢ Astroloji Raporun",
      badge:"Natal + Solar Return + Transitler",
      chartMeta:"Soldaki formu doldur. Raporun hazÄ±r olduÄŸunda doÄŸum tarihin, saatin ve yerin burada Ã¶zetlenecek ve sembolik bir yÄ±ldÄ±z haritasÄ± gÃ¶sterilecek.",
      reportBody:"",
      audioLabel:"Raporunu dinle:",
      terms:"Åžartlar",
      privacy:"Gizlilik",
      cookies:"Ã‡erezler",
      disclaimer:"Sorumluluk Reddi",
      rights:"TÃ¼m HaklarÄ± SaklÄ±dÄ±r.",
      dev:"GALAXY tarafÄ±ndan geliÅŸtirilmiÅŸtir ðŸŒŒ",
      statusIdle:"Bilgilerini doldur ve butona tÄ±klayarak kiÅŸisel astroloji raporunu oluÅŸtur.",
      statusLoading:"KiÅŸisel astroloji raporun hazÄ±rlanÄ±yorâ€¦ BirkaÃ§ saniye sÃ¼rebilir.",
      statusError:"Rapor oluÅŸturulurken bir hata oluÅŸtu. LÃ¼tfen tekrar dene.",
      statusMissing:"LÃ¼tfen doÄŸum tarihi, saati ve yerini gir.",
      welcomePrefix:"HoÅŸ geldin, "
    }
  };

  let activeLang = localStorage.getItem("myst_lang") || "en";

  function applyLang(lang){
    activeLang = lang;
    localStorage.setItem("myst_lang", lang);
    const dict = i18n[lang] || i18n.en;

    document.querySelectorAll("[data-i18n]").forEach(el=>{
      const key = el.getAttribute("data-i18n");
      if(!key) return;
      if(key === "qHint" || key === "formDesc" || key === "chartMeta"){
        el.innerHTML = dict[key];
      }else{
        el.textContent = dict[key] ?? "";
      }
    });

    document.getElementById("btn-en").classList.toggle("secondary", lang!=="en");
    document.getElementById("btn-tr").classList.toggle("secondary", lang!=="tr");

    // Placeholder'lar
    const place = document.getElementById("place");
    const nick  = document.getElementById("nickname");
    const q     = document.getElementById("question");

    if(lang==="tr"){
      place.placeholder = "Ã–rn: Ä°zmir, TÃ¼rkiye";
      nick.placeholder  = "Ã–rn: Mystic Soul";
      q.placeholder     = "Sorunu yaz...";
    }else{
      place.placeholder = "e.g. Izmir, TÃ¼rkiye";
      nick.placeholder  = "e.g. Mystic Soul";
      q.placeholder     = "Type your question...";
    }

    const user = auth.currentUser;
    if(user){
      const name = user.displayName || user.email;
      userWelcome.textContent = (dict.welcomePrefix || "") + name;
    }

    // BaÅŸlangÄ±Ã§ mesajÄ±
    document.getElementById("astroStatus").textContent = dict.statusIdle;
  }

  document.getElementById("btn-en").addEventListener("click",()=>applyLang("en"));
  document.getElementById("btn-tr").addEventListener("click",()=>applyLang("tr"));
  applyLang(activeLang);

  /* ====== Auth / Nav ====== */
  logoutBtn.addEventListener('click', ()=>{
    signOut(auth).then(()=>window.location.href="login.html");
  });
  historyBtn.addEventListener('click', ()=>window.location.href="history.html");

  onAuthStateChanged(auth,(user)=>{
    const dict = i18n[activeLang] || i18n.en;
    if(user){
      const name = user.displayName || user.email;
      userWelcome.textContent = (dict.welcomePrefix || "") + name;
    }else{
      window.location.href = "login.html";
    }
  });

  /* ====== Focus chips ====== */
  const chips = Array.from(document.querySelectorAll(".chip"));
  chips.forEach(chip=>{
    chip.addEventListener("click",()=>{
      chip.classList.toggle("active");
    });
  });

  function buildPrompt(lang, data){
    const {dob,tob,place,nickname,focusList,question} = data;
    const focusText = focusList.length ? focusList.join(", ") : (lang==="tr" ? "Genel tema" : "General themes");
    const safeName = nickname || (lang==="tr" ? "danÄ±ÅŸan" : "querent");

    if(lang==="tr"){
      return (
        "AÅŸaÄŸÄ±daki bilgilere sahip bir kullanÄ±cÄ± iÃ§in detaylÄ±, profesyonel bir astroloji raporu hazÄ±rla.\n\n" +
        `Ä°sim / takma ad: ${safeName}\n` +
        `DoÄŸum tarihi: ${dob}\n` +
        `DoÄŸum saati: ${tob}\n` +
        `DoÄŸum yeri: ${place}\n` +
        `OdaklanÄ±lacak hayat alanlarÄ±: ${focusText}\n` +
        (question ? `KullanÄ±cÄ±nÄ±n Ã¶zellikle merak ettiÄŸi soru / konu: ${question}\n\n` : "\n") +
        "RAPOR YAPISI:\n" +
        "1) Natal Harita Ã–zeti: GÃ¼neÅŸ, Ay, olasÄ± YÃ¼kselen ve Ã¶nemli gezegen temalarÄ±nÄ±; karakteri, iÃ§ dÃ¼nyayÄ± ve hayat amacÄ±nÄ± aÃ§Ä±kla.\n" +
        "2) Ã–nÃ¼mÃ¼zdeki 12 AyÄ±n Transit TemalarÄ±: AÅŸk, iliÅŸkiler, kariyer, para, aile ve ruhsal geliÅŸim aÃ§Ä±sÄ±ndan Ã¶nemli dÃ¶nemleri ve fÄ±rsatlarÄ± anlat. Tarih verirken yaklaÅŸÄ±k dÃ¶nemler (ilkbahar, yaz, yÄ±lÄ±n ikinci yarÄ±sÄ± gibi) kullan.\n" +
        "3) Solar Return / YÄ±llÄ±k Harita Ã–zeti: Bu yÄ±lÄ±n ana dersini, dikkat edilmesi gereken konularÄ± ve kullanÄ±cÄ±ya destek olacak olumlu tavsiyeleri yaz.\n\n" +
        "Ãœslubun hem mistik hem de topraklayÄ±cÄ± olsun; korkutucu cÃ¼mlelerden kaÃ§Ä±n. Son bÃ¶lÃ¼mde birkaÃ§ madde halinde uygulanabilir Ã¶neri ver."
      );
    }else{
      return (
        "Create a detailed, professional astrology report for the user with the data below.\n\n" +
        `Name / nickname: ${safeName}\n` +
        `Date of birth: ${dob}\n` +
        `Time of birth: ${tob}\n` +
        `Birth place: ${place}\n` +
        `Main focus areas: ${focusText}\n` +
        (question ? `User's specific question / topic: ${question}\n\n` : "\n") +
        "REPORT STRUCTURE:\n" +
        "1) Natal Chart Overview: probable Sun, Moon, possible Ascendant themes and key planetary patterns; personality, emotional needs and life purpose.\n" +
        "2) Transit Themes for the Next 12 Months: important cycles in love, relationships, career, finances, family and spiritual growth. Use approximate time frames (early year, mid-year, second half of the year) instead of exact dates.\n" +
        "3) Solar Return / Annual Chart: main lesson of this year, key focus areas and supportive advice.\n\n" +
        "Keep the tone mystical yet grounded, avoid scary sentences and close with a short list of practical suggestions."
      );
    }
  }

  /* ====== Submit ====== */
  const submitBtn   = document.getElementById("astroSubmit");
  const statusEl    = document.getElementById("astroStatus");
  const reportEl    = document.getElementById("astroReport");
  const audioEl     = document.getElementById("astroAudio");
  const chartMetaEl = document.getElementById("chartMeta");

  submitBtn.addEventListener("click", async ()=>{
    const dict = i18n[activeLang] || i18n.en;

    const dob   = document.getElementById("dob").value;
    const tob   = document.getElementById("tob").value;
    const place = document.getElementById("place").value.trim();
    const nickname = document.getElementById("nickname").value.trim();
    const question = document.getElementById("question").value.trim();

    if(!dob || !tob || !place){
      alert(dict.statusMissing);
      return;
    }

    const focusList = chips.filter(c=>c.classList.contains("active")).map(c=>c.textContent.trim());

    const userPrompt = buildPrompt(activeLang,{
      dob,tob,place,nickname,focusList,question
    });

    // Chart meta gÃ¼ncelle
    chartMetaEl.textContent =
      (activeLang==="tr"
        ? `DoÄŸum tarihi: ${dob} â€¢ DoÄŸum saati: ${tob} â€¢ DoÄŸum yeri: ${place}`
        : `Date of birth: ${dob} â€¢ Time: ${tob} â€¢ Place: ${place}`);

    submitBtn.disabled = true;
    statusEl.textContent = dict.statusLoading;
    reportEl.textContent = "";
    audioEl.style.display = "none";
    audioEl.src = "";

    try{
      const res = await fetch(`${BACKEND_URL}/predict`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
          user_input:userPrompt,
          reading_type:"astrology"
        })
      });

      if(!res.ok){
        throw new Error("HTTP " + res.status);
      }

      const data = await res.json();
      if(data.error){
        throw new Error(data.error);
      }

      reportEl.textContent = data.text || "";
      statusEl.textContent = "";

      if(data.audio){
        const audioURL = data.audio.startsWith("http")
          ? data.audio
          : `${BACKEND_URL}${data.audio}`;
        audioEl.src = audioURL;
        audioEl.style.display = "block";
        audioEl.play().catch(()=>{});
      }
    }catch(err){
      console.error(err);
      statusEl.textContent = dict.statusError;
    }finally{
      submitBtn.disabled = false;
    }
  });
</script>
</body>
</html>
