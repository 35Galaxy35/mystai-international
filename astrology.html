<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MystAI.ai ‚Äî Astrology & Birth Chart</title>
  <link rel="icon" type="image/png" href="mystai-logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-start:#0d1440;
      --bg-end:#060814;
      --card:#121933;
      --card-soft:#141c3b;
      --border-soft:rgba(255,255,255,.08);
      --text:#e5ecff;
      --muted:#a3aed9;
      --accent:#f2c84b;
      --accent-soft:rgba(242,200,75,.22);
      --error:#ff7a7a;
      --ok:#41e2a0;
    }

    *{box-sizing:border-box;}

    html,body{
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color:var(--text);
      background:radial-gradient(1400px 800px at 50% -10%, #101a4d 0%, #050712 80%);
      min-height:100vh;
      overflow-x:hidden;
    }

    /* Header */
    header{
      position:relative;
      padding:14px 36px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:rgba(6,10,30,.65);
      border-bottom:1px solid rgba(255,255,255,.09);
      backdrop-filter:blur(16px);
      z-index:20;
    }
    .lang-box,.nav-btns{display:flex;align-items:center;gap:10px;}

    .lang-btn{
      font-weight:700;
      border-radius:999px;
      padding:6px 13px;
      border:none;
      font-size:13px;
      cursor:pointer;
      background:linear-gradient(135deg,#ffd54f,#ffe680);
      color:#111;
      box-shadow:0 0 18px rgba(255,215,0,.45);
      transition:all .25s ease;
    }
    .lang-btn.secondary{
      background:rgba(255,255,255,.08);
      color:#e6ecff;
      border:1px solid rgba(255,255,255,.18);
      box-shadow:none;
    }
    .lang-btn:hover{transform:translateY(-2px);filter:brightness(1.05);}

    .btn{
      font-weight:700;
      border-radius:10px;
      padding:7px 16px;
      border:none;
      font-size:13px;
      cursor:pointer;
      background:#ffd54f;
      color:#111;
      transition:all .25s ease;
    }
    .btn:hover{transform:translateY(-2px);filter:brightness(1.05);}
    .welcome{font-weight:600;color:#ffe680;text-shadow:0 0 10px rgba(255,230,140,.6);}

    /* Logo */
    .floating-logo{
      position:absolute;
      left:50%;
      top:90px;
      transform:translateX(-50%);
      height:130px;
      filter:drop-shadow(0 0 32px rgba(255,230,150,.7));
      animation:float 6s ease-in-out infinite alternate, glow 7s ease-in-out infinite alternate;
      pointer-events:none;
      z-index:5;
    }
    @keyframes float{from{transform:translate(-50%,-12px)}to{transform:translate(-50%,6px)}}
    @keyframes glow{
      from{filter:drop-shadow(0 0 26px rgba(255,240,180,.4))}
      to{filter:drop-shadow(0 0 60px rgba(255,250,210,.85))}
    }

    /* Main Layout */
    main{
      max-width:1240px;
      margin:220px auto 60px;
      padding:0 18px 40px;
      display:grid;
      grid-template-columns:minmax(0,420px) minmax(0,1fr);
      gap:26px;
    }

    .panel{
      background:linear-gradient(145deg,rgba(7,11,28,.95),rgba(10,18,50,.97));
      border-radius:18px;
      border:1px solid rgba(255,255,255,.08);
      box-shadow:
        0 28px 90px rgba(0,0,0,.75),
        0 0 40px rgba(80,120,255,.15);
      padding:22px 22px 26px;
      position:relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 10% -10%,rgba(255,215,0,.12),transparent 55%),
                 radial-gradient(circle at 120% 120%,rgba(90,180,255,.10),transparent 55%);
      opacity:.9;
      pointer-events:none;
      z-index:-1;
    }

    .panel-title{
      font-family:'Cinzel',serif;
      font-size:22px;
      letter-spacing:.06em;
      color:#ffd76e;
      margin-bottom:12px;
      text-transform:uppercase;
    }
    .panel-sub{
      font-size:13px;
      color:var(--muted);
      line-height:1.5;
      margin-bottom:18px;
    }

    /* Form */
    .form-group{margin-bottom:14px;text-align:left;}
    .form-label{
      font-size:13px;
      margin-bottom:4px;
      color:#cfd7ff;
      display:block;
    }
    .form-input, .form-textarea{
      width:100%;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(3,6,22,.9);
      color:var(--text);
      padding:8px 10px;
      font-size:14px;
      outline:none;
      transition:border .2s ease, box-shadow .2s ease, background .2s ease;
    }
    .form-input:focus, .form-textarea:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(242,200,75,.6);
      background:rgba(3,8,28,.98);
    }
    .form-textarea{
      resize:vertical;
      min-height:78px;
      max-height:160px;
    }
    .hint{font-size:11px;color:var(--muted);margin-top:4px;}

    /* Focus chips */
    .chip-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;}
    .focus-chip{
      font-size:12px;
      border-radius:999px;
      padding:5px 10px;
      border:1px solid rgba(255,255,255,.22);
      background:rgba(5,10,28,.6);
      cursor:pointer;
      color:#e0e7ff;
      user-select:none;
      transition:all .2s ease;
    }
    .focus-chip.active{
      background:linear-gradient(135deg,#ffd54f,#ffe680);
      color:#111;
      border-color:rgba(255,215,0,1);
      box-shadow:0 0 18px rgba(255,215,0,.6);
    }

    .primary-btn{
      margin-top:12px;
      width:100%;
      border-radius:999px;
      padding:11px 16px;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-size:15px;
      background:linear-gradient(135deg,#ffd54f,#ffb347);
      color:#111;
      box-shadow:0 16px 40px rgba(0,0,0,.75),0 0 26px rgba(255,215,0,.55);
      transition:transform .25s ease, box-shadow .25s ease, filter .2s ease;
    }
    .primary-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 22px 55px rgba(0,0,0,.85),0 0 30px rgba(255,215,0,.75);
      filter:brightness(1.03);
    }
    .primary-btn:disabled{
      opacity:.65;
      cursor:default;
      transform:none;
      box-shadow:0 10px 26px rgba(0,0,0,.5);
    }

    .secondary-btn{
      margin-top:12px;
      width:100%;
      border-radius:999px;
      padding:10px 14px;
      border:1px solid rgba(255,255,255,.35);
      background:rgba(5,10,25,.9);
      color:#e8eeff;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition:all .2s ease;
    }
    .secondary-btn:hover{
      border-color:#ffd54f;
      color:#fff8e0;
      box-shadow:0 12px 30px rgba(0,0,0,.7);
    }

    /* Right panel - tabs, chart & report */
    .mode-tabs{
      display:flex;
      gap:6px;
      margin-bottom:12px;
      background:rgba(3,8,30,.9);
      border-radius:999px;
      padding:4px;
      border:1px solid rgba(255,255,255,.14);
    }
    .mode-tab{
      flex:1;
      text-align:center;
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      cursor:pointer;
      border:none;
      background:transparent;
      color:#c3cffc;
      text-transform:uppercase;
      letter-spacing:.08em;
      font-weight:600;
      transition:all .2s ease;
    }
    .mode-tab.active{
      background:linear-gradient(135deg,#ffd54f,#ffe680);
      color:#111;
      box-shadow:0 0 18px rgba(255,215,0,.6);
    }

    .mode-section{
      display:none;
    }
    .mode-section.active{
      display:block;
    }

    .section-title{
      font-family:'Cinzel',serif;
      font-size:18px;
      letter-spacing:.05em;
      color:#ffd76e;
      margin:2px 0 8px;
      text-transform:uppercase;
    }
    .section-sub{
      font-size:12px;
      color:var(--muted);
      margin:0 0 10px;
    }

    .chart-card{
      margin-top:6px;
      border-radius:18px;
      padding:18px 18px 16px;
      background:
        radial-gradient(circle at 20% 0%,rgba(255,244,200,.15),transparent 55%),
        radial-gradient(circle at 90% 100%,rgba(130,180,255,.15),transparent 55%),
        linear-gradient(150deg,#050816,#0c1635);
      border:1px solid rgba(255,255,255,.08);
      box-shadow:
        0 20px 60px rgba(0,0,0,.85),
        0 0 32px rgba(70,120,255,.3);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
    }

    .chart-container{
      position:relative;
      width:min(420px,80vw);
      aspect-ratio:1;
      border-radius:20px;
      padding:18px;
      background:radial-gradient(circle at 50% 12%,rgba(255,255,255,.1),transparent 60%),
                 radial-gradient(circle at 0% 100%,rgba(255,215,0,.16),transparent 55%),
                 #050818;
      box-shadow:0 0 40px rgba(0,0,0,.9),0 0 40px rgba(40,80,255,.45);
      overflow:hidden;
    }
    .chart-inner-frame{
      position:absolute;
      inset:12px;
      border-radius:50%;
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 0 50px rgba(255,255,255,.12) inset;
      pointer-events:none;
    }
    .chart-img{
      position:absolute;
      inset:12px;
      border-radius:18px;
      width:calc(100% - 24px);
      height:calc(100% - 24px);
      object-fit:cover;
      z-index:2;
    }
    .chart-placeholder{
      position:absolute;
      inset:18px;
      border-radius:50%;
      border:1px dashed rgba(255,255,255,.25);
      display:flex;
      align-items:center;
      justify-content:center;
      color:rgba(255,255,255,.7);
      font-size:12px;
      text-align:center;
      padding:0 20px;
      z-index:1;
    }

    .chart-meta{
      margin-top:6px;
      font-size:12px;
      color:#cfd8ff;
      text-align:center;
    }

    .download-link{
      margin-top:4px;
      font-size:12px;
      color:#ffe680;
      text-decoration:none;
    }
    .download-link:hover{text-decoration:underline;}

    .status{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      text-align:left;
      width:100%;
    }
    .status.ok{color:var(--ok);}
    .status.error{color:var(--error);}

    .report-box{
      margin-top:8px;
      width:100%;
      max-height:220px;
      border-radius:12px;
      padding:12px 14px;
      background:rgba(3,9,26,.85);
      border:1px solid rgba(255,255,255,.12);
      overflow-y:auto;
      font-size:13px;
      line-height:1.65;
      text-align:left;
      white-space:pre-wrap;
    }

    .pdf-btn{
      margin-top:10px;
      width:100%;
      border-radius:999px;
      padding:9px 14px;
      border:1px solid rgba(255,255,255,.35);
      background:rgba(5,10,25,.9);
      color:#e8eeff;
      font-weight:600;
      font-size:13px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition:all .2s ease;
    }
    .pdf-btn:hover{
      border-color:#ffd54f;
      color:#fff8e0;
      box-shadow:0 12px 30px rgba(0,0,0,.7);
    }

    /* Footer */
    footer{
      max-width:960px;
      margin:0 auto 40px;
      text-align:center;
      font-size:13px;
      color:#aeb6d8;
      padding:18px 10px 0;
      border-top:1px solid rgba(255,255,255,.08);
    }
    footer a{color:#d8e4ff;text-decoration:none;}
    footer a:hover{color:#ffe680;}

    /* Ask MystAI FAB */
    .ask-fab{
      position:fixed;
      right:18px;
      bottom:18px;
      z-index:80;
      background:linear-gradient(135deg,#ffd54f,#ffe680);
      color:#111;
      border:none;
      border-radius:999px;
      padding:11px 18px;
      font-weight:800;
      box-shadow:0 9px 36px rgba(0,0,0,.6);
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      font-size:14px;
    }
    .ask-fab:hover{transform:translateY(-2px);filter:brightness(1.04);}

    .ask-modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.68);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:90;
    }
    .ask-card{
      width:min(720px,92vw);
      background:#0c1426;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      padding:18px 18px 16px;
      box-shadow:0 30px 80px rgba(0,0,0,.9);
    }
    .ask-title{
      margin:0 0 8px;
      color:#ffd54f;
      font-family:'Cinzel',serif;
      font-size:20px;
    }
    .ask-row{display:flex;gap:10px;margin-top:8px;}
    .ask-row textarea{
      flex:1;
      min-height:100px;
      max-height:200px;
      resize:vertical;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background:#050b1c;
      color:#e6ecff;
      padding:10px;
      font-family:inherit;
      font-size:14px;
    }
    .ask-actions{
      margin-top:10px;
      display:flex;
      justify-content:flex-end;
      gap:8px;
    }
    .ask-btn{
      border-radius:999px;
      border:none;
      padding:8px 14px;
      font-size:13px;
      cursor:pointer;
      font-weight:700;
    }
    .ask-secondary{
      background:transparent;
      color:#e6ecff;
      border:1px solid rgba(255,255,255,.3);
    }
    .ask-primary{
      background:#ffd54f;
      color:#111;
    }
    .ask-output{
      margin-top:12px;
      border-radius:10px;
      padding:10px 12px;
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      display:none;
      font-size:13px;
      white-space:pre-wrap;
    }
    .ask-hint{margin-top:6px;font-size:11px;color:var(--muted);}
    .spinner{display:none;margin-left:6px;}

    /* Print tweaks (kullanƒ±cƒ± tarayƒ±cƒ±dan yazdƒ±rƒ±rsa) */
    @media print{
      body{
        background:#fff;
        color:#000;
      }
      header,.ask-fab,footer{
        display:none !important;
      }
      main{
        margin:0;
        padding:0;
        grid-template-columns:1fr;
      }
      .panel{
        box-shadow:none;
        border:none;
        background:#fff;
        color:#000;
      }
      .report-box{
        max-height:none;
        border:none;
        background:#fff;
      }
    }

    @media(max-width:980px){
      main{
        margin-top:220px;
        grid-template-columns:minmax(0,1fr);
      }
      .panel{padding:18px 16px 22px;}
      .chart-container{width:min(380px,90vw);}
    }

    @media(max-width:640px){
      header{padding:10px 14px;}
      .floating-logo{height:110px;top:86px;}
      .welcome{display:none;}
      main{margin-top:200px;padding-inline:10px;}
    }
  </style>
</head>
<body>
  <header>
    <div class="lang-box">
      <button class="lang-btn" id="btn-en">EN</button>
      <button class="lang-btn secondary" id="btn-tr">TR</button>
    </div>
    <div class="nav-btns">
      <span id="user-welcome" class="welcome"></span>
      <button class="btn" id="backToApp" data-i18n="backApp">Back to App</button>
      <button class="btn" id="historyBtn" data-i18n="history">My History</button>
      <button class="btn" id="logoutBtn" data-i18n="logout">Logout</button>
    </div>
  </header>

  <img src="mystai-logo.png" alt="MystAI Logo" class="floating-logo" />

  <main>
    <!-- LEFT: FORM -->
    <section class="panel" id="formPanel">
      <h2 class="panel-title" data-i18n="formTitle">Your Birth Details</h2>
      <p class="panel-sub" data-i18n="formSub">
        Your birth data is kept private and is only used to generate your personal astrology report.
      </p>

      <div class="form-group">
        <label class="form-label" for="birthDate" data-i18n="birthDateLabel">Birth Date</label>
        <input id="birthDate" type="date" class="form-input" />
      </div>

      <div class="form-group">
        <label class="form-label" for="birthTime" data-i18n="birthTimeLabel">Birth Time</label>
        <input id="birthTime" type="time" class="form-input" />
        <div class="hint" data-i18n="birthTimeHint">
          If you are not sure, enter your best guess (e.g., 13:30).
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="birthPlace" data-i18n="birthPlaceLabel">Birth Place (City, Country)</label>
        <input id="birthPlace" type="text" class="form-input" placeholder="e.g., Izmir, Turkey" />
      </div>

      <div class="form-group">
        <label class="form-label" for="name" data-i18n="nameLabel">Name (optional)</label>
        <input id="name" type="text" class="form-input" />
      </div>

      <div class="form-group">
        <label class="form-label" data-i18n="focusLabel">Which areas should MystAI focus on?</label>
        <div class="chip-row">
          <div class="focus-chip active" data-key="love" data-i18n="chipLove">Love & Relationships</div>
          <div class="focus-chip active" data-key="career" data-i18n="chipCareer">Career & Life Path</div>
          <div class="focus-chip" data-key="money" data-i18n="chipMoney">Money & Abundance</div>
          <div class="focus-chip" data-key="spirit" data-i18n="chipSpirit">Spiritual Growth</div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="question" data-i18n="questionLabel">Any specific question or intention?</label>
        <textarea id="question" class="form-textarea" placeholder=""></textarea>
        <div class="hint" data-i18n="questionHint">
          Example: ‚ÄúHow will my love life and career be shaped in the next 12 months?‚Äù
        </div>
      </div>

      <!-- Solar Return yƒ±lƒ± (opsiyonel) -->
      <div class="form-group">
        <label class="form-label" for="solarYear" data-i18n="solarYearLabel">Solar Return Year (optional)</label>
        <input id="solarYear" type="number" class="form-input" placeholder="2025" />
        <div class="hint" data-i18n="solarYearHint">
          If empty, MystAI will use the current year.
        </div>
      </div>

      <button id="generateBtn" class="primary-btn" data-i18n="generateNatalBtn">
        Generate Natal Report
      </button>
      <div class="hint" style="margin-top:8px;" data-i18n="disclaimer">
        MystAI provides spiritual & entertainment-oriented guidance only and is not a substitute for medical, legal, financial or psychological advice.
      </div>
    </section>

    <!-- RIGHT: MODLAR / RAPORLAR -->
    <section class="panel" id="reportPanel">
      <div class="mode-tabs">
        <button class="mode-tab active" id="tab-natal" data-mode="natal" data-i18n="tabNatal">Natal Chart</button>
        <button class="mode-tab" id="tab-solar" data-mode="solar" data-i18n="tabSolar">Solar Return</button>
        <button class="mode-tab" id="tab-transits" data-mode="transits" data-i18n="tabTransits">Transits</button>
      </div>

      <!-- NATAL SECTION -->
      <div class="mode-section active" id="section-natal">
        <h2 class="section-title" data-i18n="natalTitle">Natal Astrology Report</h2>
        <p class="section-sub" data-i18n="natalSub">
          A deep, AI-enhanced interpretation of your natal chart, houses and aspects.
        </p>

        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-inner-frame"></div>
            <img id="chartImgNatal" class="chart-img" alt="Natal chart" style="display:none;">
            <div id="chartPlaceholderNatal" class="chart-placeholder" data-i18n="chartPlaceholderNatal">
              When you create your natal report, MystAI will draw a precise natal chart for you here.
            </div>
          </div>
          <div id="chartMetaNatal" class="chart-meta"></div>
          <a id="downloadChartNatal" href="#" class="download-link" style="display:none;" data-i18n="downloadChartNatal">
            Download natal chart as PNG
          </a>
        </div>

        <div id="statusLabelNatal" class="status"></div>
        <div id="astroTextNatal" class="report-box"></div>
        <button id="downloadPdfNatal" class="pdf-btn">
          üìÑ <span data-i18n="downloadPdfNatal">Download Natal PDF</span>
        </button>
      </div>

      <!-- SOLAR RETURN SECTION -->
      <div class="mode-section" id="section-solar">
        <h2 class="section-title" data-i18n="solarTitle">Solar Return Report</h2>
        <p class="section-sub" data-i18n="solarSub">
          A yearly overview based on your solar return chart: themes, lessons and opportunities.
        </p>

        <div class="chart-card">
          <div class="chart-container">
            <div class="chart-inner-frame"></div>
            <img id="chartImgSolar" class="chart-img" alt="Solar return chart" style="display:none;">
            <div id="chartPlaceholderSolar" class="chart-placeholder" data-i18n="chartPlaceholderSolar">
              When you create your solar return report, MystAI will draw a yearly chart for you here.
            </div>
          </div>
          <div id="chartMetaSolar" class="chart-meta"></div>
          <a id="downloadChartSolar" href="#" class="download-link" style="display:none;" data-i18n="downloadChartSolar">
            Download solar return chart as PNG
          </a>
        </div>

        <div id="statusLabelSolar" class="status"></div>
        <div id="astroTextSolar" class="report-box"></div>
        <button id="downloadPdfSolar" class="pdf-btn">
          üìÑ <span data-i18n="downloadPdfSolar">Download Solar Return PDF</span>
        </button>
      </div>

      <!-- TRANSITS SECTION -->
      <div class="mode-section" id="section-transits">
        <h2 class="section-title" data-i18n="transitTitle">Transit Report</h2>
        <p class="section-sub" data-i18n="transitSub">
          A focused interpretation of current and upcoming transits impacting your natal chart.
        </p>

        <!-- Transitlerde harita yok, sadece metin -->
        <div id="statusLabelTransits" class="status"></div>
        <div id="astroTextTransits" class="report-box"></div>
        <button id="downloadPdfTransits" class="pdf-btn">
          üìÑ <span data-i18n="downloadPdfTransits">Download Transits PDF</span>
        </button>
      </div>
    </section>
  </main>

  <footer>
    <div style="margin-bottom:6px;">
      <a href="terms.html" data-i18n="terms">Terms</a> ‚Ä¢
      <a href="privacy.html" data-i18n="privacy">Privacy</a> ‚Ä¢
      <a href="cookies.html" data-i18n="cookies">Cookies</a> ‚Ä¢
      <a href="disclaimer.html" data-i18n="footerDisclaimer">Disclaimer</a>
    </div>
    <p>
      ¬© 2025 MystAI.ai ‚Äî <span data-i18n="rights">All Rights Reserved.</span>
      <span data-i18n="dev">Developed by GALAXY üåå</span><br />
      <a href="mailto:support@mystai.ai">support@mystai.ai</a>
    </p>
  </footer>

  <!-- Ask MystAI FAB -->
  <button class="ask-fab" id="askFab">
    üîÆ <span data-i18n="ask">Ask MystAI</span>
  </button>

  <!-- Ask MystAI Modal -->
  <div class="ask-modal" id="askModal" role="dialog" aria-modal="true" aria-labelledby="askTitle">
    <div class="ask-card">
      <h2 class="ask-title" id="askTitle" data-i18n="askTitle">Ask MystAI üîÆ</h2>
      <div class="ask-row">
        <textarea id="askInput" placeholder=""></textarea>
      </div>
      <div class="ask-hint" id="askHint"></div>
      <div class="ask-actions">
        <button class="ask-btn ask-secondary" id="askClose" data-i18n="close">Close</button>
        <button class="ask-btn ask-primary" id="askSend">
          <span data-i18n="send">Send</span>
          <span class="spinner" id="askSpin">‚è≥</span>
        </button>
      </div>
      <div class="ask-output" id="askOutput"></div>
      <audio id="askAudio" style="display:none;"></audio>
    </div>
  </div>

  <script type="module">
    /* ========= CONFIG ========= */
    const BACKEND_URL = "https://mystai-international.onrender.com";

    /* ========= Firebase (auth) ========= */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDyiD7GAfOjMbtm-S6pO6XCSRXJclffPL0",
      authDomain: "mystai-6cca2.firebaseapp.com",
      projectId: "mystai-6cca2",
      storageBucket: "mystai-6cca2.appspot.com",
      messagingSenderId: "624127781219",
      appId: "1:624127781219:web:a580ac6e80ccc26e694b56"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const logoutBtn   = document.getElementById("logoutBtn");
    const historyBtn  = document.getElementById("historyBtn");
    const backToApp   = document.getElementById("backToApp");
    const userWelcome = document.getElementById("user-welcome");

    logoutBtn.addEventListener("click", () => {
      signOut(auth).then(() => window.location.href = "login.html");
    });
    historyBtn.addEventListener("click", () => window.location.href = "history.html");
    backToApp.addEventListener("click", () => window.location.href = "app.html");

    /* ========= i18n ========= */
    const i18n = {
      en: {
        formTitle:"Your Birth Details",
        formSub:"Your birth data is kept private and is only used to generate your personal astrology report.",
        birthDateLabel:"Birth Date",
        birthTimeLabel:"Birth Time",
        birthTimeHint:"If you are not sure, enter your best guess (e.g., 13:30).",
        birthPlaceLabel:"Birth Place (City, Country)",
        nameLabel:"Name (optional)",
        focusLabel:"Which areas should MystAI focus on?",
        chipLove:"Love & Relationships",
        chipCareer:"Career & Life Path",
        chipMoney:"Money, abundance and material matters",
        chipSpirit:"Spiritual growth and inner journey",
        questionLabel:"Any specific question or intention?",
        questionHint:"Example: ‚ÄúHow will my love life and career be shaped in the next 12 months?‚Äù",
        solarYearLabel:"Solar Return Year (optional)",
        solarYearHint:"If empty, MystAI will use the current year.",
        /* Tabs + section titles */
        tabNatal:"Natal Chart",
        tabSolar:"Solar Return",
        tabTransits:"Transits",
        natalTitle:"Natal Astrology Report",
        natalSub:"A deep, AI-enhanced interpretation of your natal chart, houses and aspects.",
        solarTitle:"Solar Return Report",
        solarSub:"A yearly overview based on your solar return chart: themes, lessons and opportunities.",
        transitTitle:"Transit Report",
        transitSub:"A focused interpretation of current and upcoming transits impacting your natal chart.",
        chartPlaceholderNatal:"When you create your natal report, MystAI will draw a precise natal chart for you here.",
        chartPlaceholderSolar:"When you create your solar return report, MystAI will draw a yearly chart for you here.",
        downloadChartNatal:"Download natal chart as PNG",
        downloadChartSolar:"Download solar return chart as PNG",
        generateNatalBtn:"Generate Natal Report",
        generateSolarBtn:"Generate Solar Return Report",
        generateTransitBtn:"Generate Transit Report",
        statusWorking:"Preparing your personal chart and AI interpretation...",
        statusOk:"Your AI astrology report has been generated.",
        statusError:"An error occurred while generating your report. Please try again.",
        downloadPdfNatal:"Download Natal PDF",
        downloadPdfSolar:"Download Solar Return PDF",
        downloadPdfTransits:"Download Transits PDF",
        disclaimer:"MystAI provides spiritual & entertainment-oriented guidance only and does not replace medical, legal, financial or psychological advice.",
        terms:"Terms",
        privacy:"Privacy",
        cookies:"Cookies",
        footerDisclaimer:"Disclaimer",
        rights:"All Rights Reserved.",
        dev:"Developed by GALAXY üåå",
        backApp:"Back to App",
        history:"My History",
        logout:"Logout",
        ask:"Ask MystAI",
        askTitle:"Ask MystAI üîÆ",
        send:"Send",
        close:"Close",
        askHint:"Tip: You can ask about your energy, dreams, love, career, destiny or current feelings.",
        askPlaceholder:"Type your question...",
      },
      tr: {
        formTitle:"Doƒüum Bilgilerin",
        formSub:"Doƒüum verilerin gizli tutulur ve sadece ki≈üisel astroloji raporunu olu≈üturmak i√ßin kullanƒ±lƒ±r.",
        birthDateLabel:"Doƒüum Tarihi",
        birthTimeLabel:"Doƒüum Saati",
        birthTimeHint:"Tam emin deƒüilsen, yakla≈üƒ±k bir saat yazabilirsin (√∂rn. 13:30).",
        birthPlaceLabel:"Doƒüum Yeri (≈ûehir, √úlke)",
        nameLabel:"ƒ∞smin (opsiyonel)",
        focusLabel:"MystAI hangi alanlara odaklansƒ±n?",
        chipLove:"A≈ük & ƒ∞li≈ükiler",
        chipCareer:"Kariyer & Ya≈üam Yolu",
        chipMoney:"Para, bolluk ve maddi alanlar",
        chipSpirit:"Ruhsal geli≈üim ve i√ßsel yolculuk",
        questionLabel:"√ñzel bir sorun ya da niyetin var mƒ±?",
        questionHint:"√ñrnek: ‚Äú√ñn√ºm√ºzdeki 12 ay a≈ük ve kariyerim nasƒ±l ≈üekilleniyor?‚Äù",
        solarYearLabel:"Solar Return Yƒ±lƒ± (opsiyonel)",
        solarYearHint:"Bo≈ü bƒ±rakƒ±rsan, MystAI i√ßinde bulunduƒüun yƒ±lƒ± kullanƒ±r.",
        /* Tabs + section titles */
        tabNatal:"Natal Harita",
        tabSolar:"Solar Return",
        tabTransits:"Transitler",
        natalTitle:"Natal Astroloji Raporun",
        natalSub:"Doƒüum haritandaki gezegenler, evler ve a√ßƒ±lar √ºzerinden derinlemesine, yapay zek√¢ destekli bir yorum.",
        solarTitle:"Solar Return Raporun",
        solarSub:"Bu yƒ±lƒ±n ana temalarƒ±, dersleri ve fƒ±rsatlarƒ± √ºzerine yƒ±llƒ±k solar return yorumun.",
        transitTitle:"Transit Raporun",
        transitSub:"≈ûu anki ve yakla≈üan transitlerin doƒüum haritandaki etkilerine odaklanan g√ºncel bir yorum.",
        chartPlaceholderNatal:"Natal raporunu olu≈üturduƒüunda MystAI sana √∂zel, ger√ßek√ßi bir doƒüum haritasƒ± √ßizecek.",
        chartPlaceholderSolar:"Solar return raporunu olu≈üturduƒüunda MystAI o yƒ±la ait yƒ±llƒ±k haritanƒ± √ßizecek.",
        downloadChartNatal:"Natal haritayƒ± PNG olarak indir",
        downloadChartSolar:"Solar return haritasƒ±nƒ± PNG olarak indir",
        generateNatalBtn:"Natal Raporu Olu≈ütur",
        generateSolarBtn:"Solar Return Raporu Olu≈ütur",
        generateTransitBtn:"Transit Raporu Olu≈ütur",
        statusWorking:"Ki≈üisel haritan ve yapay zek√¢ yorumun hazƒ±rlanƒ±yor...",
        statusOk:"Yapay zek√¢ astroloji raporun hazƒ±r.",
        statusError:"Rapor olu≈üturulurken bir hata olu≈ütu. L√ºtfen tekrar dene.",
        downloadPdfNatal:"Natal Raporunu PDF olarak indir",
        downloadPdfSolar:"Solar Return Raporunu PDF olarak indir",
        downloadPdfTransits:"Transit Raporunu PDF olarak indir",
        disclaimer:"MystAI yalnƒ±zca ruhsal ve eƒülence ama√ßlƒ± i√ßg√∂r√ºler sunar; tƒ±bbi, hukuki, finansal veya psikolojik danƒ±≈ümanlƒ±ƒüƒ±n yerine ge√ßmez.",
        terms:"≈ûartlar",
        privacy:"Gizlilik",
        cookies:"√áerezler",
        footerDisclaimer:"Sorumluluk Reddi",
        rights:"T√ºm Haklarƒ± Saklƒ±dƒ±r.",
        dev:"GALAXY tarafƒ±ndan geli≈ütirilmi≈ütir üåå",
        backApp:"Uygulamaya D√∂n",
        history:"Ge√ßmi≈üim",
        logout:"√áƒ±kƒ±≈ü Yap",
        ask:"MystAI'ye Sor",
        askTitle:"MystAI'ye Sor üîÆ",
        send:"G√∂nder",
        close:"Kapat",
        askHint:"ƒ∞pucu: Enerji, r√ºyalar, a≈ük, kariyer, kader veya ≈üu anki ruh halin hakkƒ±nda sorular sorabilirsin.",
        askPlaceholder:"Sorunu yaz...",
      }
    };

    let activeLang = localStorage.getItem("myst_lang") || "tr";
    let activeMode = "natal"; // natal | solar | transits

    const natalTab   = document.getElementById("tab-natal");
    const solarTab   = document.getElementById("tab-solar");
    const transTab   = document.getElementById("tab-transits");

    const sectionNatal   = document.getElementById("section-natal");
    const sectionSolar   = document.getElementById("section-solar");
    const sectionTrans   = document.getElementById("section-transits");

    const generateBtn  = document.getElementById("generateBtn");

    /* ========= i18n helper ========= */
    function setLang(lang){
      activeLang = lang;
      localStorage.setItem("myst_lang", lang);
      const dict = i18n[lang];

      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key = el.getAttribute("data-i18n");
        if(!dict[key]) return;
        if(key === "formSub"){
          el.innerHTML = dict[key];
        }else{
          el.textContent = dict[key];
        }
      });

      document.getElementById("askInput").placeholder = dict.askPlaceholder;
      document.getElementById("askHint").textContent = dict.askHint;

      document.getElementById("btn-en").classList.toggle("secondary", lang!=="en");
      document.getElementById("btn-tr").classList.toggle("secondary", lang!=="tr");

      // aktif moda g√∂re buton yazƒ±sƒ±
      updateGenerateButtonLabel();

      if(auth.currentUser){
        const name = auth.currentUser.displayName || auth.currentUser.email;
        userWelcome.textContent = (lang === "tr" ? "Ho≈ü geldin, " : "Welcome, ") + name;
      }
    }

    document.getElementById("btn-en").addEventListener("click",()=>setLang("en"));
    document.getElementById("btn-tr").addEventListener("click",()=>setLang("tr"));
    setLang(activeLang);

    onAuthStateChanged(auth, user=>{
      if(user){
        const name = user.displayName || user.email;
        userWelcome.textContent = (activeLang==="tr" ? "Ho≈ü geldin, " : "Welcome, ")+name;
      }else{
        window.location.href = "login.html";
      }
    });

    /* ========= Focus chips ========= */
    document.querySelectorAll(".focus-chip").forEach(chip=>{
      chip.addEventListener("click", ()=>{
        chip.classList.toggle("active");
      });
    });

    /* ========= Tabs (natal / solar / transits) ========= */
    function setActiveMode(mode){
      activeMode = mode;

      natalTab.classList.toggle("active", mode==="natal");
      solarTab.classList.toggle("active", mode==="solar");
      transTab.classList.toggle("active", mode==="transits");

      sectionNatal.classList.toggle("active", mode==="natal");
      sectionSolar.classList.toggle("active", mode==="solar");
      sectionTrans.classList.toggle("active", mode==="transits");

      updateGenerateButtonLabel();
    }

    function updateGenerateButtonLabel(){
      const dict = i18n[activeLang];
      if(activeMode==="natal"){
        generateBtn.textContent = dict.generateNatalBtn;
      }else if(activeMode==="solar"){
        generateBtn.textContent = dict.generateSolarBtn;
      }else{
        generateBtn.textContent = dict.generateTransitBtn;
      }
    }

    natalTab.addEventListener("click", ()=> setActiveMode("natal"));
    solarTab.addEventListener("click", ()=> setActiveMode("solar"));
    transTab.addEventListener("click", ()=> setActiveMode("transits"));

    /* ========= DOM referanslarƒ± ========= */
    // Ortak form
    const birthDateInput  = document.getElementById("birthDate");
    const birthTimeInput  = document.getElementById("birthTime");
    const birthPlaceInput = document.getElementById("birthPlace");
    const nameInput       = document.getElementById("name");
    const questionInput   = document.getElementById("question");
    const solarYearInput  = document.getElementById("solarYear");

    // NATAL
    const astroTextNatal      = document.getElementById("astroTextNatal");
    const statusLabelNatal    = document.getElementById("statusLabelNatal");
    const chartImgNatal       = document.getElementById("chartImgNatal");
    const chartPlaceholderNat = document.getElementById("chartPlaceholderNatal");
    const chartMetaNatal      = document.getElementById("chartMetaNatal");
    const downloadChartNatal  = document.getElementById("downloadChartNatal");
    const downloadPdfNatal    = document.getElementById("downloadPdfNatal");
    let lastNatalChartURL = "";
    let lastNatalChartId  = "";

    // SOLAR
    const astroTextSolar      = document.getElementById("astroTextSolar");
    const statusLabelSolar    = document.getElementById("statusLabelSolar");
    const chartImgSolar       = document.getElementById("chartImgSolar");
    const chartPlaceholderSol = document.getElementById("chartPlaceholderSolar");
    const chartMetaSolar      = document.getElementById("chartMetaSolar");
    const downloadChartSolar  = document.getElementById("downloadChartSolar");
    const downloadPdfSolar    = document.getElementById("downloadPdfSolar");
    let lastSolarChartURL = "";
    let lastSolarChartId  = "";

    // TRANSITS
    const astroTextTransits   = document.getElementById("astroTextTransits");
    const statusLabelTransits = document.getElementById("statusLabelTransits");
    const downloadPdfTransits = document.getElementById("downloadPdfTransits");

    const dictFor = () => i18n[activeLang];

    /* ========= Rapor √ºret (aktif moda g√∂re) ========= */
    generateBtn.addEventListener("click", async ()=>{
      const birthDate  = birthDateInput.value;
      const birthTime  = birthTimeInput.value;
      const birthPlace = birthPlaceInput.value.trim();
      const name       = nameInput.value.trim();
      const question   = questionInput.value.trim();
      const dict       = dictFor();

      if(!birthDate || !birthTime || !birthPlace){
        alert(dict.missingFields || (activeLang==="tr"
          ? "L√ºtfen doƒüum tarihi, saati ve yeri alanlarƒ±nƒ± doldur."
          : "Please fill in birth date, time and place."));
        return;
      }

      const focusKeys = [];
      document.querySelectorAll(".focus-chip.active").forEach(ch=>{
        focusKeys.push(ch.dataset.key);
      });

      try{
        generateBtn.disabled = true;

        if(activeMode==="natal"){
          // UI reset
          astroTextNatal.textContent = "";
          statusLabelNatal.textContent = dict.statusWorking;
          statusLabelNatal.className = "status";
          chartMetaNatal.textContent = "";
          lastNatalChartURL = "";
          lastNatalChartId  = "";
          chartImgNatal.style.display = "none";
          chartPlaceholderNat.style.display = "flex";
          downloadChartNatal.style.display = "none";

          const payload = {
            birth_date: birthDate,
            birth_time: birthTime,
            birth_place: birthPlace,
            name: name,
            focus_areas: focusKeys,
            question: question,
            language: activeLang
          };

          const res = await fetch(`${BACKEND_URL}/astrology-premium`, {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify(payload)
          });

          if(!res.ok){
            throw new Error("HTTP " + res.status);
          }
          const data = await res.json();
          if(data.error){
            throw new Error(data.error);
          }

          const text    = data.text || "";
          const chart   = data.chart;
          const chartId = data.chart_id;

          astroTextNatal.textContent = text || (activeLang==="tr"
            ? "Metin raporu alƒ±namadƒ±."
            : "No report text received.");

          statusLabelNatal.textContent = dict.statusOk;
          statusLabelNatal.className = "status ok";

          const metaLine = (activeLang==="tr"
            ? `Doƒüum tarihi: ${birthDate} ‚Ä¢ Doƒüum saati: ${birthTime} ‚Ä¢ Doƒüum yeri: ${birthPlace}`
            : `Birth date: ${birthDate} ‚Ä¢ Birth time: ${birthTime} ‚Ä¢ Birth place: ${birthPlace}`);
          chartMetaNatal.textContent = metaLine;

          if(chart && chartId){
            const url = chart.startsWith("http") ? chart : `${BACKEND_URL}${chart}`;
            lastNatalChartURL = url;
            lastNatalChartId  = chartId;
            chartImgNatal.src = url;
            chartImgNatal.style.display = "block";
            chartPlaceholderNat.style.display = "none";
            downloadChartNatal.href = url;
            downloadChartNatal.setAttribute("download","mystai_natal_chart.png");
            downloadChartNatal.style.display = "inline-block";
          }

        } else if(activeMode==="solar"){
          astroTextSolar.textContent = "";
          statusLabelSolar.textContent = dict.statusWorking;
          statusLabelSolar.className = "status";
          chartMetaSolar.textContent = "";
          lastSolarChartURL = "";
          lastSolarChartId  = "";
          chartImgSolar.style.display = "none";
          chartPlaceholderSol.style.display = "flex";
          downloadChartSolar.style.display = "none";

          const yearVal = solarYearInput.value ? parseInt(solarYearInput.value,10) : null;

          const payload = {
            birth_date: birthDate,
            birth_time: birthTime,
            birth_place: birthPlace,
            year: yearVal,
            language: activeLang
          };

          const res = await fetch(`${BACKEND_URL}/solar-return`, {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify(payload)
          });

          if(!res.ok){
            throw new Error("HTTP " + res.status);
          }
          const data = await res.json();
          if(data.error){
            throw new Error(data.error);
          }

          const text    = data.text || "";
          const chart   = data.chart;
          const chartId = data.chart_id;
          const yearUsed = yearVal || (new Date().getFullYear());

          astroTextSolar.textContent = text || (activeLang==="tr"
            ? "Solar return metni alƒ±namadƒ±."
            : "No solar return text received.");

          statusLabelSolar.textContent = dict.statusOk;
          statusLabelSolar.className = "status ok";

          const metaLine = (activeLang==="tr"
            ? `Solar return yƒ±lƒ±: ${yearUsed} ‚Ä¢ Doƒüum: ${birthDate} ‚Ä¢ Saat: ${birthTime} ‚Ä¢ Yer: ${birthPlace}`
            : `Solar return year: ${yearUsed} ‚Ä¢ Birth: ${birthDate} ‚Ä¢ Time: ${birthTime} ‚Ä¢ Place: ${birthPlace}`);
          chartMetaSolar.textContent = metaLine;

          if(chart && chartId){
            const url = chart.startsWith("http") ? chart : `${BACKEND_URL}${chart}`;
            lastSolarChartURL = url;
            lastSolarChartId  = chartId;
            chartImgSolar.src = url;
            chartImgSolar.style.display = "block";
            chartPlaceholderSol.style.display = "none";
            downloadChartSolar.href = url;
            downloadChartSolar.setAttribute("download","mystai_solar_return_chart.png");
            downloadChartSolar.style.display = "inline-block";
          }

        } else { // transits
          astroTextTransits.textContent = "";
          statusLabelTransits.textContent = dict.statusWorking;
          statusLabelTransits.className = "status";

          const payload = {
            birth_date: birthDate,
            birth_time: birthTime,
            birth_place: birthPlace,
            name: name,
            language: activeLang
          };

          const res = await fetch(`${BACKEND_URL}/transits`, {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify(payload)
          });

          if(!res.ok){
            throw new Error("HTTP " + res.status);
          }
          const data = await res.json();
          if(data.error){
            throw new Error(data.error);
          }

          const text = data.text || "";
          astroTextTransits.textContent = text || (activeLang==="tr"
            ? "Transit raporu alƒ±namadƒ±."
            : "No transit report received.");

          statusLabelTransits.textContent = dict.statusOk;
          statusLabelTransits.className = "status ok";
        }

      }catch(err){
        console.error(err);
        const msg = dict.statusError + " (" + (err?.message || err) + ")";
        if(activeMode==="natal"){
          statusLabelNatal.textContent = msg;
          statusLabelNatal.className = "status error";
        }else if(activeMode==="solar"){
          statusLabelSolar.textContent = msg;
          statusLabelSolar.className = "status error";
        }else{
          statusLabelTransits.textContent = msg;
          statusLabelTransits.className = "status error";
        }
      }finally{
        generateBtn.disabled = false;
      }
    });

    downloadChartNatal.addEventListener("click",(e)=>{
      if(!lastNatalChartURL){ e.preventDefault(); }
    });
    downloadChartSolar.addEventListener("click",(e)=>{
      if(!lastSolarChartURL){ e.preventDefault(); }
    });

    /* ========= PDF butonlarƒ± (her mod ayrƒ±) ========= */
    async function downloadPdfFor(mode){
      const dict = dictFor();
      try{
        let text = "";
        let chartId = null;
        let filename = "";

        if(mode==="natal"){
          text = (astroTextNatal.textContent || "").trim();
          chartId = lastNatalChartId || null;
          filename = activeLang==="tr"
            ? "MystAI_natal_raporu.pdf"
            : "MystAI_natal_report.pdf";
        }else if(mode==="solar"){
          text = (astroTextSolar.textContent || "").trim();
          chartId = lastSolarChartId || null;
          filename = activeLang==="tr"
            ? "MystAI_solar_return_raporu.pdf"
            : "MystAI_solar_return_report.pdf";
        }else{
          text = (astroTextTransits.textContent || "").trim();
          chartId = null;
          filename = activeLang==="tr"
            ? "MystAI_transit_raporu.pdf"
            : "MystAI_transits_report.pdf";
        }

        if(!text){
          alert(activeLang==="tr"
            ? "√ñnce bu mod i√ßin rapor olu≈üturmalƒ±sƒ±n."
            : "Please generate the report for this mode first.");
          return;
        }

       const payload = {
    text,
    chart_id: chartId,
    language: activeLang,
    report_type: mode   // ‚Üê BUNU EKLƒ∞YORSUN
};

        const res = await fetch(`${BACKEND_URL}/generate_pdf`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify(payload)
        });

        if(!res.ok){
          throw new Error("HTTP " + res.status);
        }

        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

      }catch(err){
        console.error(err);
        alert((activeLang==="tr"
          ? "PDF olu≈üturulurken bir hata olu≈ütu: "
          : "Error while generating PDF: ") + (err?.message || err));
      }
    }

    downloadPdfNatal.addEventListener("click", ()=>downloadPdfFor("natal"));
    downloadPdfSolar.addEventListener("click", ()=>downloadPdfFor("solar"));
    downloadPdfTransits.addEventListener("click", ()=>downloadPdfFor("transits"));

    /* ========= Ask MystAI modal ========= */
    const askFab    = document.getElementById("askFab");
    const askModal  = document.getElementById("askModal");
    const askClose  = document.getElementById("askClose");
    const askSend   = document.getElementById("askSend");
    const askInput  = document.getElementById("askInput");
    const askOutput = document.getElementById("askOutput");
    const askSpin   = document.getElementById("askSpin");
    const askAudio  = document.getElementById("askAudio");

    askFab.addEventListener("click", ()=>{
      askModal.style.display = "flex";
      askInput.focus();
    });

    askClose.addEventListener("click", ()=>{
      askModal.style.display = "none";
      askOutput.style.display = "none";
      askInput.value = "";
      askAudio.pause();
      askAudio.currentTime = 0;
      askAudio.src = "";
    });

    askModal.addEventListener("click", (e)=>{
      if(e.target === askModal){
        askClose.click();
      }
    });

    askSend.addEventListener("click", async ()=>{
      const q = askInput.value.trim();
      const dict = dictFor();

      if(!q){
        alert(activeLang==="tr" ? "L√ºtfen bir soru yaz." : "Please type a question.");
        return;
      }

      askSpin.style.display = "inline-block";
      askSend.disabled = true;
      askOutput.style.display = "none";
      askOutput.textContent = "";
      askAudio.pause();
      askAudio.currentTime = 0;
      askAudio.src = "";

      try{
        if(!BACKEND_URL || BACKEND_URL.includes("YOUR-BACKEND-URL")){
          askOutput.style.display = "block";
          askOutput.textContent = activeLang==="tr"
            ? "Backend adresi yapƒ±landƒ±rƒ±lmadƒ±."
            : "Backend URL is not configured.";
          return;
        }

        const res = await fetch(`${BACKEND_URL}/predict`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({ user_input:q, language:activeLang })
        });

        if(!res.ok){
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const text = data?.text || (activeLang==="tr" ? "Yanƒ±t alƒ±namadƒ±." : "No response.");
        const audioPath = data?.audio;

        askOutput.style.display = "block";
        askOutput.textContent = text;

        if(audioPath){
          const url = audioPath.startsWith("http") ? audioPath : `${BACKEND_URL}${audioPath}`;
          askAudio.src = url;
          askAudio.play().catch(()=>{});
        }
      }catch(err){
        askOutput.style.display = "block";
        askOutput.textContent = (activeLang==="tr" ? "Hata: " : "Error: ") + (err?.message || err);
      }finally{
        askSpin.style.display = "none";
        askSend.disabled = false;
      }
    });
  </script>
</body>
</html>
