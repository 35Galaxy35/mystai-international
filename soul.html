<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MystAI â€” Soul Connection Reading</title>
  <link rel="icon" type="image/png" href="mystai-logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg-start:#050716;
      --bg-end:#050915;
      --card:#060e26;
      --card-soft:#0b1636;
      --accent:#f6d35f;
      --accent-soft:#f3d97f;
      --text:#e4e9ff;
      --muted:#9ba5d2;
      --danger:#ff4b6b;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      color:var(--text);
      background:
        radial-gradient(circle at 20% -10%, #293b86 0, transparent 55%),
        radial-gradient(circle at 80% -10%, #5a378e 0, transparent 60%),
        radial-gradient(circle at 50% 120%, #1b285a 0, transparent 60%),
        linear-gradient(180deg, var(--bg-start), var(--bg-end));
      background-attachment:fixed;
    }

    /* Top Bar */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px 22px;
      background:rgba(3,5,18,.80);
      backdrop-filter:blur(18px);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .top-left,.top-right{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .flag-btn{
      width:34px;height:34px;
      border-radius:50%;
      border:2px solid transparent;
      background-size:cover;
      background-position:center;
      cursor:pointer;
      box-shadow:0 0 0 1px rgba(255,255,255,.08);
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .flag-btn.en{background-image:url("https://flagcdn.com/w40/gb.png");}
    .flag-btn.tr{background-image:url("https://flagcdn.com/w40/tr.png");}
    .flag-btn.active{
      transform:scale(1.06);
      border-color:var(--accent);
      box-shadow:0 0 12px rgba(246,211,95,.85);
    }
    .flag-btn:hover{transform:scale(1.08);}

    .user-label{
      font-size:13px;
      color:var(--accent-soft);
      text-shadow:0 0 12px rgba(246,211,95,.6);
      white-space:nowrap;
    }

    .nav-pill{
      border:0;
      border-radius:999px;
      padding:7px 14px;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      background:rgba(255,255,255,.12);
      color:var(--text);
      display:flex;
      align-items:center;
      gap:5px;
      transition:all .18s ease;
    }
    .nav-pill:hover{
      filter:brightness(1.15);
      transform:translateY(-1px);
    }

    /* Layout */
    .wrapper{
      flex:1;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:30px 14px 40px;
    }

    .shell{
      width:100%;
      max-width:1120px;
      background:radial-gradient(circle at top,#1a2658 0,#080d22 55%,#050812 100%);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.14);
      box-shadow:
        0 0 40px rgba(0,0,0,.55),
        0 0 90px rgba(78,56,163,.55);
      padding:26px 26px 24px;
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);
      gap:22px;
      position:relative;
      overflow:hidden;
    }

    .shell::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(255,255,255,.06), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(246,211,95,.18), transparent 50%);
      opacity:.55;
      mix-blend-mode:soft-light;
      pointer-events:none;
    }

    @media(max-width:930px){
      .shell{
        grid-template-columns:1fr;
        padding:22px 18px 20px;
      }
    }

    /* Section headers */
    .section-kicker{
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:var(--accent-soft);
      text-align:left;
      margin-bottom:4px;
    }
    .section-title{
      font-family:"Cinzel",serif;
      font-size:28px;
      color:#ffe8a8;
      text-align:left;
      margin:0 0 10px;
      text-shadow:0 0 14px rgba(246,211,95,.7);
    }
    .section-sub{
      text-align:left;
      font-size:14px;
      color:var(--muted);
      line-height:1.6;
      margin-bottom:18px;
    }

    .step-row{
      display:flex;
      gap:10px;
      align-items:flex-start;
      margin-bottom:8px;
      font-size:13px;
      color:var(--muted);
    }
    .step-badge{
      width:18px;height:18px;
      border-radius:50%;
      background:linear-gradient(135deg,var(--accent),#ffefb5);
      color:#221b03;
      display:flex;align-items:center;justify-content:center;
      font-size:11px;
      font-weight:800;
      box-shadow:0 0 10px rgba(246,211,95,.85);
      flex-shrink:0;
      margin-top:2px;
    }

    .divider{
      height:1px;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.24),transparent);
      margin:14px 0 10px;
      opacity:.7;
    }

    /* Labels & controls */
    .field-label{
      font-size:12px;
      font-weight:600;
      color:var(--accent-soft);
      margin-bottom:6px;
      text-align:left;
      letter-spacing:.04em;
      text-transform:uppercase;
    }

    .two-col{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
    }
    @media(max-width:600px){
      .two-col{grid-template-columns:1fr;}
    }

    .input-box{
      background:rgba(4,9,30,.85);
      border-radius:10px;
      border:1px solid rgba(255,255,255,.16);
      padding:7px 9px 6px;
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .input-label-small{
      font-size:11px;
      color:var(--muted);
    }

    .text-input{
      width:100%;
      border:0;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size:13px;
    }
    .text-input::placeholder{
      color:#6f78ae;
    }

    /* Relation select */
    .select-wrap{
      position:relative;
      display:block;
      background:rgba(4,9,30,.85);
      border-radius:10px;
      border:1px solid rgba(255,255,255,.16);
      padding:2px 9px;
    }
    .select-wrap select{
      width:100%;
      border:0;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size:13px;
      padding:7px 20px 7px 0;
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
    }
    .select-wrap::after{
      content:"â–¾";
      position:absolute;
      right:9px;
      top:50%;
      transform:translateY(-50%);
      font-size:11px;
      color:var(--accent-soft);
      pointer-events:none;
    }

    textarea{
      width:100%;
      min-height:90px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.15);
      background:radial-gradient(circle at top,#111a46,#04081c);
      color:var(--text);
      padding:10px 11px;
      font-size:13px;
      font-family:inherit;
      resize:vertical;
      outline:none;
      box-shadow:inset 0 0 12px rgba(0,0,0,.55);
    }
    textarea::placeholder{
      color:#767fb3;
    }

    .primary-btn{
      margin-top:14px;
      border:0;
      border-radius:14px;
      padding:10px 18px;
      font-size:14px;
      font-weight:800;
      cursor:pointer;
      background:conic-gradient(from 210deg at 50% 50%,#ffe9b0,#fbd36a,#f8c24a,#ffe9b0);
      color:#241b03;
      box-shadow:
        0 0 22px rgba(246,211,95,.95),
        0 0 60px rgba(246,211,95,.45);
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-transform:uppercase;
      letter-spacing:.06em;
      transition:all .18s ease;
    }
    .primary-btn:hover{
      transform:translateY(-2px) scale(1.02);
      filter:brightness(1.03);
    }
    .primary-btn:disabled{
      opacity:.6;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    .status{
      margin-top:6px;
      font-size:11px;
      color:var(--muted);
      text-align:left;
      min-height:14px;
    }

    /* Right side â€“ Result */
    .result-panel{
      position:relative;
      border-radius:18px;
      background:radial-gradient(circle at 0 0,#324089,#080f2a 40%,#040816 100%);
      border:1px solid rgba(255,255,255,.18);
      padding:14px 13px 12px;
      box-shadow:0 0 26px rgba(0,0,0,.75);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .result-panel::before{
      content:"";
      position:absolute;
      inset:-20%;
      background:
        radial-gradient(circle at 0 0,rgba(246,211,95,.2),transparent 50%),
        radial-gradient(circle at 100% 0,rgba(146,214,255,.18),transparent 55%);
      opacity:.9;
      mix-blend-mode:soft-light;
      pointer-events:none;
    }

    .result-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      position:relative;
      z-index:1;
    }
    .result-title{
      font-size:14px;
      font-weight:700;
      color:#ffe6a0;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .result-sub{
      font-size:11px;
      color:var(--muted);
      margin-top:2px;
    }

    .audio-btn{
      border-radius:999px;
      border:0;
      padding:6px 11px;
      font-size:11px;
      font-weight:600;
      cursor:pointer;
      background:rgba(3,7,26,.9);
      color:var(--text);
      display:flex;
      align-items:center;
      gap:6px;
      box-shadow:0 0 0 1px rgba(255,255,255,.22);
      transition:all .18s ease;
    }
    .audio-btn:hover{filter:brightness(1.1);}
    .audio-btn:disabled{
      opacity:.5;
      cursor:not-allowed;
      box-shadow:none;
    }

    .result-body{
      position:relative;
      z-index:1;
      margin-top:10px;
      flex:1;
      display:flex;
      flex-direction:column;
    }
    .result-text{
      flex:1;
      font-size:13px;
      color:var(--text);
      line-height:1.7;
      white-space:pre-wrap;
      overflow-y:auto;
      max-height:340px; /* daha uzun yorumlar iÃ§in artÄ±rÄ±ldÄ± */
      padding-right:4px;
    }
    .result-hint{
      margin-top:8px;
      font-size:11px;
      color:var(--muted);
    }

    /* Footer */
    footer{
      border-top:1px solid rgba(255,255,255,.08);
      padding:16px 10px 18px;
      text-align:center;
      font-size:12px;
      color:#a9b3dc;
    }
    footer a{
      color:var(--accent-soft);
      text-decoration:none;
      font-weight:600;
    }
    footer a:hover{
      color:#fffad0;
      text-shadow:0 0 9px rgba(246,211,95,.8);
    }
  </style>
</head>
<body>
  <!-- TOP BAR -->
  <div class="topbar">
    <div class="top-left">
      <button id="btn-en" class="flag-btn en"></button>
      <button id="btn-tr" class="flag-btn tr"></button>
    </div>
    <div class="top-right">
      <span id="userLabel" class="user-label"></span>
      <button id="backBtn" class="nav-pill">â¬… Back</button>
      <button id="logoutBtn" class="nav-pill">Logout</button>
    </div>
  </div>

  <div class="wrapper">
    <div class="shell">
      <!-- LEFT SIDE -->
      <div>
        <div class="section-kicker" id="kickerLabel">MystAI Â· Soul Gate</div>
        <h1 class="section-title" id="titleLabel">Soul Connection Reading</h1>
        <p class="section-sub" id="subtitleLabel">
          Enter both names, birth dates and the nature of your relationship.
          MystAI will explore the energetic and spiritual dynamics between you.
        </p>

        <div class="step-row">
          <div class="step-badge">1</div>
          <div id="step1Text">Fill in the names and birth dates of both people in this connection.</div>
        </div>
        <div class="step-row">
          <div class="step-badge">2</div>
          <div id="step2Text">Choose your relationship type and briefly describe the current situation.</div>
        </div>
        <div class="step-row">
          <div class="step-badge">3</div>
          <div id="step3Text">Write your question or intention and let MystAI mirror your soul bond.</div>
        </div>

        <div class="divider"></div>

        <!-- PEOPLE -->
        <div class="field-label" id="peopleLabel">People in this connection</div>

        <div class="two-col" style="margin-bottom:10px;">
          <div class="input-box">
            <div class="input-label-small" id="personALabel">Person A Â· Name</div>
            <input id="nameA" class="text-input" type="text" placeholder="Name / nickname" />
            <div class="input-label-small" id="dobALabel">Birth date</div>
            <input id="dobA" class="text-input" type="text" placeholder="dd.mm.yyyy" />
          </div>
          <div class="input-box">
            <div class="input-label-small" id="personBLabel">Person B Â· Name</div>
            <input id="nameB" class="text-input" type="text" placeholder="Name / nickname" />
            <div class="input-label-small" id="dobBLabel">Birth date</div>
            <input id="dobB" class="text-input" type="text" placeholder="dd.mm.yyyy" />
          </div>
        </div>

        <!-- RELATION TYPE -->
        <div class="field-label" id="relationLabel">Relationship type</div>
        <div class="select-wrap">
          <select id="relationType">
            <option value="" id="optChoose">Choose type</option>
            <option value="romantic" id="optRomantic">Romantic / love</option>
            <option value="ex" id="optEx">Past relationship / ex</option>
            <option value="friendship" id="optFriend">Friendship</option>
            <option value="family" id="optFamily">Family</option>
            <option value="work" id="optWork">Work / collaboration</option>
            <option value="karmic" id="optKarmic">Undefined / karmic</option>
          </select>
        </div>

        <!-- QUESTION -->
        <div class="field-label" style="margin-top:12px;" id="questionLabel">Your question / intention</div>
        <textarea id="questionInput" placeholder="Write what youâ€™d like MystAI to focus on: why you met, future of this bond, lessons, karmic themes..."></textarea>

        <!-- ACTION -->
        <button id="readBtn" class="primary-btn">
          ðŸ”® <span id="readBtnText">Read Our Connection</span>
        </button>
        <div id="statusText" class="status"></div>
      </div>

      <!-- RIGHT â€“ RESULT -->
      <div class="result-panel">
        <div class="result-header">
          <div>
            <div class="result-title" id="resultTitle">Soul Connection Reading</div>
            <div class="result-sub" id="resultSub">After you share your details, MystAI will reflect your soul bond here.</div>
          </div>
          <button id="listenBtn" class="audio-btn" disabled>
            ðŸ”Š <span id="listenLabel">Listen</span>
          </button>
        </div>

        <div class="result-body">
          <div id="resultText" class="result-text">
âœ¨ When you enter both names, birth dates, relationship type and your intention, MystAI will describe the energetic and spiritual connection between you here. âœ¨
          </div>
          <div id="resultHint" class="result-hint">
MystAI is a spiritual and entertainment-focused AI tool. It does not replace medical, psychological, legal or financial advice.
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    Â© 2025 MystAI.ai â€” <span id="rightsLabel">All Rights Reserved.</span>
    <span id="devLabel">Developed by GALAXY ðŸŒŒ</span><br>
    <span id="contactLabel">Contact us:</span>
    <a href="mailto:support@mystai.ai">support@mystai.ai</a>
  </footer>

  <audio id="audioPlayer" style="display:none;"></audio>

  <script type="module">
    /* ========= CONFIG ========= */
    const BACKEND_URL = "https://mystai-international.onrender.com";

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDyiD7GAfOjMbtm-S6pO6XCSRXJclffPL0",
      authDomain: "mystai-6cca2.firebaseapp.com",
      projectId: "mystai-6cca2",
      storageBucket: "mystai-6cca2.appspot.com",
      messagingSenderId: "624127781219",
      appId: "1:624127781219:web:a580ac6e80ccc26e694b56"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    /* ========= ELEMENTS ========= */
    const btnEn       = document.getElementById("btn-en");
    const btnTr       = document.getElementById("btn-tr");
    const backBtn     = document.getElementById("backBtn");
    const logoutBtn   = document.getElementById("logoutBtn");
    const userLabel   = document.getElementById("userLabel");

    const kickerLabel  = document.getElementById("kickerLabel");
    const titleLabel   = document.getElementById("titleLabel");
    const subtitleLabel= document.getElementById("subtitleLabel");
    const step1Text    = document.getElementById("step1Text");
    const step2Text    = document.getElementById("step2Text");
    const step3Text    = document.getElementById("step3Text");

    const peopleLabel  = document.getElementById("peopleLabel");
    const personALabel = document.getElementById("personALabel");
    const personBLabel = document.getElementById("personBLabel");
    const dobALabel    = document.getElementById("dobALabel");
    const dobBLabel    = document.getElementById("dobBLabel");
    const nameA        = document.getElementById("nameA");
    const nameB        = document.getElementById("nameB");
    const dobA         = document.getElementById("dobA");
    const dobB         = document.getElementById("dobB");

    const relationLabel= document.getElementById("relationLabel");
    const relationType = document.getElementById("relationType");
    const optChoose    = document.getElementById("optChoose");
    const optRomantic  = document.getElementById("optRomantic");
    const optEx        = document.getElementById("optEx");
    const optFriend    = document.getElementById("optFriend");
    const optFamily    = document.getElementById("optFamily");
    const optWork      = document.getElementById("optWork");
    const optKarmic    = document.getElementById("optKarmic");

    const questionLabel= document.getElementById("questionLabel");
    const questionInput= document.getElementById("questionInput");
    const readBtn      = document.getElementById("readBtn");
    const readBtnText  = document.getElementById("readBtnText");
    const statusText   = document.getElementById("statusText");

    const resultTitle  = document.getElementById("resultTitle");
    const resultSub    = document.getElementById("resultSub");
    const resultText   = document.getElementById("resultText");
    const resultHint   = document.getElementById("resultHint");
    const listenBtn    = document.getElementById("listenBtn");
    const listenLabel  = document.getElementById("listenLabel");
    const audioPlayer  = document.getElementById("audioPlayer");

    const rightsLabel  = document.getElementById("rightsLabel");
    const devLabel     = document.getElementById("devLabel");
    const contactLabel = document.getElementById("contactLabel");

    /* ========= i18n ========= */
    const i18n = {
      en:{
        kicker:"MystAI Â· Soul Connection Gate",
        title:"Soul Connection Reading",
        subtitle:"Enter both names, birth dates, relationship type and your intention. MystAI will explore the emotional, energetic and spiritual dynamics between you.",
        step1:"Fill in the names and birth dates of both people in this connection.",
        step2:"Choose your relationship type and briefly describe the current situation.",
        step3:"Write your question or intention and let MystAI mirror your soul bond.",
        peopleLabel:"People in this connection",
        personALabel:"Person A Â· Name",
        personBLabel:"Person B Â· Name",
        dobALabel:"Birth date",
        dobBLabel:"Birth date",
        relationLabel:"Relationship type",
        optChoose:"Choose type",
        optRomantic:"Romantic / love",
        optEx:"Past relationship / ex",
        optFriend:"Friendship",
        optFamily:"Family",
        optWork:"Work / collaboration",
        optKarmic:"Undefined / karmic",
        questionLabel:"Your question / intention",
        questionPlaceholder:"Write what youâ€™d like MystAI to focus on: why you met, future of this bond, lessons, karmic themes...",
        readBtn:"Read Our Connection",
        statusIdle:"",
        statusLoading:"Reading your soul connectionâ€¦ energies, patterns and lessons are being interpreted.",
        statusDone:"Your soul connection reading is ready.",
        statusError:"An error occurred. Please try again.",
        mustQuestion:"Please write at least a short question or intention.",
        resultTitle:"Soul Connection Reading",
        resultSub:"After you share your details, MystAI will reflect your soul bond here.",
        resultInitial:"âœ¨ When you enter both names, birth dates, relationship type and your intention, MystAI will describe the energetic and spiritual connection between you here. âœ¨",
        resultHint:"MystAI is a spiritual and entertainment-focused AI tool. It does not replace medical, psychological, legal or financial advice.",
        listen:"Listen",
        listening:"Playing...",
        back:"Back to App",
        logout:"Logout",
        rights:"All Rights Reserved.",
        dev:"Developed by GALAXY ðŸŒŒ",
        contact:"Contact us:",
        welcome:"Welcome, "
      },
      tr:{
        kicker:"MystAI Â· Ruhsal BaÄŸ KapÄ±sÄ±",
        title:"Ruhsal BaÄŸlantÄ± Yorumu",
        subtitle:"Ä°ki kiÅŸinin adÄ±nÄ±, doÄŸum tarihlerini, iliÅŸkinin tÃ¼rÃ¼nÃ¼ ve niyetini gir. MystAI aranÄ±zdaki duygusal, enerjik ve ruhsal dinamikleri keÅŸfetsin.",
        step1:"Bu baÄŸlantÄ±daki her iki kiÅŸinin adÄ±nÄ± ve doÄŸum tarihini doldur.",
        step2:"Ä°liÅŸki tÃ¼rÃ¼nÃ¼ seÃ§ ve ÅŸu anki durumu kÄ±saca tarif et.",
        step3:"Sorunu veya niyetini yaz; MystAI aranÄ±zdaki ruhsal baÄŸÄ± yansÄ±tsÄ±n.",
        peopleLabel:"Bu baÄŸlantÄ±daki kiÅŸiler",
        personALabel:"KiÅŸi A Â· Ä°sim",
        personBLabel:"KiÅŸi B Â· Ä°sim",
        dobALabel:"DoÄŸum tarihi",
        dobBLabel:"DoÄŸum tarihi",
        relationLabel:"Ä°liÅŸki tÃ¼rÃ¼",
        optChoose:"TÃ¼r seÃ§",
        optRomantic:"Romantik / aÅŸk",
        optEx:"Eski iliÅŸki / ex",
        optFriend:"ArkadaÅŸlÄ±k",
        optFamily:"Aile",
        optWork:"Ä°ÅŸ / birlikte Ã§alÄ±ÅŸma",
        optKarmic:"TanÄ±msÄ±z / karmic",
        questionLabel:"Sorun / niyetin",
        questionPlaceholder:"MystAI'nin odaklanmasÄ±nÄ± istediÄŸin temayÄ± yaz: neden tanÄ±ÅŸtÄ±nÄ±z, bu baÄŸÄ±n geleceÄŸi, dersler, karmasal temalar...",
        readBtn:"Ruhsal BaÄŸlantÄ±yÄ± Yorumla",
        statusIdle:"",
        statusLoading:"Ruhsal baÄŸlantÄ±n okunuyorâ€¦ enerjiler, kalÄ±plar ve dersler yorumlanÄ±yor.",
        statusDone:"Ruhsal baÄŸlantÄ± yorumun hazÄ±r.",
        statusError:"Bir hata oluÅŸtu. LÃ¼tfen tekrar dene.",
        mustQuestion:"LÃ¼tfen en azÄ±ndan kÄ±sa bir soru veya niyet yaz.",
        resultTitle:"Ruhsal BaÄŸlantÄ± Yorumun",
        resultSub:"Ä°simleri, doÄŸum tarihlerini, iliÅŸki tÃ¼rÃ¼nÃ¼ ve niyetini girdikten sonra MystAI aranÄ±zdaki ruhsal baÄŸÄ± burada gÃ¶sterecek.",
        resultInitial:"âœ¨ Ä°simleri, doÄŸum tarihlerini ve iliÅŸki tÃ¼rÃ¼nÃ¼ gir; niyetini yaz. MystAI aranÄ±zdaki baÄŸÄ±n enerjisini, karmasal dersleri ve geleceÄŸe dair olasÄ±lÄ±klarÄ± burada anlatacak. âœ¨",
        resultHint:"MystAI ruhsal ve eÄŸlence amaÃ§lÄ± bir yapay zekÃ¢ yorumlayÄ±cÄ±sÄ±dÄ±r; tÄ±bbi, psikolojik, hukuki veya finansal danÄ±ÅŸmanlÄ±ÄŸÄ±n yerine geÃ§mez.",
        listen:"Dinle",
        listening:"Ã‡alÄ±yor...",
        back:"Uygulamaya DÃ¶n",
        logout:"Ã‡Ä±kÄ±ÅŸ Yap",
        rights:"TÃ¼m HaklarÄ± SaklÄ±dÄ±r.",
        dev:"GALAXY tarafÄ±ndan geliÅŸtirilmiÅŸtir ðŸŒŒ",
        contact:"Ä°letiÅŸim:",
        welcome:"HoÅŸ geldin, "
      }
    };

    let activeLang = localStorage.getItem("myst_lang") || "en";

    function applyLang(lang){
      activeLang = lang;
      localStorage.setItem("myst_lang", lang);
      const t = i18n[lang];

      kickerLabel.textContent   = t.kicker;
      titleLabel.textContent    = t.title;
      subtitleLabel.textContent = t.subtitle;
      step1Text.textContent     = t.step1;
      step2Text.textContent     = t.step2;
      step3Text.textContent     = t.step3;

      peopleLabel.textContent   = t.peopleLabel;
      personALabel.textContent  = t.personALabel;
      personBLabel.textContent  = t.personBLabel;
      dobALabel.textContent     = t.dobALabel;
      dobBLabel.textContent     = t.dobBLabel;

      relationLabel.textContent = t.relationLabel;
      optChoose.textContent     = t.optChoose;
      optRomantic.textContent   = t.optRomantic;
      optEx.textContent         = t.optEx;
      optFriend.textContent     = t.optFriend;
      optFamily.textContent     = t.optFamily;
      optWork.textContent       = t.optWork;
      optKarmic.textContent     = t.optKarmic;

      questionLabel.textContent = t.questionLabel;
      questionInput.placeholder = t.questionPlaceholder;
      readBtnText.textContent   = t.readBtn;

      resultTitle.textContent   = t.resultTitle;
      resultSub.textContent     = t.resultSub;
      resultText.textContent    = t.resultInitial;
      resultHint.textContent    = t.resultHint;
      listenLabel.textContent   = t.listen;

      rightsLabel.textContent   = t.rights;
      devLabel.textContent      = t.dev;
      contactLabel.textContent  = t.contact;
      backBtn.textContent       = "â¬… " + t.back;
      logoutBtn.textContent     = t.logout;

      btnEn.classList.toggle("active", lang === "en");
      btnTr.classList.toggle("active", lang === "tr");

      if (auth.currentUser){
        const name = auth.currentUser.displayName || auth.currentUser.email;
        userLabel.textContent = t.welcome + name;
      }
    }

    btnEn.addEventListener("click", ()=>applyLang("en"));
    btnTr.addEventListener("click", ()=>applyLang("tr"));

    /* ========= AUTH & NAV ========= */
    backBtn.addEventListener("click", ()=>{ window.location.href = "app.html"; });

    logoutBtn.addEventListener("click", ()=>{
      signOut(auth).then(()=> window.location.href="login.html");
    });

    onAuthStateChanged(auth, user=>{
      if(!user){
        window.location.href = "login.html";
        return;
      }
      const t = i18n[activeLang];
      const name = user.displayName || user.email;
      userLabel.textContent = t.welcome + name;
    });

    applyLang(activeLang);

    /* ========= MAIN READING ACTION ========= */
    readBtn.addEventListener("click", async ()=>{
      const t = i18n[activeLang];
      const user = auth.currentUser;

      if(!user){
        alert(activeLang === "tr" ? "LÃ¼tfen Ã¶nce giriÅŸ yap." : "Please log in first.");
        return;
      }

      const personA = nameA.value.trim();
      const personB = nameB.value.trim();
      const dateA   = dobA.value.trim();
      const dateB   = dobB.value.trim();
      const relation= relationType.value;
      const question= questionInput.value.trim();

      if(!question){
        alert(t.mustQuestion);
        return;
      }

      // UI state
      readBtn.disabled = true;
      statusText.textContent = t.statusLoading;
      resultText.textContent = "";
      listenBtn.disabled = true;
      audioPlayer.pause();
      audioPlayer.currentTime = 0;
      audioPlayer.src = "";

      try{
        if(!BACKEND_URL || BACKEND_URL.includes("YOUR-BACKEND-URL")){
          statusText.textContent = "Backend URL is not configured.";
          readBtn.disabled = false;
          return;
        }

        const relLabel =
          relationType.options[relationType.selectedIndex]?.textContent || "";

        // ULTRA DETAYLI, UZUN YORUM Ä°Ã‡Ä°N PROMPT
        const systemIntroTR =
          "Bu bir yapay zekÃ¢ RUHSAL BAÄžLANTI yorumudur. Ä°ki kiÅŸi arasÄ±ndaki baÄŸÄ±n enerjisini, karmasÄ±nÄ±, derslerini, uyum ve zorluk alanlarÄ±nÄ± MÄ°STÄ°K ama AYAKLARI YERE BASAN bir dille anlat.\n" +
          "LÃœTFEN EN AZ 900â€“1100 KELÄ°MELÄ°K, 10 BAÅžLIKLI, ASLA YARIM KALMAYAN BÄ°R METÄ°N YAZ. CÃœMLEYÄ° KESÄ°P BIRAKMA.\n" +
          "YapÄ± ÅŸu baÅŸlÄ±klar halinde olsun:\n" +
          "1) BaÄŸÄ±n genel Ã¶zeti\n" +
          "2) Ruhsal/karmik tema\n" +
          "3) Duygusal dinamikler\n" +
          "4) Ä°letiÅŸim ve zihinsel uyum\n" +
          "5) GeleceÄŸe dair olasÄ±lÄ±klar (tahmin deÄŸil, olasÄ±lÄ±k)\n" +
          "6) Ä°liÅŸki tÃ¼rÃ¼ne Ã¶zel yorum (Ã¶rn: aile, aÅŸk, arkadaÅŸlÄ±k)\n" +
          "7) KiÅŸi A iÃ§in mesajlar\n" +
          "8) KiÅŸi B iÃ§in mesajlar\n" +
          "9) Birlikte ÅŸifa & geliÅŸim Ã¶nerileri (maddeli olabilir)\n" +
          "10) Son cÃ¼mlede birlikte ruhsal ders ve kapanÄ±ÅŸ.\n";

        const systemIntroEN =
          "This is an AI SOUL CONNECTION reading. Describe the energetic and spiritual bond, karma, lessons, strengths and challenges in a mystical yet grounded tone.\n" +
          "PLEASE WRITE AT LEAST 900â€“1100 WORDS, WITH 10 CLEAR SECTIONS, NEVER CUTTING A SENTENCE IN THE MIDDLE.\n" +
          "Use headings like: (1) Overall connection summary, (2) Soul / karmic theme, (3) Emotional dynamics, (4) Communication & mental harmony, (5) Possible future timelines (not fixed predictions), (6) Insights for this relationship type, (7) Messages for Person A, (8) Messages for Person B, (9) Suggestions for healing & growth, (10) Closing reflection.\n";

        const baseIntro = activeLang === "tr" ? systemIntroTR : systemIntroEN;

        const langLine =
          activeLang === "tr"
            ? "LÃ¼tfen TÃœRKÃ‡E yaz.\n\n"
            : "Please write in NATURAL, FLUENT ENGLISH.\n\n";

        const details =
          (activeLang === "tr"
            ? "BaÄŸlantÄ± detaylarÄ±:\n"
            : "Connection details:\n") +
          "KiÅŸi A / Person A: " + (personA || "-") + " Â· " + (dateA || "-") + "\n" +
          "KiÅŸi B / Person B: " + (personB || "-") + " Â· " + (dateB || "-") + "\n" +
          (activeLang === "tr" ? "Ä°liÅŸki tÃ¼rÃ¼: " : "Relationship type: ") +
          (relLabel || (activeLang === "tr" ? "BelirtilmemiÅŸ" : "Not specified")) + "\n\n" +
          (activeLang === "tr" ? "KullanÄ±cÄ±nÄ±n sorusu/niyeti: " : "User's question / intention: ") +
          question + "\n";

        const payloadText = baseIntro + langLine + details;

        const res = await fetch(`${BACKEND_URL}/predict`, {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({ user_input: payloadText })
        });

        if(!res.ok){
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const text = data?.text || (activeLang === "tr" ? "YanÄ±t alÄ±namadÄ±." : "No response.");
        const audioPath = data?.audio;

        resultText.textContent = text;
        statusText.textContent = t.statusDone;

        // Firestore save
        try{
          await addDoc(collection(db, "fortunes"), {
            user: user.email,
            type: "Soul Connection Reading",
            personA,
            personB,
            dobA: dateA,
            dobB: dateB,
            relation: relLabel,
            question,
            result: text,
            createdAt: serverTimestamp(),
            source: "soul-page"
          });
        }catch(e){
          console.warn("Firestore save error:", e);
        }

        if(audioPath){
          const audioURL = audioPath.startsWith("http") ? audioPath : `${BACKEND_URL}${audioPath}`;
          audioPlayer.src = audioURL;
          listenBtn.disabled = false;
        }
      }catch(err){
        console.error(err);
        statusText.textContent = t.statusError;
        resultText.textContent =
          (activeLang === "tr" ? "Hata: " : "Error: ") + (err?.message || String(err));
      }finally{
        readBtn.disabled = false;
      }
    });

    /* ========= AUDIO PLAY ========= */
    listenBtn.addEventListener("click", ()=>{
      if(!audioPlayer.src) return;
      const t = i18n[activeLang];
      listenLabel.textContent = t.listening;
      audioPlayer.play().catch(()=>{});
      audioPlayer.onended = ()=>{
        listenLabel.textContent = t.listen;
      };
    });
  </script>
</body>
</html>
