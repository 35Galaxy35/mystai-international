<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MystAI â€” AI Coffee Reading</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  background:radial-gradient(1200px 800px at 50% -10%, #101a4d 0%, #0b0f1f 85%);
  color:#e6ecff;
  min-height:100vh;
  text-align:center;
}

header{
  padding:18px 30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:rgba(10,15,30,0.35);
  backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,255,255,0.05);
}

.logo{
  font-family:'Cinzel',serif;
  font-size:26px;
  color:#ffd54f;
  text-shadow:0 0 10px rgba(255,215,0,.4);
}

.nav-btn{
  border:0;
  background:rgba(255,255,255,.15);
  padding:8px 18px;
  border-radius:12px;
  cursor:pointer;
  color:white;
  font-weight:600;
  transition:.3s;
}
.nav-btn:hover{filter:brightness(1.2);}

.container{
  width:90%;
  max-width:900px;
  margin:40px auto;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;
  padding:24px;
  box-shadow:0 0 40px rgba(255,215,0,.1);
}

h1{
  font-family:'Cinzel',serif;
  color:#ffd54f;
}

.upload-box{
  border:2px dashed rgba(255,255,255,.3);
  padding:30px;
  border-radius:14px;
  cursor:pointer;
}

.upload-box:hover{background:rgba(255,255,255,.05);}

.preview-img{
  margin-top:20px;
  max-width:100%;
  max-height:300px;
  border-radius:10px;
  box-shadow:0 0 25px rgba(255,215,0,.2);
}

.btn{
  margin-top:20px;
  padding:12px 24px;
  background:linear-gradient(120deg,#ffd700,#ffe680);
  border-radius:10px;
  border:none;
  color:#111;
  font-weight:700;
  cursor:pointer;
  font-size:16px;
  transition:.3s;
}
.btn:hover{transform:scale(1.06);}

.loading{
  margin-top:25px;
  font-size:20px;
  color:#ffe680;
  display:none;
}

.result-box{
  margin-top:30px;
  padding:20px;
  background:rgba(255,255,255,.05);
  border-radius:12px;
  border:1px solid rgba(255,255,255,.1);
  display:none;
  text-align:left;
  white-space:pre-line;
}

audio{
  margin-top:15px;
  width:100%;
}
</style>
</head>

<body>

<header>
  <div class="logo">MystAI ðŸ”®</div>
  <button class="nav-btn" onclick="window.location.href='app.html'">â¬… Back</button>
</header>

<h1>AI Coffee Reading</h1>

<div class="container">

  <label class="upload-box" id="uploadBox">
    <strong>Click to upload your coffee cup photo</strong>
    <input type="file" id="fileInput" accept="image/*" hidden />
  </label>

  <img id="preview" class="preview-img" style="display:none" />

  <button class="btn" id="analyzeBtn" style="display:none">Read My Coffee Cup</button>

  <div class="loading" id="loading">ðŸ”® Preparing your fortune... Please wait...</div>

  <div class="result-box" id="resultBox"></div>
  <audio id="audioPlayer" controls style="display:none"></audio>

</div>

<script>
const BACKEND_URL = "https://mystai-international-1.onrender.com";

const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const analyzeBtn = document.getElementById("analyzeBtn");
const loading = document.getElementById("loading");
const resultBox = document.getElementById("resultBox");
const audioPlayer = document.getElementById("audioPlayer");

document.getElementById("uploadBox").onclick = () => fileInput.click();

fileInput.onchange = () => {
  const file = fileInput.files[0];
  if (!file) return;

  preview.src = URL.createObjectURL(file);
  preview.style.display = "block";
  analyzeBtn.style.display = "inline-block";
};

analyzeBtn.onclick = async () => {
  const file = fileInput.files[0];
  if (!file) {
    alert("Please upload a cup photo.");
    return;
  }

  loading.style.display = "block";
  resultBox.style.display = "none";
  audioPlayer.style.display = "none";

  // FotoÄŸrafÄ± base64'e Ã§evir
  const base64 = await toBase64(file);

  const res = await fetch(`${BACKEND_URL}/predict`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      user_input:"This is a coffee cup reading. Please read it.",
      image: base64
    })
  });

  const data = await res.json();

  loading.style.display = "none";
  resultBox.style.display = "block";
  resultBox.textContent = data.text || "No result.";

  if (data.audio){
    audioPlayer.src = BACKEND_URL + data.audio;
    audioPlayer.style.display="block";
  }
};

function toBase64(file){
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = ()=>resolve(reader.result);
    reader.onerror = err=>reject(err);
  });
}
</script>
</body>
</html>
