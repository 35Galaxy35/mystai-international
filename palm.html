<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MystAI â€” AI Palm Reading</title>
  <link rel="icon" type="image/png" href="mystai-logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg-start:#0d1440;
      --bg-end:#0b0f1f;
      --text:#d8e0ff;
      --muted:#a9b4d0;
      --accent:#f2c84b;
    }
    * { box-sizing:border-box; }

    body {
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:radial-gradient(1100px 700px at 50% -10%, #101a4d 0%, #0b0f1f 85%);
      color:var(--text);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* TOP BAR */
    .topbar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px 24px;
      background:rgba(10,15,30,0.45);
      backdrop-filter:blur(12px);
      border-bottom:1px solid rgba(255,255,255,0.08);
      position:sticky;
      top:0;
      z-index:20;
    }
    .top-left, .top-right {
      display:flex;
      align-items:center;
      gap:10px;
    }

    .lang-btn {
      border:none;
      border-radius:50%;
      width:34px; height:34px;
      cursor:pointer;
      background-size:cover;
      background-position:center;
      transition:transform .25s ease, box-shadow .25s ease;
      border:2px solid transparent;
    }
    .lang-btn.active {
      box-shadow:0 0 12px rgba(255,215,0,.7);
      border-color:#ffd54f;
      transform:scale(1.08);
    }
    .lang-btn:hover { transform:scale(1.12); }
    .flag-en { background-image:url('https://flagcdn.com/w40/gb.png'); }
    .flag-tr { background-image:url('https://flagcdn.com/w40/tr.png'); }

    .nav-btn {
      border:0;
      border-radius:20px;
      background:rgba(255,255,255,.12);
      color:#fff;
      padding:7px 14px;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:4px;
      transition:all .25s ease;
    }
    .nav-btn:hover { filter:brightness(1.2); transform:translateY(-1px); }

    .user-label {
      font-size:13px;
      color:#ffe680;
      text-shadow:0 0 8px rgba(255,215,0,.4);
      margin-right:4px;
    }

    /* MAIN WRAPPER */
    .wrapper {
      flex:1;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:30px 16px 40px;
    }
    .card {
      width:100%;
      max-width:1100px;
      background:rgba(8,12,30,.94);
      border-radius:20px;
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 0 40px rgba(0,0,0,.55);
      padding:24px;
      display:grid;
      grid-template-columns:minmax(0,1.3fr) minmax(0,1fr);
      gap:24px;
    }
    @media(max-width:960px){
      .card { grid-template-columns:1fr; }
    }

    /* LEFT SIDE â€“ TITLE + FORM */
    .section-title {
      font-family:'Cinzel',serif;
      color:#ffd54f;
      font-size:28px;
      margin-bottom:8px;
      text-shadow:0 0 12px rgba(255,220,120,.5);
      text-align:left;
    }
    .section-sub {
      font-size:14px;
      color:#c5cfff;
      text-align:left;
      line-height:1.6;
      margin-bottom:18px;
    }

    .label {
      text-align:left;
      font-size:13px;
      font-weight:600;
      color:#ffe680;
      margin-bottom:6px;
      margin-top:12px;
    }

    /* HAND SELECT */
    .hand-row {
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:4px;
    }
    .hand-pill {
      flex:1;
      min-width:120px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.2);
      background:rgba(255,255,255,.04);
      padding:7px 10px;
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      font-size:13px;
      color:#dbe3ff;
      transition:all .25s ease;
    }
    .hand-pill input {
      accent-color:#ffd54f;
    }
    .hand-pill.active {
      background:linear-gradient(120deg,#ffd700,#ffcc33,#ffe680);
      color:#111;
      border-color:rgba(0,0,0,.2);
      box-shadow:0 0 18px rgba(255,215,0,.45);
    }

    /* MULTI UPLOAD BOXES */
    .photos-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:12px;
    }
    .photo-card {
      background:rgba(5,10,30,.9);
      border-radius:12px;
      border:1px dashed rgba(255,255,255,.25);
      padding:10px;
      text-align:left;
    }
    .photo-title {
      font-size:12px;
      font-weight:600;
      color:#ffe680;
      margin-bottom:2px;
    }
    .photo-hint {
      font-size:11px;
      color:#a2addf;
      margin-bottom:8px;
      min-height:28px;
    }
    .upload-btn {
      border:0;
      border-radius:999px;
      padding:7px 12px;
      background:linear-gradient(120deg,#ffd700,#ffcc33,#ffe680);
      color:#111;
      font-weight:700;
      cursor:pointer;
      font-size:12px;
      box-shadow:0 0 10px rgba(255,215,0,.35);
      transition:all .25s ease;
      white-space:nowrap;
    }
    .upload-btn:hover { transform:scale(1.04); }

    .preview-row {
      margin-top:8px;
      display:flex;
      align-items:center;
      gap:8px;
      font-size:11px;
      color:#aeb6ff;
    }
    .preview-row img {
      width:46px;height:46px;border-radius:8px;object-fit:cover;
      box-shadow:0 0 10px rgba(0,0,0,.7);
    }
    .preview-name {
      max-width:120px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    textarea {
      width:100%;
      min-height:90px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background:#050b20;
      color:#e6ecff;
      padding:10px;
      font-family:inherit;
      font-size:14px;
      resize:vertical;
      outline:none;
      box-shadow:inset 0 0 10px rgba(0,0,0,.35);
    }
    textarea::placeholder {
      color:#808abf;
      font-size:13px;
    }

    .primary-btn {
      margin-top:14px;
      border:0;
      border-radius:12px;
      padding:10px 18px;
      background:linear-gradient(120deg,#ffd700,#ffb600,#ffe680);
      color:#111;
      font-weight:800;
      font-size:14px;
      cursor:pointer;
      box-shadow:0 0 18px rgba(255,215,0,.4);
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:all .25s ease;
    }
    .primary-btn:hover { transform:translateY(-1px) scale(1.03); }
    .primary-btn:disabled {
      opacity:.6;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    .status {
      margin-top:8px;
      font-size:12px;
      color:#aeb6ff;
      text-align:left;
      min-height:16px;
    }

    /* RIGHT SIDE â€“ RESULT */
    .result-box {
      border-radius:16px;
      background:radial-gradient(circle at top,#202760,#070c24);
      border:1px solid rgba(255,255,255,.15);
      padding:16px;
      box-shadow:0 0 22px rgba(0,0,0,.4);
      display:flex;
      flex-direction:column;
      height:100%;
    }
    .result-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .result-title {
      font-size:15px;
      font-weight:700;
      color:#ffd966;
    }
    .audio-btn {
      border:0;
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      font-weight:600;
      background:rgba(255,255,255,.12);
      color:#fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .audio-btn[disabled] {
      opacity:.5;
      cursor:not-allowed;
    }
    .result-content {
      margin-top:6px;
      font-size:14px;
      color:#dbe3ff;
      text-align:left;
      line-height:1.7;
      overflow-y:auto;
      max-height:270px;
      padding-right:4px;
      white-space:pre-wrap;
    }
    .result-hint {
      font-size:12px;
      color:#9098d0;
      margin-top:6px;
    }

    /* FOOTER */
    footer {
      border-top:1px solid rgba(255,255,255,.08);
      padding:18px;
      font-size:13px;
      color:#aeb6cf;
      text-align:center;
    }
    footer a {
      color:#ffd54f;
      text-decoration:none;
      font-weight:600;
    }
    footer a:hover {
      color:#fff6b0;
      text-shadow:0 0 10px rgba(255,255,120,.6);
    }
  </style>
</head>
<body>
  <!-- TOP BAR -->
  <div class="topbar">
    <div class="top-left">
      <button class="lang-btn flag-en" id="btn-en"></button>
      <button class="lang-btn flag-tr" id="btn-tr"></button>
    </div>
    <div class="top-right">
      <span class="user-label" id="userLabel"></span>
      <button class="nav-btn" id="backBtn">â¬… App</button>
      <button class="nav-btn" id="logoutBtn">Logout</button>
    </div>
  </div>

  <div class="wrapper">
    <div class="card">
      <!-- LEFT: FORM -->
      <div>
        <h1 class="section-title" id="title">AI Palm Reading</h1>
        <p class="section-sub" id="subtitle">
          Upload your palm photos, choose your hand and share your intention. MystAI will read your lines, energy and patterns with AI.
        </p>

        <div class="label" id="labelHand">Which hand?</div>
        <div class="hand-row">
          <label class="hand-pill" id="pillLeft">
            <input type="radio" name="hand" value="left" checked />
            <span id="labelLeftText">Left hand (inner world)</span>
          </label>
          <label class="hand-pill" id="pillRight">
            <input type="radio" name="hand" value="right" />
            <span id="labelRightText">Right hand (outer world)</span>
          </label>
        </div>

        <div class="label" id="labelPhotos">Palm Photos (5 angles)</div>
        <div class="photos-grid">
          <!-- Main palm -->
          <div class="photo-card">
            <div class="photo-title" id="slot1Title">Main palm â€“ center</div>
            <div class="photo-hint" id="slot1Hint">Flat, full palm, all main lines visible.</div>
            <button class="upload-btn" data-slot="1" id="btnSlot1">ðŸ“· <span id="btnSlot1Text">Choose Image</span></button>
            <input type="file" id="fileSlot1" accept="image/*" style="display:none;" />
            <div class="preview-row" id="previewSlot1" style="display:none;">
              <img id="imgSlot1" alt="Palm 1">
              <div class="preview-name" id="nameSlot1"></div>
            </div>
          </div>

          <!-- Left angle -->
          <div class="photo-card">
            <div class="photo-title" id="slot2Title">Left angle</div>
            <div class="photo-hint" id="slot2Hint">Palm slightly turned to show left side curves.</div>
            <button class="upload-btn" data-slot="2" id="btnSlot2">ðŸ“· <span id="btnSlot2Text">Choose Image</span></button>
            <input type="file" id="fileSlot2" accept="image/*" style="display:none;" />
            <div class="preview-row" id="previewSlot2" style="display:none;">
              <img id="imgSlot2" alt="Palm 2">
              <div class="preview-name" id="nameSlot2"></div>
            </div>
          </div>

          <!-- Right angle -->
          <div class="photo-card">
            <div class="photo-title" id="slot3Title">Right angle</div>
            <div class="photo-hint" id="slot3Hint">Palm slightly turned to show right side & fingers.</div>
            <button class="upload-btn" data-slot="3" id="btnSlot3">ðŸ“· <span id="btnSlot3Text">Choose Image</span></button>
            <input type="file" id="fileSlot3" accept="image/*" style="display:none;" />
            <div class="preview-row" id="previewSlot3" style="display:none;">
              <img id="imgSlot3" alt="Palm 3">
              <div class="preview-name" id="nameSlot3"></div>
            </div>
          </div>

          <!-- Wrist area -->
          <div class="photo-card">
            <div class="photo-title" id="slot4Title">Wrist / base lines</div>
            <div class="photo-hint" id="slot4Hint">Focus on wrist lines and lower palm.</div>
            <button class="upload-btn" data-slot="4" id="btnSlot4">ðŸ“· <span id="btnSlot4Text">Choose Image</span></button>
            <input type="file" id="fileSlot4" accept="image/*" style="display:none;" />
            <div class="preview-row" id="previewSlot4" style="display:none;">
              <img id="imgSlot4" alt="Palm 4">
              <div class="preview-name" id="nameSlot4"></div>
            </div>
          </div>

          <!-- Back of hand -->
          <div class="photo-card">
            <div class="photo-title" id="slot5Title">Back of the hand</div>
            <div class="photo-hint" id="slot5Hint">Top of the hand, knuckles and finger bases.</div>
            <button class="upload-btn" data-slot="5" id="btnSlot5">ðŸ“· <span id="btnSlot5Text">Choose Image</span></button>
            <input type="file" id="fileSlot5" accept="image/*" style="display:none;" />
            <div class="preview-row" id="previewSlot5" style="display:none;">
              <img id="imgSlot5" alt="Palm 5">
              <div class="preview-name" id="nameSlot5"></div>
            </div>
          </div>
        </div>

        <div class="label" id="labelQuestion">Your Question / Intention</div>
        <textarea id="palmQuestion" placeholder="Write what youâ€™d like MystAI to focus on (love, fate, life path, career, health themes...)"></textarea>

        <button class="primary-btn" id="analyzeBtn">
          ðŸ”® <span id="analyzeText">Read My Palm</span>
        </button>

        <div class="status" id="statusText"></div>
      </div>

      <!-- RIGHT: RESULT -->
      <div class="result-box">
        <div class="result-header">
          <div class="result-title" id="resultTitle">Your Palm Reading</div>
          <button class="audio-btn" id="listenBtn" disabled>
            ðŸ”Š <span id="listenLabel">Listen</span>
          </button>
        </div>
        <div class="result-content" id="resultText">
          âœ¨ After you upload your palm photos and send your intention, MystAI will reveal your AI palm reading here. âœ¨
        </div>
        <div class="result-hint" id="resultHint">
          MystAI is an AI-based entertainment tool and should not be taken as medical, psychological or professional advice.
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>
      Â© 2025 MystAI.ai â€” <span id="rightsLabel">All Rights Reserved.</span>
      <span id="devLabel">Developed by GALAXY ðŸŒŒ</span><br />
      <span id="contactLabel">Contact us:</span>
      <a href="mailto:support@mystai.ai">support@mystai.ai</a>
    </p>
  </footer>

  <audio id="audioPlayer" style="display:none;"></audio>

  <script type="module">
    /* ====== CONFIG ====== */
    const BACKEND_URL = "https://mystai-international-1.onrender.com";

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDyiD7GAfOjMbtm-S6pO6XCSRXJclffPL0",
      authDomain: "mystai-6cca2.firebaseapp.com",
      projectId: "mystai-6cca2",
      storageBucket: "mystai-6cca2.appspot.com",
      messagingSenderId: "624127781219",
      appId: "1:624127781219:web:a580ac6e80ccc26e694b56"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    /* ====== ELEMENTS ====== */
    const btnEn       = document.getElementById("btn-en");
    const btnTr       = document.getElementById("btn-tr");
    const backBtn     = document.getElementById("backBtn");
    const logoutBtn   = document.getElementById("logoutBtn");
    const userLabel   = document.getElementById("userLabel");

    const titleEl     = document.getElementById("title");
    const subtitleEl  = document.getElementById("subtitle");

    const labelHand   = document.getElementById("labelHand");
    const pillLeft    = document.getElementById("pillLeft");
    const pillRight   = document.getElementById("pillRight");
    const labelLeftText  = document.getElementById("labelLeftText");
    const labelRightText = document.getElementById("labelRightText");

    const labelPhotos = document.getElementById("labelPhotos");
    const textarea    = document.getElementById("palmQuestion");
    const labelQuestion = document.getElementById("labelQuestion");
    const analyzeBtn  = document.getElementById("analyzeBtn");
    const analyzeText = document.getElementById("analyzeText");
    const statusText  = document.getElementById("statusText");

    const resultTitle = document.getElementById("resultTitle");
    const resultText  = document.getElementById("resultText");
    const resultHint  = document.getElementById("resultHint");
    const listenBtn   = document.getElementById("listenBtn");
    const listenLabel = document.getElementById("listenLabel");
    const audioPlayer = document.getElementById("audioPlayer");

    const rightsLabel  = document.getElementById("rightsLabel");
    const devLabel     = document.getElementById("devLabel");
    const contactLabel = document.getElementById("contactLabel");

    // slot element helpers
    const SLOT_IDS = [1,2,3,4,5];
    const slotTitleEls = {
      1: document.getElementById("slot1Title"),
      2: document.getElementById("slot2Title"),
      3: document.getElementById("slot3Title"),
      4: document.getElementById("slot4Title"),
      5: document.getElementById("slot5Title"),
    };
    const slotHintEls = {
      1: document.getElementById("slot1Hint"),
      2: document.getElementById("slot2Hint"),
      3: document.getElementById("slot3Hint"),
      4: document.getElementById("slot4Hint"),
      5: document.getElementById("slot5Hint"),
    };
    const slotBtnTextEls = {
      1: document.getElementById("btnSlot1Text"),
      2: document.getElementById("btnSlot2Text"),
      3: document.getElementById("btnSlot3Text"),
      4: document.getElementById("btnSlot4Text"),
      5: document.getElementById("btnSlot5Text"),
    };
    const slotFileEls = {
      1: document.getElementById("fileSlot1"),
      2: document.getElementById("fileSlot2"),
      3: document.getElementById("fileSlot3"),
      4: document.getElementById("fileSlot4"),
      5: document.getElementById("fileSlot5"),
    };
    const slotPreviewBoxEls = {
      1: document.getElementById("previewSlot1"),
      2: document.getElementById("previewSlot2"),
      3: document.getElementById("previewSlot3"),
      4: document.getElementById("previewSlot4"),
      5: document.getElementById("previewSlot5"),
    };
    const slotImgEls = {
      1: document.getElementById("imgSlot1"),
      2: document.getElementById("imgSlot2"),
      3: document.getElementById("imgSlot3"),
      4: document.getElementById("imgSlot4"),
      5: document.getElementById("imgSlot5"),
    };
    const slotNameEls = {
      1: document.getElementById("nameSlot1"),
      2: document.getElementById("nameSlot2"),
      3: document.getElementById("nameSlot3"),
      4: document.getElementById("nameSlot4"),
      5: document.getElementById("nameSlot5"),
    };

    /* ====== i18n ====== */
    const i18n = {
      en: {
        title: "AI Palm Reading",
        subtitle: "Upload your palm photos, choose your hand and share your intention. MystAI will read your lines, energy and patterns with AI.",
        handLabel: "Which hand?",
        leftText: "Left hand (inner world, emotional and spiritual patterns)",
        rightText:"Right hand (outer world, choices and daily life)",
        photosLabel: "Palm Photos (5 angles)",
        slot1Title: "Main palm â€“ center",
        slot1Hint:  "Flat, full palm, all main lines visible.",
        slot2Title: "Left angle",
        slot2Hint:  "Palm slightly turned to show left side curves.",
        slot3Title: "Right angle",
        slot3Hint:  "Palm slightly turned to show right side & fingers.",
        slot4Title: "Wrist / base lines",
        slot4Hint:  "Focus on wrist lines and lower palm.",
        slot5Title: "Back of the hand",
        slot5Hint:  "Top of the hand, knuckles and finger bases.",
        uploadBtn: "Choose Image",
        questionLabel: "Your Question / Intention",
        placeholder: "Write what youâ€™d like MystAI to focus on (love, fate, life path, career, health themes...)",
        analyze: "Read My Palm",
        statusIdle: "",
        statusLoading: "Reading your palmâ€¦ lines, symbols and energy are being interpreted...",
        statusDone: "Your palm reading is ready.",
        statusError: "An error occurred. Please try again.",
        mustText: "Please write at least a short question or intention.",
        userWelcome: "Welcome, ",
        resultTitle: "Your Palm Reading",
        resultInitial: "âœ¨ After you upload your palm photos and send your intention, MystAI will reveal your AI palm reading here. âœ¨",
        resultHint: "MystAI is an AI-based entertainment tool and should not be taken as medical, psychological or professional advice.",
        listen: "Listen",
        listening: "Playing...",
        back: "Back to App",
        logout: "Logout",
        rights: "All Rights Reserved.",
        dev: "Developed by GALAXY ðŸŒŒ",
        contact: "Contact us:"
      },
      tr: {
        title: "Yapay ZekÃ¢ El FalÄ±",
        subtitle: "Avucunun fotoÄŸraflarÄ±nÄ± yÃ¼kle, elini seÃ§ ve niyetini yaz. MystAI; Ã§izgilerini, sembollerini ve enerjini yapay zekÃ¢ ile yorumlasÄ±n.",
        handLabel: "Hangi elin?",
        leftText: "Sol el (iÃ§ dÃ¼nya, duygusal ve ruhsal yapÄ±n)",
        rightText:"SaÄŸ el (dÄ±ÅŸ dÃ¼nya, seÃ§imlerin ve gÃ¼nlÃ¼k hayatÄ±n)",
        photosLabel: "AvuÃ§ Ä°Ã§i FotoÄŸraflarÄ± (5 aÃ§Ä±)",
        slot1Title: "Ana avuÃ§ â€“ merkez",
        slot1Hint:  "AvuÃ§ iÃ§ini dÃ¼z ve tam gÃ¶ster; tÃ¼m ana Ã§izgiler gÃ¶rÃ¼nsÃ¼n.",
        slot2Title: "Sol aÃ§Ä±",
        slot2Hint:  "AvuÃ§ hafif sola dÃ¶nÃ¼k; sol kenardaki kÄ±vrÄ±mlar gÃ¶rÃ¼nsÃ¼n.",
        slot3Title: "SaÄŸ aÃ§Ä±",
        slot3Hint:  "AvuÃ§ hafif saÄŸa dÃ¶nÃ¼k; parmak ve saÄŸ kenar belirgin olsun.",
        slot4Title: "Bilek / alt Ã§izgiler",
        slot4Hint:  "Bilek Ã§izgileri ve avuÃ§ alt kÄ±smÄ± net gÃ¶rÃ¼nsÃ¼n.",
        slot5Title: "Elin Ã¼stÃ¼",
        slot5Hint:  "Elin Ã¼st kÄ±smÄ±, boÄŸumlar ve parmak dipleri gÃ¶rÃ¼nsÃ¼n.",
        uploadBtn: "GÃ¶rsel SeÃ§",
        questionLabel: "Sorun / Niyetin",
        placeholder: "AÅŸk, kaderin, yaÅŸam yolun, kariyerin veya saÄŸlÄ±k temalarÄ±yla ilgili merak ettiklerini buraya yaz...",
        analyze: "El FalÄ±mÄ± Yorumla",
        statusIdle: "",
        statusLoading: "Elin okunuyorâ€¦ Ã§izgilerin ve enerjin yorumlanÄ±yor...",
        statusDone: "El falÄ±n hazÄ±r.",
        statusError: "Bir hata oluÅŸtu. LÃ¼tfen tekrar dene.",
        mustText: "LÃ¼tfen en azÄ±ndan kÄ±sa bir soru veya niyet yaz.",
        userWelcome: "HoÅŸ geldin, ",
        resultTitle: "El FalÄ±n",
        resultInitial: "âœ¨ AvuÃ§ fotoÄŸraflarÄ±nÄ± yÃ¼kleyip niyetini yazdÄ±ktan sonra yapay zekÃ¢ el falÄ±n burada gÃ¶rÃ¼necek. âœ¨",
        resultHint: "MystAI eÄŸlence amaÃ§lÄ± bir yapay zekÃ¢ fal yorumlayÄ±cÄ±sÄ±dÄ±r; tÄ±bbi, psikolojik veya profesyonel tavsiye yerine geÃ§mez.",
        listen: "Dinle",
        listening: "Ã‡alÄ±yor...",
        back: "Uygulamaya DÃ¶n",
        logout: "Ã‡Ä±kÄ±ÅŸ Yap",
        rights: "TÃ¼m HaklarÄ± SaklÄ±dÄ±r.",
        dev: "GALAXY tarafÄ±ndan geliÅŸtirilmiÅŸtir ðŸŒŒ",
        contact: "Ä°letiÅŸim:"
      }
    };

    let activeLang = localStorage.getItem("myst_lang") || "en";

    function applyLang(lang) {
      activeLang = lang;
      localStorage.setItem("myst_lang", lang);
      const t = i18n[lang];

      titleEl.textContent       = t.title;
      subtitleEl.textContent    = t.subtitle;
      labelHand.textContent     = t.handLabel;
      labelLeftText.textContent = t.leftText;
      labelRightText.textContent= t.rightText;
      labelPhotos.textContent   = t.photosLabel;

      slotTitleEls[1].textContent = t.slot1Title;
      slotHintEls[1].textContent  = t.slot1Hint;
      slotTitleEls[2].textContent = t.slot2Title;
      slotHintEls[2].textContent  = t.slot2Hint;
      slotTitleEls[3].textContent = t.slot3Title;
      slotHintEls[3].textContent  = t.slot3Hint;
      slotTitleEls[4].textContent = t.slot4Title;
      slotHintEls[4].textContent  = t.slot4Hint;
      slotTitleEls[5].textContent = t.slot5Title;
      slotHintEls[5].textContent  = t.slot5Hint;

      SLOT_IDS.forEach(id=>{
        slotBtnTextEls[id].textContent = t.uploadBtn;
      });

      labelQuestion.textContent = t.questionLabel;
      textarea.placeholder      = t.placeholder;
      analyzeText.textContent   = t.analyze;

      resultTitle.textContent   = t.resultTitle;
      resultText.textContent    = t.resultInitial;
      resultHint.textContent    = t.resultHint;
      listenLabel.textContent   = t.listen;

      rightsLabel.textContent   = t.rights;
      devLabel.textContent      = t.dev;
      contactLabel.textContent  = t.contact;
      backBtn.textContent       = "â¬… " + t.back;
      logoutBtn.textContent     = t.logout;

      btnEn.classList.toggle("active", lang === "en");
      btnTr.classList.toggle("active", lang === "tr");

      if (auth.currentUser) {
        const name = auth.currentUser.displayName || auth.currentUser.email;
        userLabel.textContent = t.userWelcome + name;
      }
    }

    btnEn.addEventListener("click", () => applyLang("en"));
    btnTr.addEventListener("click", () => applyLang("tr"));

    backBtn.addEventListener("click", () => {
      window.location.href = "app.html";
    });

    logoutBtn.addEventListener("click", () => {
      signOut(auth).then(() => window.location.href = "login.html");
    });

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }
      const t = i18n[activeLang];
      const name = user.displayName || user.email;
      userLabel.textContent = t.userWelcome + name;
    });

    applyLang(activeLang);

    /* ====== HAND PILL TOGGLE ====== */
    function updatePills() {
      const selected = document.querySelector('input[name="hand"]:checked')?.value || "left";
      pillLeft.classList.toggle("active", selected === "left");
      pillRight.classList.toggle("active", selected === "right");
    }
    pillLeft.addEventListener("click", () => {
      pillLeft.querySelector('input[name="hand"]').checked = true;
      updatePills();
    });
    pillRight.addEventListener("click", () => {
      pillRight.querySelector('input[name="hand"]').checked = true;
      updatePills();
    });
    updatePills();

    /* ====== MULTI IMAGE PREVIEW ====== */
    SLOT_IDS.forEach(id=>{
      const btn = document.getElementById(`btnSlot${id}`);
      const fileInput = slotFileEls[id];
      const previewBox = slotPreviewBoxEls[id];
      const imgEl = slotImgEls[id];
      const nameEl = slotNameEls[id];

      btn.addEventListener("click", ()=> fileInput.click());
      fileInput.addEventListener("change", ()=>{
        const file = fileInput.files[0];
        if(!file){
          previewBox.style.display="none";
          return;
        }
        const url = URL.createObjectURL(file);
        imgEl.src = url;
        nameEl.textContent = file.name;
        previewBox.style.display = "flex";
      });
    });

    /* ====== ANALYZE (backend + Firestore) ====== */
    analyzeBtn.addEventListener("click", async () => {
      const t = i18n[activeLang];
      const user = auth.currentUser;
      if (!user) {
        alert(activeLang === "tr" ? "LÃ¼tfen Ã¶nce giriÅŸ yap." : "Please log in first.");
        return;
      }

      const question = textarea.value.trim();
      if (!question) {
        alert(t.mustText);
        return;
      }

      const hand = document.querySelector('input[name="hand"]:checked')?.value || "left";

      analyzeBtn.disabled = true;
      statusText.textContent = t.statusLoading;
      resultText.textContent = "";
      listenBtn.disabled = true;
      audioPlayer.pause();
      audioPlayer.currentTime = 0;
      audioPlayer.src = "";

      try {
        if (!BACKEND_URL || BACKEND_URL.includes("YOUR-BACKEND-URL")) {
          statusText.textContent = "Backend URL is not configured.";
          analyzeBtn.disabled = false;
          return;
        }

        // KaÃ§ fotoÄŸraf seÃ§ilmiÅŸ (sadece bilgi amaÃ§lÄ±)
        const usedSlots = SLOT_IDS.filter(id => slotFileEls[id].files[0]);
        const imagesInfo = usedSlots.map(id => ({
          slot: id,
          name: slotFileEls[id].files[0]?.name || ""
        }));

        const handText =
          activeLang === "tr"
            ? (hand === "left" ? "Sol el" : "SaÄŸ el")
            : (hand === "left" ? "Left hand" : "Right hand");

        const photosLine =
          activeLang === "tr"
            ? `KullanÄ±cÄ± ${usedSlots.length} adet avuÃ§ iÃ§i fotoÄŸrafÄ± yÃ¼kledi (farklÄ± aÃ§Ä±lardan).`
            : `User has uploaded ${usedSlots.length} palm photos from different angles.`;

        const payloadText =
          (activeLang === "tr"
            ? "Bu bir el falÄ±dÄ±r. SeÃ§ilen elin enerjisini, yaÅŸam Ã§izgilerini, aÅŸk, kader ve yaÅŸam yolu temalarÄ±nÄ± mistik ama net bir dille yorumla.\n"
            : "This is an AI palm reading. Interpret the chosen hand and the user's life themes (love, fate, life path, career) in a mystical yet clear style.\n") +
          (activeLang === "tr"
            ? "SeÃ§ilen el: "
            : "Selected hand: ") +
          handText +
          "\n" +
          photosLine +
          "\n\n" +
          (activeLang === "tr"
            ? "KullanÄ±cÄ±nÄ±n sorusu/niyeti: "
            : "User's question/intention: ") +
          question;

        const res = await fetch(`${BACKEND_URL}/predict`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ user_input: payloadText })
        });

        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const text = data?.text || (activeLang === "tr" ? "YanÄ±t alÄ±namadÄ±." : "No response.");
        const audioPath = data?.audio;

        resultText.textContent = text;
        statusText.textContent = t.statusDone;

        // Firestore save (history.html bunu zaten okuyor)
        try {
          await addDoc(collection(db, "fortunes"), {
            user: user.email,
            type: "AI Palm Reading",
            hand,
            question,
            result: text,
            photosCount: usedSlots.length,
            photosMeta: imagesInfo,
            createdAt: new Date().toISOString(),
            source: "palm-page"
          });
        } catch (e) {
          console.warn("Firestore save error:", e);
        }

        if (audioPath) {
          const fullURL = audioPath.startsWith("http") ? audioPath : `${BACKEND_URL}${audioPath}`;
          audioPlayer.src = fullURL;
          listenBtn.disabled = false;
        }
      } catch (err) {
        console.error(err);
        statusText.textContent = t.statusError;
        resultText.textContent =
          (activeLang === "tr" ? "Hata: " : "Error: ") + (err?.message || String(err));
      } finally {
        analyzeBtn.disabled = false;
      }
    });

    listenBtn.addEventListener("click", () => {
      if (!audioPlayer.src) return;
      const t = i18n[activeLang];
      listenLabel.textContent = t.listening;
      audioPlayer.play().catch(() => {});
      audioPlayer.onended = () => {
        listenLabel.textContent = t.listen;
      };
    });
  </script>
</body>
</html>
